<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-engineering/android-app/writing-fhir/fhir_path">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">FHIRPath expressions | OpenSRP Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://opensrp.github.io/engineering/android-app/writing-fhir/fhir_path"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="FHIRPath expressions | OpenSRP Documentation"><meta data-rh="true" name="description" content="Paths are defined using FhirPath, which is an expression language defined by FHIR. In its simplest form, this can take the form of a single dotted path:"><meta data-rh="true" property="og:description" content="Paths are defined using FhirPath, which is an expression language defined by FHIR. In its simplest form, this can take the form of a single dotted path:"><link data-rh="true" rel="icon" href="/img/opensrp-favicon.png"><link data-rh="true" rel="canonical" href="https://opensrp.github.io/engineering/android-app/writing-fhir/fhir_path"><link data-rh="true" rel="alternate" href="https://opensrp.github.io/engineering/android-app/writing-fhir/fhir_path" hreflang="en"><link data-rh="true" rel="alternate" href="https://opensrp.github.io/engineering/android-app/writing-fhir/fhir_path" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.d639baf9.css">
<link rel="preload" href="/assets/js/runtime~main.014498c4.js" as="script">
<link rel="preload" href="/assets/js/main.54916289.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/opensrp-logo.png" alt="OpenSRP Documentation" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/opensrp-logo.png" alt="OpenSRP Documentation" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Docs</b></a></div><div class="navbar__items navbar__items--right"><a href="https://opensrp.io/" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">Home</a><a href="https://opensrp.io/about/" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">About</a><a class="navbar__item navbar__link nav-active" href="/">Docs</a><a href="https://opensrp.io/screenshots/" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">Screenshots</a><a href="https://opensrp.io/impact/" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">Impact</a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/project-information">Project Information</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">FEATURES</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/features/app-features">App Features</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/features/admin-dashboard-features">Admin Dashboard Features</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/features/supported-health-domains">Supported Domains</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">ENGINEERING</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/engineering/android-app/introduction">Android App</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/engineering/android-app/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/engineering/android-app/getting-started">Getting Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/engineering/android-app/platform-components">Platform Components</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/engineering/android-app/configurations/introduction">Configurations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/engineering/android-app/developer-setup">Developer setup</a><button aria-label="Toggle the collapsible sidebar category &#x27;Developer setup&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/engineering/android-app/writing-fhir/cql">Writing FHIR</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/engineering/android-app/writing-fhir/cql">CQL</a><button aria-label="Toggle the collapsible sidebar category &#x27;CQL&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/engineering/android-app/writing-fhir/fhir_path">FHIRPath expressions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/engineering/android-app/writing-fhir/form-authoring">Form Authoring (Things to consider when writing forms)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/engineering/android-app/writing-fhir/plan-definiton">PlanDefinitions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/engineering/android-app/writing-fhir/sample-fhir-resources">Sample FHIR resources</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/engineering/android-app/writing-fhir/smart-vax-certs">Smart Vaccination Certificates</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/engineering/android-app/writing-fhir/testing-resources">Testing FHIR Resources</a></li></ul></li></ul></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">ENGINEERING</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Android App</span><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Writing FHIR</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">FHIRPath expressions</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>FHIRPath expressions</h1><p>Paths are defined using <a href="http://hl7.org/fhirpath" target="_blank" rel="noopener noreferrer">FhirPath</a>, which is an expression language defined by FHIR. In its simplest form, this can take the form of a single dotted path:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Patient.name.given</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the example above, the FHIRPath expression matches all of the patient&#x27;s given names.</p><h1>Using expressions</h1><p>The <a href="http://build.fhir.org/ig/HL7/sdc/behavior.html" target="_blank" rel="noopener noreferrer">Form Behavior</a>, <a href="http://build.fhir.org/ig/HL7/sdc/populate.html" target="_blank" rel="noopener noreferrer">Questionnaire Population</a> and <a href="http://build.fhir.org/ig/HL7/sdc/extraction.html" target="_blank" rel="noopener noreferrer">Data Extraction</a> all rely on (or have features that rely on) the use of <a href="http://hl7.org/fhir/R4/metadatatypes.html#Expression" target="_blank" rel="noopener noreferrer">expressions</a>.</p><h1>Expression extensions</h1><p>Expressions are introduced into Questionnaires using extensions - none of the &#x27;core&#x27; data elements of Questionnaire makes use of extensions because they&#x27;re considered an &#x27;advanced&#x27; capability that is not currently supported by a large portion of the systems that make use of the Questioannaire resource. The extensions that make use of expressions and are supported in Android FHIR SDK are shown in the table below. Check out all types of <a href="http://build.fhir.org/ig/HL7/sdc/expressions.html#expression-extensions" target="_blank" rel="noopener noreferrer">available expression extensions</a>
| Extension | Specs | Example |
| --------- | ----- | ------- |
| <a href="http://hl7.org/fhir/R4/extension-variable.html" target="_blank" rel="noopener noreferrer">variable</a> | <a href="http://build.fhir.org/ig/HL7/sdc/expressions.html#expression-extensions" target="_blank" rel="noopener noreferrer">purpose and usage</a> | <a href="http://build.fhir.org/ig/HL7/sdc/examples.html#calculatedexpression" target="_blank" rel="noopener noreferrer">Using variable</a> |
| <a href="http://build.fhir.org/ig/HL7/sdc/StructureDefinition-sdc-questionnaire-initialExpression.html" target="_blank" rel="noopener noreferrer">initialExpression</a> | <a href="http://build.fhir.org/ig/HL7/sdc/expressions.html#expression-extensions" target="_blank" rel="noopener noreferrer">purpose and usage</a> | <a href="http://build.fhir.org/ig/HL7/sdc/examples.html#initialexpression" target="_blank" rel="noopener noreferrer">Using initialExpression</a> |
| <a href="http://build.fhir.org/ig/HL7/sdc/StructureDefinition-sdc-questionnaire-enableWhenExpression.html" target="_blank" rel="noopener noreferrer">enableWhenExpression</a> | <a href="http://build.fhir.org/ig/HL7/sdc/expressions.html#expression-extensions" target="_blank" rel="noopener noreferrer">purpose and usage</a> | <a href="http://build.fhir.org/ig/HL7/sdc/examples.html#enableexamples" target="_blank" rel="noopener noreferrer">Using enableWhenExpression</a> |
| <a href="http://build.fhir.org/ig/HL7/sdc/StructureDefinition-sdc-questionnaire-calculatedExpression.html" target="_blank" rel="noopener noreferrer">calculatedExpression</a> | <a href="http://build.fhir.org/ig/HL7/sdc/expressions.html#expression-extensions" target="_blank" rel="noopener noreferrer">purpose and usage</a> | <a href="http://build.fhir.org/ig/HL7/sdc/examples.html#calculatedexpression" target="_blank" rel="noopener noreferrer">Using calculatedExpression</a> |
| <a href="http://build.fhir.org/ig/HL7/sdc/StructureDefinition-sdc-questionnaire-answerExpression.html" target="_blank" rel="noopener noreferrer">answerExpression</a> | <a href="http://build.fhir.org/ig/HL7/sdc/expressions.html#expression-extensions" target="_blank" rel="noopener noreferrer">purpose and usage</a> | <a href="http://build.fhir.org/ig/HL7/sdc/examples.html#reference-resource-profile-lookup" target="_blank" rel="noopener noreferrer">Using answerExpression</a> |
| <a href="http://build.fhir.org/ig/HL7/sdc/StructureDefinition-sdc-questionnaire-candidateExpression.html" target="_blank" rel="noopener noreferrer">candidateExpression</a> | <a href="http://build.fhir.org/ig/HL7/sdc/expressions.html#expression-extensions" target="_blank" rel="noopener noreferrer">purpose and usage</a> | <a href="http://build.fhir.org/ig/HL7/sdc/examples.html#candidateExpression" target="_blank" rel="noopener noreferrer">Using candidateExpression</a> |</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="variable">Variable<a href="#variable" class="hash-link" aria-label="Direct link to Variable" title="Direct link to Variable">​</a></h2><p>The variable expression sets a variable that is available for use in expressions within the same item and any descendant items. It has two main uses:</p><ul><li>It allows a complex calculation to be done once and used in multiple other places. (E.g. Determining the score for one group within the questionnaire response that will then be used in calculations on subsequent groups.)</li><li>It allows a calculation to be done closer to the root of the questionnaire response or at the root of the questionnaire response where there is access to more of or all the answers from the questionnaire response. The calculated value might then be used as the answer to a descendant question. (Expressions cannot access answers that are not descendants of the current node.)</li></ul><p>The content type of a variable can be pretty much anything. It can be a collection or an individual item. It can be a simple element, a complex type, a resource or even a Bundle of resources.
The variable can be referenced by its name. Variable expressions SHALL specify a name. It is not allowed to define variable names that are already reserved by the base specification or by other variables in the questionnaire.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-evaluate-the-variable-expression">How to evaluate the variable expression<a href="#how-to-evaluate-the-variable-expression" class="hash-link" aria-label="Direct link to How to evaluate the variable expression" title="Direct link to How to evaluate the variable expression">​</a></h3><p>Variable expressions can be defined at the questionnaire and questionnaire item levels. The Structure Data Capture Library provides separate APIs to evaluate variable expressions defined at either questionnaire or questionnaire item level.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="sample-questionnaire-for-questionnaire-level-variable-expressions">Sample Questionnaire for Questionnaire level variable expressions<a href="#sample-questionnaire-for-questionnaire-level-variable-expressions" class="hash-link" aria-label="Direct link to Sample Questionnaire for Questionnaire level variable expressions" title="Direct link to Sample Questionnaire for Questionnaire level variable expressions">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;resourceType&quot;: &quot;Questionnaire&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;extension&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/variable&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;valueExpression&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;name&quot;: &quot;weight&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;language&quot;: &quot;text/fhirpath&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;expression&quot;: &quot;%resource.repeat(item).where(linkId=&#x27;3.3.1&#x27;).item.answer.valueDecimal&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;item&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;extension&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/questionnaire-unit&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;valueCoding&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;system&quot;: &quot;http://unitsofmeasure.org&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;code&quot;: &quot;kg&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;linkId&quot;: &quot;3.3.1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;text&quot;: &quot;Weight (kg)&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;type&quot;: &quot;decimal&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="api-to-evaluate-variable-expressions-defined-at-the-questionnaire-level">API to evaluate variable expressions defined at the questionnaire level<a href="#api-to-evaluate-variable-expressions-defined-at-the-questionnaire-level" class="hash-link" aria-label="Direct link to API to evaluate variable expressions defined at the questionnaire level" title="Direct link to API to evaluate variable expressions defined at the questionnaire level">​</a></h4><p>To evaluate variable expressions defined at Questionnaire level, we have to pass a variable expression, Questionnaire, QuestionnaireResponse and an optional varaiblesMap</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> internal fun evaluateQuestionnaireVariableExpression(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    expression: Expression,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    questionnaire: Questionnaire,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    questionnaireResponse: QuestionnaireResponse,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    variablesMap: MutableMap&lt;String, Base?&gt; = mutableMapOf()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ): Base?</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="sample-questionnaire-for-questionnaire-item-level-variable-expressions">Sample Questionnaire for Questionnaire item level variable expressions<a href="#sample-questionnaire-for-questionnaire-item-level-variable-expressions" class="hash-link" aria-label="Direct link to Sample Questionnaire for Questionnaire item level variable expressions" title="Direct link to Sample Questionnaire for Questionnaire item level variable expressions">​</a></h4><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;item&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;linkId&quot;: &quot;/groupA&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;text&quot;: &quot;Group A&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;type&quot;: &quot;group&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;extension&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/variable&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;valueExpression&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;name&quot;: &quot;X&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;language&quot;: &quot;text/fhirpath&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;expression&quot;: &quot;item.where(linkId=&#x27;/groupA/fieldB&#x27;).answer[0].valueInteger&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/variable&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;valueExpression&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;name&quot;: &quot;Y&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;language&quot;: &quot;text/fhirpath&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;expression&quot;: &quot;%X + 2&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;comment&quot;: &quot;References another variable on the same group&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;item&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;linkId&quot;: &quot;/groupA/fieldB&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;text&quot;: &quot;Field B&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;type&quot;: &quot;integer&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="api-to-evaluate-variable-expressions-defined-at-questionnaire-item-level">API to evaluate variable expressions defined at Questionnaire item level<a href="#api-to-evaluate-variable-expressions-defined-at-questionnaire-item-level" class="hash-link" aria-label="Direct link to API to evaluate variable expressions defined at Questionnaire item level" title="Direct link to API to evaluate variable expressions defined at Questionnaire item level">​</a></h4><p>To evaluate variable expressions defined at Questionnaire item level, we have to pass a variable expression, questionnaire, QuestionnaireResponse, questionnaireItemParentMap,QuestionnaireItem and an optional varaiblesMap</p><div class="language-kotlin codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-kotlin codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">internal fun evaluateQuestionnaireItemVariableExpression(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    expression: Expression,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    questionnaire: Questionnaire,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    questionnaireResponse: QuestionnaireResponse,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    questionnaireItemParentMap:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Map&lt;Questionnaire.QuestionnaireItemComponent, Questionnaire.QuestionnaireItemComponent&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    questionnaireItem: Questionnaire.QuestionnaireItemComponent,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    variablesMap: MutableMap&lt;String, Base?&gt; = mutableMapOf()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ): Base?</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="initial-expression">Initial Expression<a href="#initial-expression" class="hash-link" aria-label="Direct link to Initial Expression" title="Direct link to Initial Expression">​</a></h2><p>Besides using <a href="http://hl7.org/fhir/R4/questionnaire-definitions.html#Questionnaire.item.initial" target="_blank" rel="noopener noreferrer">initial</a> property in <a href="https://hl7.org/fhir/R4/questionnaire.html" target="_blank" rel="noopener noreferrer">Questionnaire.item</a> for providing a default answer on questionnaire load, <a href="https://build.fhir.org/ig/HL7/sdc/StructureDefinition-sdc-questionnaire-initialExpression.html" target="_blank" rel="noopener noreferrer">initial expression</a> is another alternate way of providing default answer based on a FHIRPath expression i.e. rather than specifying a fixed value, the value is calculable.</p><ul><li>It is a Questionnaire.item-level extension</li><li>Examples could be<ul><li>current date i.e. <code>today() + 7 days</code> or</li><li>an expression based on current QuestionnaireResponse.item.answer. The QuestionnaireResponse in the current context can be referred to by %resource. i.e. <code>%resource.item.where(linkId=&#x27;weight&#x27;).answer.first()</code></li><li>an expression of based on launch context or information queried from external sources i.e. <code>%patient.birthDate</code>, full example questionnaire can be found <a href="https://build.fhir.org/ig/HL7/sdc/Questionnaire-demographics.json.html" target="_blank" rel="noopener noreferrer">here</a>.</li><li>an expression based on <code>variable</code> extension. i.e. <code>%weight * 0.25</code>. See variable rules <a href="http://hl7.org/fhir/R4/extension-variable.html" target="_blank" rel="noopener noreferrer">here</a></li></ul></li></ul><p>Both of the approaches are mutually exclusive and only one of these can be specified.</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;item&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;extension&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;url&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-initialExpression&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token property" style="color:#36acaa">&quot;valueExpression&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token property" style="color:#36acaa">&quot;language&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;text/fhirpath&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token property" style="color:#36acaa">&quot;expression&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;today() + 7 days&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;linkId&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;3.1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;text&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Next follow up date&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;date&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="enablewhen-expression">EnableWhen Expression<a href="#enablewhen-expression" class="hash-link" aria-label="Direct link to EnableWhen Expression" title="Direct link to EnableWhen Expression">​</a></h2><p><code>enableWhen</code> aka skip logic controls which questions, groups and display items would show or hide based on answers of other referenced questions within the response.
Besides using <a href="http://hl7.org/fhir/R4/questionnaire-definitions.html#Questionnaire.item.enableWhen" target="_blank" rel="noopener noreferrer">enableWhen</a> property in <a href="https://hl7.org/fhir/R4/questionnaire.html" target="_blank" rel="noopener noreferrer">Questionnaire.item</a> for providing skip logic, <a href="https://build.fhir.org/ig/HL7/sdc/StructureDefinition-sdc-questionnaire-enableWhenExpression.html" target="_blank" rel="noopener noreferrer">enableWhen expression</a> is another alternate way of providing skip logic based on a dynamic fhirpath expression.</p><ul><li>Elements that are not enabled are hidden from the user and can not be edited</li><li>It needs to be evaluated each time any of the answers it depends on changes</li><li>Any constraints associated with non-enabled elements i.e. <a href="https://build.fhir.org/ig/HL7/sdc/behavior.html#required" target="_blank" rel="noopener noreferrer">required</a> or <a href="https://build.fhir.org/ig/HL7/sdc/behavior.html#minOccurs" target="_blank" rel="noopener noreferrer">minOccurs</a> are ignored and no answers are stored for these.</li><li>Examples could be<ul><li>an expression based on current QuestionnaireResponse.item.answer. The QuestionnaireResponse in current context can be referred by %resource. i.e. <code>%resource.item.where(linkId=&#x27;weight&#x27;).answer.first() &gt; 45</code></li><li>an expression of based on launch context or information queried from external sources i.e. <code>%patient.deceased = flase</code>, full example questionnaire can be found <a href="https://build.fhir.org/ig/HL7/sdc/Questionnaire-demographics.json.html" target="_blank" rel="noopener noreferrer">here</a>.</li><li>an expression based on <code>variable</code> extension. i.e. <code>%weight &gt; 60</code>. See variable rules <a href="http://hl7.org/fhir/R4/extension-variable.html" target="_blank" rel="noopener noreferrer">here</a></li></ul></li></ul><p>Both of the approaches are mutually exclusive and only one of these can specified.</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token property" style="color:#36acaa">&quot;extension&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token property" style="color:#36acaa">&quot;url&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-enableWhenExpression&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token property" style="color:#36acaa">&quot;valueExpression&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;language&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;text/fhirpath&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;expression&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;%resource.repeat(item).where(linkId=&#x27;gender&#x27;).answer.value.code =&#x27;female&#x27; and %resource.repeat(item).where(linkId=&#x27;age&#x27;).answer.value &gt; 49&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token property" style="color:#36acaa">&quot;linkId&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;3.1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token property" style="color:#36acaa">&quot;text&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;Is women or non reproductive age&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;boolean&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="calculated-expression">Calculated expression<a href="#calculated-expression" class="hash-link" aria-label="Direct link to Calculated expression" title="Direct link to Calculated expression">​</a></h2><p><a href="https://build.fhir.org/ig/HL7/sdc/StructureDefinition-sdc-questionnaire-calculatedExpression.html" target="_blank" rel="noopener noreferrer">Calculated Expression</a> is an extension which allows to set answers to <a href="https://hl7.org/fhir/R4/questionnaire.html" target="_blank" rel="noopener noreferrer">Questionnaire.item</a> (generally but not limited to <a href="https://build.fhir.org/ig/HL7/sdc/behavior.html#readOnly" target="_blank" rel="noopener noreferrer">readOnly</a> or <a href="https://build.fhir.org/ig/HL7/sdc/rendering.html#hidden" target="_blank" rel="noopener noreferrer">hidden</a>). The calculation is dynamic via a <a href="http://hl7.org/fhirpath" target="_blank" rel="noopener noreferrer">fhirpath</a> expression which can be based on answers of other Questionnaire.items.</p><ul><li>Unlike <a href="https://build.fhir.org/ig/HL7/sdc/expressions.html#initialExpression" target="_blank" rel="noopener noreferrer">initialExpression</a> extension, instead of only setting value on Questionnaire.item loading, this extension- keeps updating the value as soon as the answers of dependent questions change.</li><li>Mostly it is used for displaying or calculating scores, patient age, BMI, estimated cost etc</li><li>In most cases, &#x27;calculated&#x27; answers are &#x27;readOnly&#x27;, however, the extension can be applied to any Questionnaire.item.</li><li>For modifiable Questionnaire.item if a user has edited the answer of calculated expression, it can no longer be changed based on expression i.e. an edited item does not update by expression anymore</li><li>Examples could be<ul><li>an expression based on current QuestionnaireResponse.item.answer. The QuestionnaireResponse in current context can be referred by %resource. i.e. <code>%resource.item.where(linkId=&#x27;weight&#x27;).answer.first()</code></li><li>an expression of based on launch context or information queried from external sources i.e. <code>%patient.active</code>, full example questionnaire can be found <a href="https://build.fhir.org/ig/HL7/sdc/Questionnaire-demographics.json.html" target="_blank" rel="noopener noreferrer">here</a>.</li><li>an expression based on <code>variable</code> extension. i.e. <code>%weight + 20</code>. See variable rules <a href="http://hl7.org/fhir/R4/extension-variable.html" target="_blank" rel="noopener noreferrer">here</a></li></ul></li></ul><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;item&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;linkId&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;birthdate&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;text&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Birth Date&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;date&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;extension&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;url&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-calculatedExpression&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;valueExpression&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;language&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;text/fhirpath&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;expression&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;%resource.repeat(item).where(linkId=&#x27;age-years&#x27; and answer.empty().not()).select(today() - answer.value)&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;linkId&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;age-years&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;text&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Age years&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;quantity&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;initial&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;valueQuantity&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;unit&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;years&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;system&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;http://unitsofmeasure.org&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;code&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;years&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="answer-expression">Answer expression<a href="#answer-expression" class="hash-link" aria-label="Direct link to Answer expression" title="Direct link to Answer expression">​</a></h2><p>The possible answers for a <a href="https://hl7.org/fhir/R4/questionnaire.html" target="_blank" rel="noopener noreferrer">Questionnaire.item</a> are restricted or validated based on it type. The allowed value of a Questionnaire.item must conform to an enumerated set. The answerOption the possible allowed values and the type of  answerOption must match the type of the question. (Coding type is used for choice and open-choice)</p><p>Mainly answers can be enumerated  by three ways</p><ul><li><a href="https://build.fhir.org/ig/HL7/sdc/examples.html#answeroption" target="_blank" rel="noopener noreferrer">answerOption</a> are hardcoded set of option values and works well when there is a small number of choices and support variety of question types</li><li><a href="https://build.fhir.org/ig/HL7/sdc/behavior.html#answerValueSet" target="_blank" rel="noopener noreferrer">answerValueSet</a> element only supports &#x27;string&#x27; and Coding elements. It is better when set of codes is large or dynamic e.g. SNOMED or LOINC codes</li><li><strong><a href="https://build.fhir.org/ig/HL7/sdc/expressions.html#answerExpression" target="_blank" rel="noopener noreferrer">answerExpression</a> extension</strong> allows a FHIR Query, FHIRPath, or CQL (not implemented yet) expression that can be resolved to a list of permitted answers.<ul><li>Expression must evaluate to a collection with the same type as the Questionnaire.item.type</li><li>If the type is Reference it should evaluate to resources allowed as the referenced type</li><li>It is often used with <a href="https://build.fhir.org/ig/HL7/sdc/StructureDefinition-sdc-questionnaire-choiceColumn.html" target="_blank" rel="noopener noreferrer">Choice Column</a> extension to provide display or UI definitions</li><li>Currently Choice Column is applicable only for reference type. With a Reference choiceColumn allows selection of fields from the resource evaulated by x-fhir-query e.g. <code>name.first().given.first() + &#x27; &#x27; + name.first().family</code> for the full name of a Patient or Practitioner.</li><li>For multiple repetitions of the Choice Column extension the columns (concatenated values separated by space) are displayed in the same order as the extensions appear on the Questionnaire.item. If multiple columns are marked with <code>&quot;forDisplay&quot;: true</code>, the display value used will be a space-separated concatenation of all column</li></ul></li><li>Examples of expression are<ul><li><a href="http://hl7.org/fhir/R4/search.html" target="_blank" rel="noopener noreferrer">FHIR Query</a> i.e. <code>Patient?active=true&amp;name=john</code></li><li><a href="http://hl7.org/fhirpath" target="_blank" rel="noopener noreferrer">FHIRPath</a> which must conform to item type i.e. <code>%resource.item.where(type=&#x27;choice&#x27; and answer.empty().not()).answer</code></li><li><a href="http://cql.hl7.org/" target="_blank" rel="noopener noreferrer">CQL</a> - not implemented yet</li></ul></li></ul><p>All three mechanisms are mutually exclusive and only one can appear on same question</p><p>Use of other <a href="https://build.fhir.org/ig/HL7/sdc/behavior.html#value-constraint" target="_blank" rel="noopener noreferrer">Value Constraint</a> elements is redundant and confusing, hence, when using any of these to restrict answers do not make use of any of the other Value Constraint extensions.</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token property" style="color:#36acaa">&quot;item&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;extension&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;url&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-answerExpression&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;valueExpression&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;language&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;application/x-fhir-query&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;expression&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Practitioner?active=true&amp;_sort=family,given&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;extension&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;url&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;path&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;valueString&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;name.where(use=&#x27;official&#x27;).family + &#x27;, &#x27; + name.where(use=&#x27;official&#x27;).given.first()&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;url&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;forDisplay&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;valueBoolean&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;url&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-choiceColumn&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;extension&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;url&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;path&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;valueString&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&#x27;(&#x27; + gender + &#x27;)&#x27;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;url&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;forDisplay&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;valueBoolean&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;url&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-choiceColumn&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;linkId&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;1.0.0&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;text&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Preferred practitioner&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;reference&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cqf-expression">CQF expression<a href="#cqf-expression" class="hash-link" aria-label="Direct link to CQF expression" title="Direct link to CQF expression">​</a></h2><p><a href="http://hl7.org/fhir/R4B/extension-cqf-expression.html" target="_blank" rel="noopener noreferrer">Cqf-expression</a> is used in <a href="https://build.fhir.org/questionnaire-definitions.html#Questionnaire.item.text" target="_blank" rel="noopener noreferrer">Questionnaire.item.text</a> to make it a dynamic text. Dynamic text in this context refers to the ability to run FHIRPath, including variables, to the text content. As a result, the displayed text can dynamically change based on various parameters, such as the responses to other questionnaire items. In essence, the content of <a href="https://build.fhir.org/questionnaire-definitions.html#Questionnaire.item.text" target="_blank" rel="noopener noreferrer">Questionnaire.item.text</a> can adapt and respond to the answers provided to other questions within the questionnaire.</p><p>Facts about Cqf-expression:</p><ul><li>Cqf-expression is declared in the <code>_text</code> property as extension</li><li>If the Cqf-expression has NOT been evaluated yet, you will see the text declared in the text property</li><li>Using the <a href="https://build.fhir.org/ig/HL7/fhir-extensions/StructureDefinition-translation.html" target="_blank" rel="noopener noreferrer">translation extension</a> alongside Cqf-expression is not supported</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;linkId&quot;: &quot;1&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;text&quot;: &quot;The text you will ONLY see, if cqf-expression has NOT been evaluated yet&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;_text&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;extension&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/cqf-expression&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;valueExpression&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;language&quot;: &quot;text/fhirpath&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;expression&quot;: &quot;&#x27;My name is &#x27; + %name&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;type&quot;: &quot;display&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="gotchas">Gotchas<a href="#gotchas" class="hash-link" aria-label="Direct link to Gotchas" title="Direct link to Gotchas">​</a></h2><p>When working with dates, please note that according to the FHIR spec, if the duration value is specified as a whole number <em>(e.g. 1 month)</em> such as when you write <code>today + &#x27;1 month&#x27;</code>, then when the duration is added or subtracted to a given date(time), the outcome is rounded to the nearest natural calendar division - e.g. Feb. 1 + 1 mo = March 1, not March 2 or 3 (since 1 month is defined in UCUM as 30 days).</p><p><strong>Examples of rounding off to closest calendar division:</strong></p><blockquote><p>Normal calculation - Feb 1, 2023 + 30 days = March 3, 2023.
FHIR Path spec - Feb 1, 2023 + 1 month  = March 1, 2023</p></blockquote><p>Check out the FHIR documentation link here for reference <a href="https://hl7.org/fhir/R4/datatypes.html#Distance" target="_blank" rel="noopener noreferrer">https://hl7.org/fhir/R4/datatypes.html#Distance</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/opensrp/fhircore/tree/main/docs/docs/engineering/android-app/writing-fhir/fhir_path.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/engineering/android-app/writing-fhir/cql/sample-usage"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">CQL use cases</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/engineering/android-app/writing-fhir/form-authoring"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Form Authoring (Things to consider when writing forms)</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#variable" class="table-of-contents__link toc-highlight">Variable</a><ul><li><a href="#how-to-evaluate-the-variable-expression" class="table-of-contents__link toc-highlight">How to evaluate the variable expression</a></li></ul></li><li><a href="#initial-expression" class="table-of-contents__link toc-highlight">Initial Expression</a></li><li><a href="#enablewhen-expression" class="table-of-contents__link toc-highlight">EnableWhen Expression</a></li><li><a href="#calculated-expression" class="table-of-contents__link toc-highlight">Calculated expression</a></li><li><a href="#answer-expression" class="table-of-contents__link toc-highlight">Answer expression</a></li><li><a href="#cqf-expression" class="table-of-contents__link toc-highlight">CQF expression</a></li><li><a href="#gotchas" class="table-of-contents__link toc-highlight">Gotchas</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opensrp.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">OpenSRP<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://ona.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Ona<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Ona</div></div></div></footer></div>
<script src="/assets/js/runtime~main.014498c4.js"></script>
<script src="/assets/js/main.54916289.js"></script>
</body>
</html>
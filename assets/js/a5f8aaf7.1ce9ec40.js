"use strict";(self.webpackChunkfhircore=self.webpackChunkfhircore||[]).push([[358],{3905:(e,t,r)=>{r.d(t,{Zo:()=>p,kt:()=>d});var a=r(7294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},i=Object.keys(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)r=i[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var l=a.createContext({}),u=function(e){var t=a.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},p=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,i=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),c=u(r),d=n,m=c["".concat(l,".").concat(d)]||c[d]||h[d]||i;return r?a.createElement(m,o(o({ref:t},p),{},{components:r})):a.createElement(m,o({ref:t},p))}));function d(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=r.length,o=new Array(i);o[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:n,o[1]=s;for(var u=2;u<i;u++)o[u]=r[u];return a.createElement.apply(null,o)}return a.createElement.apply(null,r)}c.displayName="MDXCreateElement"},1792:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>u});var a=r(7462),n=(r(7294),r(3905));const i={},o=void 0,s={unversionedId:"in-app-reporting",id:"in-app-reporting",title:"in-app-reporting",description:"In App Reporting",source:"@site/docs/in-app-reporting.md",sourceDirName:".",slug:"/in-app-reporting",permalink:"/in-app-reporting",draft:!1,editUrl:"https://github.com/opensrp/fhircore/tree/main/docs/docs/in-app-reporting.md",tags:[],version:"current",frontMatter:{},sidebar:"defaultSidebar",previous:{title:"fhir-core-documetation",permalink:"/fhir-core-documetation"},next:{title:"intro",permalink:"/"}},l={},u=[{value:"<strong>In App Reporting</strong>",id:"in-app-reporting",level:2},{value:"Measure",id:"measure",level:2},{value:"MeasureReport",id:"measurereport",level:2},{value:"<strong>Types of MeasureReports</strong>",id:"types-of-measurereports",level:4},{value:"CQL Logic/Decision Library for Measure",id:"cql-logicdecision-library-for-measure",level:2},{value:"Testing the Measure CQL Library",id:"testing-the-measure-cql-library",level:2},{value:"<strong>$evaluate-measure operation</strong>",id:"evaluate-measure-operation",level:5},{value:"The  MeasureReport output",id:"the--measurereport-output",level:2},{value:"FHIR Core Integration",id:"fhir-core-integration",level:2},{value:"Screenshot of MeasureReport on FHIR Core",id:"screenshot-of-measurereport-on-fhir-core",level:2}],p={toc:u};function h(e){let{components:t,...r}=e;return(0,n.kt)("wrapper",(0,a.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h2",{id:"in-app-reporting"},(0,n.kt)("strong",{parentName:"h2"},"In App Reporting")),(0,n.kt)("p",null,"In App Reporting feature empowers the health worker to see how she is performing against her daily task list, and allows for offline peer-to-peer syncing of the data collected on a daily basis. This greatly simplifies reporting requirements by eliminating the need for cumbersome paper registries and tally sheets."),(0,n.kt)("h2",{id:"measure"},"Measure"),(0,n.kt)("p",null,"A ",(0,n.kt)("a",{parentName:"p",href:"http://hl7.org/fhir/R4/measure.html"},"Measure")," is a FHIR resource which represents definition- for calculation of an Indicator. The Measure uses a logic Library that contains the calculation logic for measure that is written as a Clinical Quality Language (CQL) expression.\nThe Measure resource represents a structured, computable definition of a health-related measure such as a clinical quality measure, public health indicator, or population analytics measure. A quality measure is a quantitative tool to assess the performance of an individual or organization with respect to a specified process or outcome via the measurement of actions, processes, or outcomes of clinical care. Quality measures are often derived from clinical guidelines and are designed to determine whether the appropriate care has been provided given a set of clinical criteria and an evidence base."),(0,n.kt)("p",null,(0,n.kt)("a",{parentName:"p",href:"https://build.fhir.org/library.html"},"Library - FHIR v4.6.0")," resource is referenced that contains the logic required by the measure, and the various expression elements, such as population criteria, reference named expressions within that library (or libraries). In addition, if the Measure references multiple libraries, then any expression references within the resource must be qualified with the name of the library that contains the referenced expression."),(0,n.kt)("p",null,"The complexity involved in specifying the criteria in the general case requires the use of a high-level query language such as Clinical Quality Language (CQL). As such, the Measure resource defines only the top-level populations and references expressions for the actual criteria. These expressions are typically provided using a ",(0,n.kt)("a",{parentName:"p",href:"https://build.fhir.org/library.html"},"Library")," ",(0,n.kt)("a",{parentName:"p",href:"https://build.fhir.org/library.html"},"Library - FHIR v4.6.0")," resource containing CQL or ELM expressions. In addition, the individual members of a population may be cases such as encounters or procedures and in these cases, the Group resource would be unable to represent the population characteristics accurately."),(0,n.kt)("h2",{id:"measurereport"},"MeasureReport"),(0,n.kt)("p",null,"The MeasureReport resource represents the results of calculating a measure for a specific subject or group of subjects. The ",(0,n.kt)("strong",{parentName:"p"},(0,n.kt)("em",{parentName:"strong"},"$evaluate-measure"))," operation of the Measure resource is defined to return a MeasureReport. The resource is capable of representing three different levels of report: individual, subject-list, and summary."),(0,n.kt)("p",null,"The Measure resource represents a structured, computable definition of a health-related measure such as a clinical quality measure, public health indicator, or population analytics measure. A quality measure is a quantitative tool to assess the performance of an individual or organization with respect to a specified process or outcome via the measurement of actions, processes, or outcomes of clinical care. Quality measures are often derived from clinical guidelines and are designed to determine whether the appropriate care has been provided given a set of clinical criteria and an evidence base."),(0,n.kt)("p",null,"Note that the Measure itself does not typically contain any logic; rather a Library resource is referenced that contains the logic required by the measure, and the various expression elements, such as population criteria, reference named expressions within that library (or libraries). This is done using the Clinical Quality Language syntax. The library will contain a CQL-ELM embedded as a base64 . Read more here ",(0,n.kt)("a",{parentName:"p",href:"https://cql.hl7.org/index.html"},"Clinical Quality Language (CQL)")," "),(0,n.kt)("p",null,"In addition, if the Measure references multiple libraries, then any expression references within the resource must be qualified with the name of the library that contains the referenced expression. "),(0,n.kt)("p",null,"Read more here  ",(0,n.kt)("a",{parentName:"p",href:"https://build.fhir.org/clinicalreasoning-quality-reporting.html"},"Clinicalreasoning-quality-reporting - FHIR v4.6.0"),"  and here ",(0,n.kt)("a",{parentName:"p",href:"https://build.fhir.org/ig/HL7/cqf-measures/glossary.html"},"HL7.FHIR.US.CQFMEASURES\\Glossary - FHIR v4.0.1")," "),(0,n.kt)("h4",{id:"types-of-measurereports"},(0,n.kt)("strong",{parentName:"h4"},"Types of MeasureReports")),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Cohort"),"\nA measure score in which a population is identified from the population of all items being counted. For example, one can identify all the patients who have had H1N1 symptoms. This population is very similar to the Initial Population but is called a Cohort Population for public health purposes.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Continuous Variable"),"\nA measure score in which each individual value for the measure can fall anywhere along a continuous scale and can be aggregated using a variety of methods such as the calculation of a mean or median (for example, mean number of minutes between presentation of chest pain to the time of administration of thrombolytics)")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"Proportion"),"\nA score derived by dividing the number of cases that meet a criterion for quality (the numerator) by the number of eligible cases within a given time frame (the denominator) where the numerator cases are a subset of the denominator cases (for example, percentage of eligible women with a mammogram performed in the last year)."))),(0,n.kt)("ol",{start:4},(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("strong",{parentName:"li"},"Ratio"),"\nA ratio is a score that is derived by dividing a count of one type of data by a count of another type of data. For example, the number of patients with central lines who develop infection divided by the number of central line days")),(0,n.kt)("p",null,"A working example (Households and Members disaggregated by age) of Measure can be found ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/opensrp/fhir-resources/blob/main/ecbis/measure/household_measure.fhir.json"},"here"),". Notable components in example Measure are"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},'{\n  "url": "http://fhir.org/guides/who/anc-cds/Measure/HOUSEHOLDIND01",\n  "name": "HOUSEHOLDIND01",\n  "relatedArtifact": [ {\n    "type": "depends-on",\n    "label": "FHIRHelpers|4.0.1",\n    "resource": "Library/1753"\n   } ],\n  "library": [ "http://fhir.org/guides/cqf/common/Library/HOUSEHOLDIND01" ],\n  "scoring": { ... },\n  "group": [ {\n    "id": "males",\n    "population": [ {\n      "id": "initial-population",\n      "code": { ... },\n      "criteria": {\n        "language": "text/cql-identifier",\n        "expression": "Patients"\n      }\n    }, {\n      "id": "denominator",\n      "code": { ... },\n      "criteria": {\n        "language": "text/cql-identifier",\n        "expression": "Group Member"\n      }\n    }, {\n      "id": "numerator",\n      "code": { ... },\n      "criteria": {\n        "language": "text/cql-identifier",\n        "expression": "Males"\n      }\n    } ],\n      "stratifier": [ {\n        "id": "by-age",\n        "criteria": {\n            "language": "text/cql-identifier",\n            "expression": "Age Stratifier"\n        }\n      }, \n      { ... ... ... } ]\n  }, \n  { ... ... ... } ],\n  "supplementalData": [\n      {\n          "description": "groups",\n          "criteria": {\n              "language": "text/cql-identifier",\n              "expression": "Group"\n          }\n      }\n  ]\n}\n')),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Details of notable fields for Measure")),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"url"),": The complete url of Measure with Measure.name i.e. ",(0,n.kt)("a",{parentName:"p",href:"http://fhir.org/guides/who/anc-cds/Measure/HOUSEHOLDIND01"},"http://fhir.org/guides/who/anc-cds/Measure/HOUSEHOLDIND01"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"name"),": A unique name for Measure i.e. ",(0,n.kt)("inlineCode",{parentName:"p"},"HOUSEHOLDIND01"),". The Measure is loaded by name and url into measure processor")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"relatedArtifact"),": Helper libraries to load before running Measure to be used by measure logic libraries i.e. FHIRHelpers|4.0.1. The Library is loaded by its canonical url i.e. Library/123\n")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"library"),": The CQL logic libraries used by Measure for calculation i.e. ",(0,n.kt)("a",{parentName:"p",href:"http://fhir.org/guides/cqf/common/Library/HOUSEHOLDIND01"},"http://fhir.org/guides/cqf/common/Library/HOUSEHOLDIND01"),". The logic library is loaded by its url. The url must end with /Library/name ")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"scoring"),": proportion | ratio | continuous-variable | cohort")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"group"),": The section of report defining the stats for a specific indicator (may be disaggregated by stratifier). Each group has following components"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"id"),": Group name/id."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"population"),": The calculations (or name of variable in CQL that defines the value) for each of population components i.e. initial-population, denominator, numerator"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"stratifier"),": The disaggregations for given population numerator. i.e. by age, by month, by education etc "),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"supplementalData"),": Any extra data or intermediate calculation to be output to final report. Current implementation of MeasureEvaluator does not allow running any measure which is not Patient centric i.e. a Measure.subject can always be a Patient. Hence, we are using ",(0,n.kt)("inlineCode",{parentName:"li"},"supplementalData")," to output Group for each indicator and then counting distinct Group to count Households")))),(0,n.kt)("h2",{id:"cql-logicdecision-library-for-measure"},"CQL Logic/Decision Library for Measure"),(0,n.kt)("p",null,"The Measure needs a ",(0,n.kt)("a",{parentName:"p",href:"http://hl7.org/fhir/R4/library.html"},"Library")," to get the logic/calculation for ecah variable. This calculation or logic comes from CQL. ",(0,n.kt)("a",{parentName:"p",href:"https://cql.hl7.org/01-introduction.html"},"Here")," is a detailed guide on CQL. Some example CQL scripts can be found ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/opensrp/fhir-resources/tree/main/ecbis/measure_cql"},"here"),"."),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"CQL brief authoring guide ",(0,n.kt)("a",{parentName:"li",href:"https://cql.hl7.org/02-authorsguide.html"},"https://cql.hl7.org/02-authorsguide.html")),(0,n.kt)("li",{parentName:"ul"},"CQL operators and functions ",(0,n.kt)("a",{parentName:"li",href:"https://cql.hl7.org/04-logicalspecification.html"},"https://cql.hl7.org/04-logicalspecification.html")," and ",(0,n.kt)("a",{parentName:"li",href:"https://cql.hl7.org/09-b-cqlreference.html"},"https://cql.hl7.org/09-b-cqlreference.html")),(0,n.kt)("li",{parentName:"ul"},"Fhirpath mapping in CQL ",(0,n.kt)("a",{parentName:"li",href:"https://cql.hl7.org/16-i-fhirpathtranslation.html"},"https://cql.hl7.org/16-i-fhirpathtranslation.html")),(0,n.kt)("li",{parentName:"ul"},"Examples ",(0,n.kt)("a",{parentName:"li",href:"https://cql.hl7.org/15-h-timeintervalcalculations.html"},"Time Interval")," and ",(0,n.kt)("a",{parentName:"li",href:"https://cql.hl7.org/03-developersguide.html#conditional-expressions"},"Detail on Queries")),(0,n.kt)("li",{parentName:"ul"},"CQL Sandbox is ","[here]","(",(0,n.kt)("a",{parentName:"li",href:"https://sandbox.cqlab.io/"},"https://sandbox.cqlab.io/")," CQL sandbox)"),(0,n.kt)("li",{parentName:"ul"},"CQL android editor app is ",(0,n.kt)("a",{parentName:"li",href:"https://github.com/Path-Check/cql-editor-app/"},"here"))),(0,n.kt)("p",null,"A working example of used by above Measure is ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/opensrp/fhir-resources/blob/main/ecbis/measure_cql/household_measure_reporting.cql"},"here"),". Some notable lines are"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},'library HOUSEHOLDIND01 version \'1\'\n...\ninclude "FHIRHelpers" version \'4.0.1\' called FHIRHelpers\n...\n// The Measure interval has closed boundaries. Read details https://cql.hl7.org/02-authorsguide.html#interval-values\nparameter "Measurement Period" Interval<DateTime>\ncontext Patient\n...\ndefine "All Groups": [Group] G where G.type = \'person\'\ndefine "All Group Members": flatten("All Groups" G return (G.member M return M.entity))\ndefine "Group": "All Groups" G return G.id\ndefine "Group Member": "All Group Members" G where "Patient Id" = Split(G.reference, \'/\')[1]\ndefine "Patients": {Patient}\n\ndefine "Males": Patient.gender=\'male\'\ndefine "Females": Patient.gender=\'female\'\n\ndefine "Age": CalculateAgeInYearsAt(Patient.birthDate, ToDate("Measurement Period".high))\n\ndefine "Age Stratifier":\n  case\n    when "Age" < 1 then \'P0Y\'\n    ....\n  end\n')),(0,n.kt)("p",null,"The CQL is referenced by url into Measure. The CQL is translated into elm-json and uploaded a Library on server. There are multiple ways to get elm for CQL. (elm-xml is also a valid standard but it is not recognized by android fhir libraries yet)"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"CQL to ELM REST Translator")),(0,n.kt)("p",null,"A ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/cqframework/cql-translation-service/blob/master/README.md"},"elm REST app")," that can be used to run elm microservice and convert CQL via a REST API. "),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"CQL to ELM JAVA Translator")),(0,n.kt)("p",null,"A ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/cqframework/clinical_quality_language/blob/master/Src/java/READM.md"},"elm java app")," that can be used to elm translator on files and get an output. Instructions can be found ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/cqframework/cql-execution#to-execute-your-cql"},"here")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"*Note")," : Above approaches output a json elm which then need to be base64 decoded and copied to the ",(0,n.kt)("a",{parentName:"p",href:"http://hl7.org/fhir/R4/library.html"},"Library")," content as Attachment.*"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"How to Test your CQL Script")),(0,n.kt)("p",null,"The ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/opensrp/fhir-resources/blob/main/fhircore-testing"},"fhir-resources")," repository has a testing module which allows to not only get the complete Library resource to directly save to server but also allows to test the Measure output and make changes on the fly. Check the cucumber tests ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/opensrp/fhir-resources/blob/main/fhircore-testing/src/test/resources/measure-report/household-members.feature"},"Feature File"),", the ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/opensrp/fhir-resources/blob/main/fhircore-testing/src/test/kotlin/com/fhircore/resources/testing/measure/HouseholdMembersMeasureTest.kt#L28"},"Test Code File")," and the ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/opensrp/fhir-resources/blob/main/fhircore-testing/src/test/kotlin/com/fhircore/resources/testing/CqlUtils.kt#L31"},"Convertor Util Method")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"FHIR Core Unit Tests")),(0,n.kt)("p",null,"The CQL can also be translated to Library using an approach as used by FHIR Core as in ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/opensrp/fhircore/blob/main/android/quest/src/test/java/org/smartregister/fhircore/quest/CqlContentTest.kt#L57"},"CQL Content Tests"),". A complete Library resource is output to console as a result."),(0,n.kt)("h2",{id:"testing-the-measure-cql-library"},"Testing the Measure CQL Library"),(0,n.kt)("p",null,"To make sure your Measure and Library are working and have been validated data, it is best to thoroughly test the input and output first so that multiple updates to server can be avoided and an easy and quick test driven approach is opted to implement your new functionality. The fhir-resources ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/opensrp/fhir-resources"},"repository")," has a testing module which implements Cucumber tests to help facilitate this. "),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Checkout ",(0,n.kt)("a",{parentName:"li",href:"https://github.com/opensrp/fhir-resources"},"fhir-resources")," Repository "),(0,n.kt)("li",{parentName:"ul"},"Open module fhircore-testing into Intellij or VS Code"),(0,n.kt)("li",{parentName:"ul"},"Install Cucumber plugin (optional and allows to run feature file directly)"),(0,n.kt)("li",{parentName:"ul"},"The module has a lot of helper functions to allow creating sample data and testing basic MeasureReport output. if you understand Cucumber you can add a complete custom test as well"),(0,n.kt)("li",{parentName:"ul"},"Add you test feature file to fhircore-testing/src/test/resources/measure-report/ i.e. fhircore-testing/src/test/resources/measure-report/household-members.feature")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},'Feature: Household Members Count by Age group\n\n  Scenario: Household members in household disaggregated by age group\n    Given Household Members CQL is "ecbis/measure_cql/household_measure_reporting.cql"\n    Given Household Members Measure is "ecbis/measure/household_measure.fhir.json"\n    Given Household Members Sample Bundle has 19 Groups; of them 17 active person\n    Given Household Members Sample Bundle has 16 Group Members gender "male" active aged\n      | 0 | 1 | 4 | 5 | 6 | 9 | 14 | 15 | 16 | 25 | 34 | 40 | 49 | 50 | 51 | 55 |\n    Given Household Members Sample Bundle has 21 Group Members gender "female" active aged\n      | 0 | 1 | 2 | 4 | 5 | 6 | 7 | 9 | 14 | 15 | 16 | 21 | 25 | 34 | 40 | 44 | 48 | 49 | 50 | 51 | 55 |\n    When Household Members Measure is run\n    Then Household Members Measure Report has "evaluatedResource.count()" = "17"\n    Then Household Members Measure Report has "group.count()" = "2"\n    Then Household Members Measure Report has "group.where(id=\'males\').population[0].count" = "37"\n    Then Household Members Measure Report has "group.where(id=\'males\').population[1].count" = "37"\n    Then Household Members Measure Report has "group.where(id=\'males\').population[2].count" = "16"\n    Then Household Members Measure Report has "group.where(id=\'females\').population[0].count" = "37"\n    Then Household Members Measure Report has "group.where(id=\'females\').population[1].count" = "37"\n    Then Household Members Measure Report has "group.where(id=\'females\').population[2].count" = "21"\n')),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"'Household Members' is the TAG. This should match your Measure core functionality"),(0,n.kt)("li",{parentName:"ul"},"'ecbis/measure_cql/household_measure_reporting.cql' is cql path. This should be the path from main dir i.e. fhir-resources where your cql resides"),(0,n.kt)("li",{parentName:"ul"},"'ecbis/measure/household_measure.fhir.json' is measure path. This should be the path from main dir i.e. fhir-resources where your measure resides"),(0,n.kt)("li",{parentName:"ul"},"Change test data as per your requirements. You can change values into double quotes, int values, or in data tables as per your test requirements"),(0,n.kt)("li",{parentName:"ul"},"Make sure to use same Step definition convention i.e. Given ",(0,n.kt)("inlineCode",{parentName:"li"},"TAG"),' CQL is "',(0,n.kt)("inlineCode",{parentName:"li"},"cql-path"),'" OR Given ',(0,n.kt)("inlineCode",{parentName:"li"},"TAG"),' Measure is "',(0,n.kt)("inlineCode",{parentName:"li"},"measure path"),'". Otherwise you would need to write your own Steps into YourTagTest.kt file using standard defined in ',(0,n.kt)("a",{parentName:"li",href:"https://medium.com/@mlvandijk/kukumber-getting-started-with-cucumber-in-kotlin-e55112e7309b"},"Cucumber Tutorial")),(0,n.kt)("li",{parentName:"ul"},"The assertions should also use same Step convention. i.e. Then ",(0,n.kt)("inlineCode",{parentName:"li"},"TAG"),' Measure Report has "',(0,n.kt)("inlineCode",{parentName:"li"},"your-fhirpath-in-measure-report"),'" = "',(0,n.kt)("inlineCode",{parentName:"li"},"expected-size"),'". Or you can add additional assertions to Test code file as in ',(0,n.kt)("inlineCode",{parentName:"li"},"Then")," section below"),(0,n.kt)("li",{parentName:"ul"},"Add your test file to kotlin/com/fhircore/resources/testing/measure/YourMeasureNameTest.kt i.e. kotlin/com/fhircore/resources/testing/measure/HouseholdMembersMeasureTest.kt")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"*Note")," The feature-file name should match with test-file name i.e. household-members.feature corresponds to HouseholdMembersMeasureTest.kt*"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},'@RunWith(Cucumber::class)\n@CucumberOptions(\n  features = ["src/test/resources/measure-report/household-members.feature"], tags = "not @ignored"\n)\nclass HouseholdMembersMeasureTest : En {\n  private val measureContext = MeasureContext().apply { withMeasurePeriod("2022-01-01", "2022-07-15") }\n\n  private val TAG = "Household Members"\n\n  init {\n    measureContext.givenCql(TAG) // helper step definition to load and print Library in console\n    measureContext.givenMeasure(TAG) // helper step definition to load and print Measure in console\n\n    // add your test data below. you can add custom code as well to load data of your choice\n    measureContext.givenGroupsXHavingYActivePerson(TAG) // helper step definition to add households test data\n    measureContext.givenGroupMembersXHavingGenderYAndAgesZ(TAG) // helper step definition to add household members, patients test data\n\n    // helper step definition to run measure of given type and print report in console\n    measureContext.whenMeasureRun(TAG, MeasureEvalType.POPULATION)\n\n    // helper step definition to add assertions. You can add custom assertions as well to test complex data\n    Then("Household Members Measure Report has {string} = {string}") { path: String, value: String ->\n      measureContext.thenMeasureReportHas(path, value)\n\n      // Add additional assertions if needed\n      // assertEquals(0.5, measureContext.measureReport.group.first().measureScore)\n    }\n  }\n}\n')),(0,n.kt)("p",null,"The final working Library, Measure, and MeasureReport are printed to console which can be copied and POST/PUT to server. "),(0,n.kt)("h5",{id:"evaluate-measure-operation"},(0,n.kt)("strong",{parentName:"h5"},"$evaluate-measure operation")),(0,n.kt)("p",null,"The $evaluate-measure operation is used to calculate an eMeasure and obtain the results"),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Parameters")),(0,n.kt)("table",null,(0,n.kt)("tr",null,(0,n.kt)("td",null,(0,n.kt)("strong",null,"Use")),(0,n.kt)("td",null,(0,n.kt)("strong",null,"Name")),(0,n.kt)("td",null,(0,n.kt)("strong",null,"Cardinality")),(0,n.kt)("td",null,(0,n.kt)("strong",null,"Type")),(0,n.kt)("td",null,(0,n.kt)("strong",null,"Documentation"))),(0,n.kt)("tr",null,(0,n.kt)("td",null,"IN"),(0,n.kt)("td",null,"periodStart"),(0,n.kt)("td",null,"1..1"),(0,n.kt)("td",null,(0,n.kt)("a",{href:"https://www.hl7.org/fhir/datatypes.html#date"},"date")),(0,n.kt)("td",null,"The start of the measurement period. In keeping with the semantics of the date parameter used in the FHIR search operation, the period will start at the beginning of the period implied by the supplied timestamp. E.g. a value of 2014 would set the period start to be 2014-01-01T00:00:00 inclusive")),(0,n.kt)("tr",null,(0,n.kt)("td",null,"IN"),(0,n.kt)("td",null,"periodEnd"),(0,n.kt)("td",null,"1..1"),(0,n.kt)("td",null,(0,n.kt)("a",{href:"https://www.hl7.org/fhir/datatypes.html#date"},"date")),(0,n.kt)("td",null,"The end of the measurement period. The period will end at the end of the period implied by the supplied timestamp. E.g. a value of 2014 would set the period end to be 2014-12-31T23:59:59 inclusive")),(0,n.kt)("tr",null,(0,n.kt)("td",null,"IN"),(0,n.kt)("td",null,"measure"),(0,n.kt)("td",null,"0..1"),(0,n.kt)("td",null,(0,n.kt)("a",{href:"https://www.hl7.org/fhir/datatypes.html#string"},"string"),"(",(0,n.kt)("a",{href:"https://www.hl7.org/fhir/search.html#reference"},"reference"),")"),(0,n.kt)("td",null,"The measure to evaluate. This parameter is only required when the operation is invoked on the resource type, it is not used when invoking the operation on a Measure instance")),(0,n.kt)("tr",null,(0,n.kt)("td",null,"IN"),(0,n.kt)("td",null,"reportType"),(0,n.kt)("td",null,"0..1"),(0,n.kt)("td",null,(0,n.kt)("a",{href:"https://www.hl7.org/fhir/datatypes.html#code"},"code")),(0,n.kt)("td",null,"The type of measure report: subject, subject-list, or population. If not specified, a default value of subject will be used if the subject parameter is supplied, otherwise, population will be used")),(0,n.kt)("tr",null,(0,n.kt)("td",null,"IN"),(0,n.kt)("td",null,"subject"),(0,n.kt)("td",null,"0..1"),(0,n.kt)("td",null,(0,n.kt)("a",{href:"https://www.hl7.org/fhir/datatypes.html#string"},"string"),(0,n.kt)("p",null,"(",(0,n.kt)("a",{href:"https://www.hl7.org/fhir/search.html#reference"},"reference"),")")),(0,n.kt)("td",null,"Subject for which the measure will be calculated. If not specified, the measure will be calculated for all subjects that meet the requirements of the measure. If specified, the measure will only be calculated for the referenced subject(s)")),(0,n.kt)("tr",null,(0,n.kt)("td",null,"IN"),(0,n.kt)("td",null,"practitioner"),(0,n.kt)("td",null,"0..1"),(0,n.kt)("td",null,(0,n.kt)("a",{href:"https://www.hl7.org/fhir/datatypes.html#string"},"string"),"(",(0,n.kt)("a",{href:"https://www.hl7.org/fhir/search.html#reference"},"reference"),")"),(0,n.kt)("td",null,"Practitioner for which the measure will be calculated. If specified, the measure will be calculated only for subjects that have a primary relationship to the identified practitioner")),(0,n.kt)("tr",null,(0,n.kt)("td",null,"IN"),(0,n.kt)("td",null,"lastReceivedOn"),(0,n.kt)("td",null,"0..1"),(0,n.kt)("td",null,(0,n.kt)("a",{href:"https://www.hl7.org/fhir/datatypes.html#dateTime"},"dateTime")),(0,n.kt)("td",null,"The date the results of this measure were last received. This parameter is only valid for patient-level reports and is used to indicate when the last time a result for this patient was received. This information can be used to limit the set of resources returned for a patient-level report")),(0,n.kt)("tr",null,(0,n.kt)("td",null,"OUT"),(0,n.kt)("td",null,"return"),(0,n.kt)("td",null,"1..1"),(0,n.kt)("td",null,(0,n.kt)("a",{href:"https://www.hl7.org/fhir/measurereport.html"},"MeasureReport")),(0,n.kt)("td",null,"The results of the measure calculation. See the MeasureReport resource for a complete description of the output of this operation. Note that implementations may choose to return a MeasureReport with a status of pending to indicate that the report is still being generated. In this case, the client can use a polling method to continually request the MeasureReport until the status is updated to complete"))),(0,n.kt)("p",null,"The effect of invoking this operation is to calculate the measure for the given subject, or all subjects if no subject is supplied, and return the results as a MeasureReport resource of the appropriate type. Note that whether or not this operation affects the state of the server depends on whether the server persists the generated MeasureReport. If the MeasureReport is not persisted, this operation can be invoked with GET"),(0,n.kt)("h2",{id:"the--measurereport-output"},"The  MeasureReport output"),(0,n.kt)("p",null,"The resulting MeasureReport of above Measure is ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/opensrp/fhir-resources/blob/main/ecbis/measure_report/household_measure_report.fhir.json"},"here"),". Some important components of report are below"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},'{\n  "resourceType": "MeasureReport",\n  "contained": [\n    {\n      "resourceType": "Observation", ...\n      "extension": [ {\n          "url": "http://hl7.org/fhir/StructureDefinition/cqf-measureInfo",\n          "extension": [...., {\n              "url": "populationId",\n              "valueString": "group"\n           } ]\n      } ],\n      "code": {\n        "coding": [ {\n            "code": "Group/1818d503-7226-45cb-9ac7-8c8609dd37c0/_history/3"\n        } ] \n      }, ...\n  } ],\n  "type": "summary",\n  "measure": "http://fhir.org/guides/who/anc-cds/Measure/HOUSEHOLDIND01",\n  "date": "2022-06-28T12:28:28+05:00",\n  "period": {\n    "start": "2022-01-01T00:00:00+05:00",\n    "end": "2022-06-28T23:59:59+05:00"\n  },\n  "group": [ {\n      "id": "males",\n      "population": [ {\n          "id": "initial-population",\n          "code": { ... },\n          "count": 136\n        }, {\n          "id": "denominator",\n          "code": { ... },\n          "count": 7\n        }, {\n          "id": "numerator",\n          "code": { ... },\n          "count": 3\n      } ],\n      "measureScore": { "value": 0.42857142857142855 },\n      "stratifier": [ {\n          "id": "by-age",\n          "stratum": [ {\n              "value": { "text": "P0Y" },\n              "population": [ {\n                  "id": "initial-population",\n                  "code": { ... },\n                  "count": 31\n                }, {\n                  "id": "denominator",\n                  "code": { ... },\n                  "count": 4\n                }, {\n                  "id": "numerator",\n                  "code": { ... },\n                  "count": 2\n              } ],\n              "measureScore": { "value": 0.5 }\n            }, { ... ... ... ...}\n              ]\n            }\n          ]\n        }\n      ]\n    }\n  ]\n}\n')),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Notable components of the MeasureReport")),(0,n.kt)("p",null,"Details of some notable fields in above MeasureReport (calculated from Measure) are "),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"contained"),": The Measure ",(0,n.kt)("a",{parentName:"p",href:"http://hl7.org/fhir/R4/measure-definitions.html#Measure.supplementalData"},"property")," ",(0,n.kt)("inlineCode",{parentName:"p"},"supplementalData")," is calculated for each measure ",(0,n.kt)("inlineCode",{parentName:"p"},"subject")," and output as an ",(0,n.kt)("a",{parentName:"p",href:"http://hl7.org/fhir/R4/observation.html"},"Observation")," having extension ",(0,n.kt)("a",{parentName:"p",href:"http://hl7.org/fhir/StructureDefinition/cqf-measureInfo"},"http://hl7.org/fhir/StructureDefinition/cqf-measureInfo")," with inner extension defining the variable requested i.e. ",(0,n.kt)("inlineCode",{parentName:"p"},"group")," in case above. The code.coding.code has the value of given variable ",(0,n.kt)("inlineCode",{parentName:"p"},"Group/1818d503-7226-45cb-9ac7-8c8609dd37c0/_history/3")," in example above")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"measure"),": The Measure.url for which this report was generated i.e. ",(0,n.kt)("a",{parentName:"p",href:"http://fhir.org/guides/who/anc-cds/Measure/HOUSEHOLDIND01"},"http://fhir.org/guides/who/anc-cds/Measure/HOUSEHOLDIND01"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"period"),": Measure period which was sent for date filter i.e. reporting period start and end. The Measure interval has closed boundaries. Read details ",(0,n.kt)("a",{parentName:"p",href:"https://cql.hl7.org/02-authorsguide.html#interval-values"},"here")," ")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"group"),": The calculated value for each Measure indicator with"),(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},"id: id/name of group/indicator/stratifier as defined in Meaure. "),(0,n.kt)("li",{parentName:"ul"},"count: Calculated value from CQL for given variable"),(0,n.kt)("li",{parentName:"ul"},"measureScore: The percent/ratio of calculated value i.e. numerator/denomintor. Note that for stratifier the score denominator is stratifier denomintor rather than group denominator"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},(0,n.kt)("strong",{parentName:"p"},"stratifier"),": Count for given indicator disaggregated by each type. The stratifier misses the values where counts are zero. Hence if stratifier has predefined criteria, each should be a calculated as separate group. "))),(0,n.kt)("h2",{id:"fhir-core-integration"},"FHIR Core Integration"),(0,n.kt)("p",null,"Once your Measure, and Library is ready add these to sync_config.json to make sure that the Measure and all dependent Library resources are always synced."),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Save/Update Measure on server i.e. POST - ",(0,n.kt)("a",{parentName:"li",href:"https://your.fhir.server/fhir/Measure"},"https://your.fhir.server/fhir/Measure")," OR PUT - ",(0,n.kt)("a",{parentName:"li",href:"https://your.fhir.server/fhir/Measure/measure-id"},"https://your.fhir.server/fhir/Measure/measure-id")," "),(0,n.kt)("li",{parentName:"ol"},"Save/Update Library on server i.e. POST - ",(0,n.kt)("a",{parentName:"li",href:"https://your.fhir.server/fhir/Library"},"https://your.fhir.server/fhir/Library")," OR PUT - ",(0,n.kt)("a",{parentName:"li",href:"https://your.fhir.server/fhir/Library/library-id"},"https://your.fhir.server/fhir/Library/library-id")," "),(0,n.kt)("li",{parentName:"ol"},"Update the sync_config.json Debug or Binary config for your app with new your measure id, and library id as below")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},'  {\n    "resource": {\n      "resourceType": "SearchParameter",\n      "name": "_id",\n      "code": "_id",\n      "base": [\n        "Measure"\n      ]\n    },\n    "type": "token",\n    "expression": "133082,133104,{your-measure-id}"\n  },\n  ... ... ...\n  {\n    "resource": {\n      "resourceType": "SearchParameter",\n      "name": "_id",\n      "code": "_id",\n      "base": [\n        "Library"\n      ]\n    },\n    "type": "token",\n    "expression": "1753,133081,133105,{your-library-id},{any-helper-library-ids}"\n  }\n')),(0,n.kt)("ol",{start:4},(0,n.kt)("li",{parentName:"ol"},"Update the measure_report_config.json Debug or Binary config with your new measure so that it shows up in the list")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},'"reports": [\n  ... ... ...\n    {\n      "id": "new serial id in list",\n      "title": "Household Members",\n      "description": "Number of Households, Household members registered, disaggregated by age and gender for each age group",\n      "url": "http://fhir.org/guides/who/anc-cds/Measure/HOUSEHOLDIND01"\n    },\n    ... ... ... \n  ]\n')),(0,n.kt)("h2",{id:"screenshot-of-measurereport-on-fhir-core"},"Screenshot of MeasureReport on FHIR Core"),(0,n.kt)("img",{width:"200",height:"400",src:"https://user-images.githubusercontent.com/4829880/188478590-93474727-4ef2-4ba7-acfc-8eb6ac9e32d5.png"})," ",(0,n.kt)("img",{width:"200",height:"400",src:"https://user-images.githubusercontent.com/4829880/188478602-e3941d73-4582-43a2-bc24-423eb1253fe0.png"}))}h.isMDXComponent=!0}}]);
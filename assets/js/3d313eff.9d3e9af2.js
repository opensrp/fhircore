"use strict";(self.webpackChunkfhircore=self.webpackChunkfhircore||[]).push([[1998],{5006:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>c,frontMatter:()=>i,metadata:()=>a,toc:()=>l});var r=n(4848),s=n(8453);const i={title:"Save form as draft"},o=void 0,a={id:"engineering/app/configuring/forms/save-form-as-draft",title:"Save form as draft",description:"This is support for saving a form, that is in progress, as a draft.",source:"@site/docs/engineering/app/configuring/forms/save-form-as-draft.mdx",sourceDirName:"engineering/app/configuring/forms",slug:"/engineering/app/configuring/forms/save-form-as-draft",permalink:"/engineering/app/configuring/forms/save-form-as-draft",draft:!1,unlisted:!1,editUrl:"https://github.com/opensrp/fhircore/tree/main/docs/engineering/app/configuring/forms/save-form-as-draft.mdx",tags:[],version:"current",frontMatter:{title:"Save form as draft"},sidebar:"defaultSidebar",previous:{title:"Forms",permalink:"/engineering/app/configuring/forms/"},next:{title:"Unique ID assignment",permalink:"/engineering/app/configuring/forms/unique-ids"}},d={},l=[{value:"Sample use cases",id:"sample-use-cases",level:2},{value:"Config properties",id:"config-properties",level:2},{value:"UI/UX workflow for saving a form as draft",id:"uiux-workflow-for-saving-a-form-as-draft",level:3},{value:"Alert dialog buttons descriptions",id:"alert-dialog-buttons-descriptions",level:4},{value:"Launching save draft from DELETE_DRAFT_QUESTIONNAIRE workflow",id:"launching-save-draft-from-delete_draft_questionnaire-workflow",level:2},{value:"UI/UX workflow for deleting a draft form",id:"uiux-workflow-for-deleting-a-draft-form",level:3},{value:"Propagating deletes to other devices",id:"propagating-deletes-to-other-devices",level:3}];function h(e){const t={code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.p,{children:"This is support for saving a form, that is in progress, as a draft."}),"\n",(0,r.jsx)(t.p,{children:'This functionality is only relevant to forms that are unique and only expected to be filled out once.\nThis excludes forms such as "register client" or "register household".'}),"\n",(0,r.jsx)(t.h2,{id:"sample-use-cases",children:"Sample use cases"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"A counseling session cannot be completed in one sitting, so the counselor would like to save the incomplete session and continue it in the next session"}),"\n",(0,r.jsx)(t.li,{children:"A health care worker does not have the answer to a mandatory question (e.g. lab results) and cannot submit the form until it is answered; they also do not want to discard the data they have already entered"}),"\n",(0,r.jsx)(t.li,{children:"A patient meets with multiple providers during a clinic visit. They would like the ability for the form to be started by one worker and completed by another worker"}),"\n",(0,r.jsx)(t.li,{children:"A health care worker is doing a child visit and the mother goes to get the child's health card to update the immunization history. Meanwhile, the health care worker wants to proceed to measure the child's MUAC (which is collected in a different form)"}),"\n",(0,r.jsx)(t.li,{children:"A health care worker is doing a household visit and providing care to multiple household members. They want the ability to start a workflow and switch to another workflow without losing their data"}),"\n",(0,r.jsx)(t.li,{children:"A health care worker is required to collect data in both the app and on paper. They start a form in the app, but are under time pressure, so they fill out the paper form and plan to enter the data in the app later"}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["The save draft functionality can be configured using the ",(0,r.jsx)(t.code,{children:"LAUNCH_QUESTIONNAIRE"})," or the ",(0,r.jsx)(t.code,{children:"DELETE_DRAFT_QUESTIONNAIRE"})," workflow.\nThe configuration is done on the ",(0,r.jsx)(t.code,{children:"QuestionnaireConfig"}),".\nThe sample below demonstrates the configs that are required in order to save a form as a draft"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-json",children:'{\n  "actions": [\n    {\n      "trigger": "ON_CLICK",\n      "workflow": "LAUNCH_QUESTIONNAIRE",\n      "questionnaire": {\n        "id": "add-family-member",\n        "title": "Add Family Member",\n        "resourceIdentifier": "sample-house-id",\n        "resourceType": "Group",\n        "saveDraft": true\n      }\n    }\n  ]\n}\n'})}),"\n",(0,r.jsx)(t.h2,{id:"config-properties",children:"Config properties"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Property"}),(0,r.jsx)(t.th,{children:"Description"}),(0,r.jsx)(t.th,{style:{textAlign:"center"},children:"Required"}),(0,r.jsx)(t.th,{style:{textAlign:"center"},children:"Default"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"id"}),(0,r.jsx)(t.td,{children:"Questionnaire Unique ID String"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"yes"}),(0,r.jsx)(t.td,{style:{textAlign:"center"}})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"title"}),(0,r.jsx)(t.td,{children:"Display text shown when the form is loaded"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"no"}),(0,r.jsx)(t.td,{style:{textAlign:"center"}})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"resourceIdentifier"}),(0,r.jsx)(t.td,{children:"Unique ID String for the subject of the form"}),(0,r.jsx)(t.td,{style:{textAlign:"center"}}),(0,r.jsx)(t.td,{style:{textAlign:"center"}})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"resourceType"}),(0,r.jsx)(t.td,{children:"The String representation of the resource type for the subject of the form"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"yes"}),(0,r.jsx)(t.td,{style:{textAlign:"center"}})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"saveDraft"}),(0,r.jsx)(t.td,{children:"Flag that determines whether the form can be saved as a draft"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"yes"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"false"})]})]})]}),"\n",(0,r.jsx)(t.h3,{id:"uiux-workflow-for-saving-a-form-as-draft",children:"UI/UX workflow for saving a form as draft"}),"\n",(0,r.jsxs)(t.p,{children:["When the form is opened, with the configurations in place, the save as draft functionality is triggered when the user clicks on the close button (X) at the top left of the screen.\nA dialog appears with 3 buttons i.e ",(0,r.jsx)(t.code,{children:"Save as draft"}),", ",(0,r.jsx)(t.code,{children:"Discard changes"})," and ",(0,r.jsx)(t.code,{children:"Cancel"}),"."]}),"\n",(0,r.jsx)(t.p,{children:"The table below details what each of the buttons does."}),"\n",(0,r.jsx)(t.h4,{id:"alert-dialog-buttons-descriptions",children:"Alert dialog buttons descriptions"}),"\n",(0,r.jsx)(t.p,{children:"|Button | Description |\n|--|--|:--:|:--:|\nSave as draft | Saves user input as a draft |\nDiscard changes | Dismisses user input, and closes the form without saving the draft. |\nCancel | Dismisses the dialog so that the user can continue interacting with the form |"}),"\n",(0,r.jsx)(t.h2,{id:"launching-save-draft-from-delete_draft_questionnaire-workflow",children:"Launching save draft from DELETE_DRAFT_QUESTIONNAIRE workflow"}),"\n",(0,r.jsxs)(t.p,{children:["The save draft functionality works the same as described above when launched using the ",(0,r.jsx)(t.code,{children:"DELETE_DRAFT_QUESTIONNAIRE"})," workflow.\nThe workflow adds another dialog that allows the user to either open or delete the draft.\nThe sample below demonstrates the configs that are required in order to save a form as a draft and also delete the draft."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-json",children:'{\n  "actions": [\n    {\n      "trigger": "ON_CLICK",\n      "workflow": "DELETE_DRAFT_QUESTIONNAIRE",\n      "questionnaire": {\n        "id": "add-family-member",\n        "title": "Add Family Member",\n        "resourceIdentifier": "sample-house-id",\n        "resourceType": "Group",\n        "saveDraft": true\n      }\n    }\n  ]\n}\n'})}),"\n",(0,r.jsx)(t.h3,{id:"uiux-workflow-for-deleting-a-draft-form",children:"UI/UX workflow for deleting a draft form"}),"\n",(0,r.jsxs)(t.p,{children:["When the ",(0,r.jsx)(t.code,{children:"DELETE_DRAFT_QUESTIONNAIRE"})," workflow is configured, a dialog appears when the call to action is triggered.\nThe dialog has 3 buttons i.e ",(0,r.jsx)(t.code,{children:"Open draft"}),", ",(0,r.jsx)(t.code,{children:"Delete draft"})," and ",(0,r.jsx)(t.code,{children:"Cancel"}),"."]}),"\n",(0,r.jsx)(t.p,{children:"The table below details what each of the buttons does."}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{style:{textAlign:"left"},children:"Button"}),(0,r.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"Open draft"}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"Opens the questionnaire pre-filled with the saved draft changes"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"Delete draft"}),(0,r.jsxs)(t.td,{style:{textAlign:"left"},children:["Does a soft delete of the draft i.e update the status of the ",(0,r.jsx)(t.code,{children:"QuestionnaireResponse"})," to ",(0,r.jsx)(t.code,{children:"stopped"})]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"Cancel"}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"Dismisses the dialog"})]})]})]}),"\n",(0,r.jsx)(t.h3,{id:"propagating-deletes-to-other-devices",children:"Propagating deletes to other devices"}),"\n",(0,r.jsx)(t.p,{children:"Since the devices work offline, there is a chance that a draft that has been deleted on device A could have some local changes on a device B.\nDue to the way conflict resolution works, at the moment, when device B syncs the changes that indicate the draft has been deleted will not reflect on device B.\nWith this in mind, Event Management is used to update the deleted drafts in the background."}),"\n",(0,r.jsxs)(t.p,{children:["The following is a sample config that would be added to the ",(0,r.jsx)(t.code,{children:"application_config.json"})]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:'{\n  "eventWorkflows": [\n    {\n      "eventType": "RESOURCE_CLOSURE",\n      "triggerConditions": [\n      ],\n      "eventResources": [\n        {\n          "id": "draftFormToBeClosed",\n          "resource": "AuditEvent",\n          "dataQueries": [\n            {\n              "paramName": "type",\n              "filterCriteria": [\n                {\n                  "dataType": "CODE",\n                  "value": {\n                    "system": "http://smartregister.org/",\n                    "code": "delete_draft"\n                  }\n                }\n              ]\n            }\n          ],\n          "relatedResources": [\n            {\n              "resource": "QuestionnaireResponse",\n              "searchParameter": "entity",\n              "isRevInclude": false\n            }\n          ]\n        }\n      ],\n      "updateValues": [\n        {\n          "jsonPathExpression": "QuestionnaireResponse.status",\n          "value": "stopped",\n          "resourceType": "QuestionnaireResponse"\n        }\n      ],\n      "resourceFilterExpressions": []\n    }\n  ]\n}\n'})}),"\n",(0,r.jsxs)(t.p,{children:["An ",(0,r.jsx)(t.code,{children:"AuditEvent"})," resource is used to keep track of deleted drafts. It has a reference to the ",(0,r.jsx)(t.code,{children:"QuestionnaireResponse"})," in the ",(0,r.jsx)(t.code,{children:"entity"})," field.\nThe event management functionality fetches all the ",(0,r.jsx)(t.code,{children:"AuditEvents"})," that have the ",(0,r.jsx)(t.code,{children:"type"})," = ",(0,r.jsx)(t.code,{children:"delete_draft"}),".\nThen fetches the related ",(0,r.jsx)(t.code,{children:"QuestionnaireResponses"})," by doing a forward include search on the ",(0,r.jsx)(t.code,{children:"QuestionnaireResponse.entity"})," field.\nThe status for the retrieved ",(0,r.jsx)(t.code,{children:"QuestionnaireResponses"})," is then updated to ",(0,r.jsx)(t.code,{children:"stopped"})," i.e the draft is soft deleted."]})]})}function c(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>a});var r=n(6540);const s={},i=r.createContext(s);function o(e){const t=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(i.Provider,{value:t},e.children)}}}]);
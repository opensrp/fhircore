name: Manual APK Release
run-name: Generating a FHIR Core Release APK ðŸš€
on: [push]
jobs:
   build:
      runs-on: ubuntu-latest
      permissions:
         id-token: write
         contents: read
      steps:
         - uses: actions/checkout@v3
         - name: Import Secrets from Vault
           id: import-secrets
           uses: hashicorp/vault-action@v2.8.0
           with:
              url: https://vault.onalabs.org
              token: ${{ secrets.VAULT_TOKEN }}
              # caCertificate: ${{ secrets.VAULT_CA_CERT }}
              tlsSkipVerify: true
              secrets: |
                kv-v2-fhircore/data/fhircore_apk_credentials KEYSTORE_ALIAS | KEYSTORE_ALIAS;
                kv-v2-fhircore/data/fhircore_apk_credentials KEYSTORE_FILE | KEYSTORE_FILE;
                kv-v2-fhircore/data/fhircore_apk_credentials KEYSTORE_PASSWORD | KEYSTORE_PASSWORD;
                kv-v2-fhircore/data/fhircore_apk_credentials KEY_PASSWORD | KEY_PASSWORD;
                kv-v2-fhircore/data/fhircore_apk_credentials LOCAL_PROPERTIES_FILE | LOCAL_PROPERTIES_FILE;
         - name: Test secret from Vault
           id: test-secret
           run: |
              echo '${{steps.import-secrets.outputs.KEYSTORE_ALIAS}}'         

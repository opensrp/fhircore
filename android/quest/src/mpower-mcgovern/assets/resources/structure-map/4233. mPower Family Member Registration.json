{
  "resourceType": "StructureMap",
  "id": "4233",
  "url": "http://fhir.mpower-social.com:7070/fhir/StructureMap/4233",
  "name": "mPower Family Member Registration",
  "structure": [
    {
      "url": "http://hl7.org/fhir/StructureDefinition/QuestionnaireReponse",
      "mode": "source"
    },
    {
      "url": "http://hl7.org/fhir/StructureDefinition/Bundle",
      "mode": "target"
    },
    {
      "url": "http://hl7.org/fhir/StructureDefinition/Patient",
      "mode": "target"
    }
  ],
  "group": [
    {
      "name": "mPowerFamilyMemberRegistration",
      "typeMode": "none",
      "input": [
        {
          "name": "src",
          "type": "QuestionnaireResponse",
          "mode": "source"
        },
        {
          "name": "bundle",
          "type": "Bundle",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "rule_bundle_id",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "bundle",
              "contextType": "variable",
              "element": "id",
              "transform": "uuid"
            }
          ]
        },
        {
          "name": "rule_bundle_type",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "bundle",
              "contextType": "variable",
              "element": "type",
              "transform": "copy",
              "parameter": [
                {
                  "valueString": "collection"
                }
              ]
            }
          ]
        },
        {
          "name": "rule_bundle_entries",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "bundle",
              "contextType": "variable",
              "element": "entry",
              "variable": "entry"
            },
            {
              "context": "entry",
              "contextType": "variable",
              "element": "resource",
              "variable": "patient",
              "transform": "create",
              "parameter": [
                {
                  "valueString": "Patient"
                }
              ]
            }
          ],
          "dependent": [
            {
              "name": "ExtractPatient",
              "variable": [
                "src",
                "patient",
                "bundle"
              ]
            },
            {
              "name": "ExtractObservations",
              "variable": [
                "src",
                "bundle"
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "ExtractPatient",
      "typeMode": "none",
      "input": [
        {
          "name": "src",
          "type": "QuestionnaireResponse",
          "mode": "source"
        },
        {
          "name": "patient",
          "type": "Patient",
          "mode": "target"
        },
        {
          "name": "bundle",
          "type": "Bundle",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "rule_patient_id_generation",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "patient",
              "contextType": "variable",
              "element": "id",
              "transform": "uuid"
            }
          ]
        },
        {
          "name": "rule_patient_name",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "patient",
              "contextType": "variable",
              "element": "name",
              "variable": "patientName",
              "transform": "create",
              "parameter": [
                {
                  "valueString": "HumanName"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "rule_patient_name",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "patientName",
                  "contextType": "variable",
                  "element": "text",
                  "transform": "evaluate",
                  "parameter": [
                    {
                      "valueId": "src"
                    },
                    {
                      "valueString": "$this.item.where(linkId = 'e6306275-b989-4375-8527-3a56092081b8').answer.value"
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_patient_name_use",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "patientName",
                  "contextType": "variable",
                  "element": "use",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueString": "official"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "rule_patient_identifier_opensrp",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "patient",
              "contextType": "variable",
              "element": "identifier",
              "variable": "patientIdentifierOpenSRPId",
              "transform": "create",
              "parameter": [
                {
                  "valueString": "Identifier"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "rule_patient_identifier_opensrp_id_value",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "patientIdentifierOpenSRPId",
                  "contextType": "variable",
                  "element": "value",
                  "transform": "evaluate",
                  "parameter": [
                    {
                      "valueId": "src"
                    },
                    {
                      "valueString": "$this.item.where(linkId = 'ed77104e-c279-4030-ab20-8cd99ca99ca9').answer.value"
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_patient_identifier_opensrp_id_use",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "patientIdentifierOpenSRPId",
                  "contextType": "variable",
                  "element": "use",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueString": "official"
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_patient_identifier_period",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "patientIdentifierOpenSRPId",
                  "contextType": "variable",
                  "element": "period",
                  "variable": "period",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "Period"
                    }
                  ]
                },
                {
                  "context": "period",
                  "contextType": "variable",
                  "element": "start",
                  "transform": "evaluate",
                  "parameter": [
                    {
                      "valueId": "src"
                    },
                    {
                      "valueString": "$this.authored"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "rule_patient_identifier_family_id",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "patient",
              "contextType": "variable",
              "element": "identifier",
              "variable": "patientIdentifierFamilyId",
              "transform": "create",
              "parameter": [
                {
                  "valueString": "Identifier"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "rule_patient_identifier_family_id_value",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "patientIdentifierFamilyId",
                  "contextType": "variable",
                  "element": "value",
                  "transform": "evaluate",
                  "parameter": [
                    {
                      "valueId": "src"
                    },
                    {
                      "valueString": "$this.item.where(linkId = '2588ee71-9699-440d-8364-6ac7c1e63ccd').answer.value"
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_patient_identifier_family_id_use",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "patientIdentifierFamilyId",
                  "contextType": "variable",
                  "element": "use",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueString": "temp"
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_patient_identifier_period",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "patientIdentifierFamilyId",
                  "contextType": "variable",
                  "element": "period",
                  "variable": "period",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "Period"
                    }
                  ]
                },
                {
                  "context": "period",
                  "contextType": "variable",
                  "element": "start",
                  "transform": "evaluate",
                  "parameter": [
                    {
                      "valueId": "src"
                    },
                    {
                      "valueString": "$this.authored"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "rule_patient_identifier_government_id",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "patient",
              "contextType": "variable",
              "element": "identifier",
              "variable": "patientIdentifierGovernmentId",
              "transform": "create",
              "parameter": [
                {
                  "valueString": "Identifier"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "rule_patient_identifier_national_id",
              "source": [
                {
                  "context": "src",
                  "element": "item",
                  "variable": "patient_national_id",
                  "condition": "(linkId = '7a31ee75-e1eb-4037-8f69-c8fd5a06fc32')"
                }
              ],
              "rule": [
                {
                  "name": "rule_patient_identifier_government_id_value",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "patientIdentifierGovernmentId",
                      "contextType": "variable",
                      "element": "value",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "patient_national_id"
                        },
                        {
                          "valueString": "$this.answer.value"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "rule_patient_identifier_government_id_type",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "patientIdentifierGovernmentId",
                      "contextType": "variable",
                      "element": "type",
                      "variable": "concept",
                      "transform": "create",
                      "parameter": [
                        {
                          "valueString": "CodeableConcept"
                        }
                      ]
                    }
                  ],
                  "rule": [
                    {
                      "name": "rule_patient_identifier_government_id_type_cod",
                      "source": [
                        {
                          "context": "src"
                        }
                      ],
                      "target": [
                        {
                          "context": "concept",
                          "contextType": "variable",
                          "element": "coding",
                          "variable": "coding",
                          "transform": "c",
                          "parameter": [
                            {
                              "valueString": "http://www.nidw.gov.bd/"
                            },
                            {
                              "valueString": "11111111"
                            }
                          ]
                        }
                      ],
                      "rule": [
                        {
                          "name": "rule_patient_identifier_government_id_type_cod_display",
                          "source": [
                            {
                              "context": "src"
                            }
                          ],
                          "target": [
                            {
                              "context": "coding",
                              "contextType": "variable",
                              "element": "display",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueString": "National ID"
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_patient_identifier_birth_id",
              "source": [
                {
                  "context": "src",
                  "element": "item",
                  "variable": "patient_birth_id",
                  "condition": "(linkId = 'b2bad7a2-9757-423c-8b2a-e2c183d6e076')"
                }
              ],
              "rule": [
                {
                  "name": "rule_patient_identifier_government_id_value",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "patientIdentifierGovernmentId",
                      "contextType": "variable",
                      "element": "value",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "patient_birth_id"
                        },
                        {
                          "valueString": "$this.answer.value"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "rule_patient_identifier_government_id_type",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "patientIdentifierGovernmentId",
                      "contextType": "variable",
                      "element": "type",
                      "variable": "concept",
                      "transform": "create",
                      "parameter": [
                        {
                          "valueString": "CodeableConcept"
                        }
                      ]
                    }
                  ],
                  "rule": [
                    {
                      "name": "rule_patient_identifier_government_id_type_cod",
                      "source": [
                        {
                          "context": "src"
                        }
                      ],
                      "target": [
                        {
                          "context": "concept",
                          "contextType": "variable",
                          "element": "coding",
                          "variable": "coding",
                          "transform": "c",
                          "parameter": [
                            {
                              "valueString": "https://bdris.gov.bd/"
                            },
                            {
                              "valueString": "22222222"
                            }
                          ]
                        }
                      ],
                      "rule": [
                        {
                          "name": "rule_patient_identifier_government_id_type_cod_display",
                          "source": [
                            {
                              "context": "src"
                            }
                          ],
                          "target": [
                            {
                              "context": "coding",
                              "contextType": "variable",
                              "element": "display",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueString": "Birth Registration ID"
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_patient_identifier_national_id_use",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "patientIdentifierGovernmentId",
                  "contextType": "variable",
                  "element": "use",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueString": "usual"
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_patient_identifier_period",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "patientIdentifierGovernmentId",
                  "contextType": "variable",
                  "element": "period",
                  "variable": "period",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "Period"
                    }
                  ]
                },
                {
                  "context": "period",
                  "contextType": "variable",
                  "element": "start",
                  "transform": "evaluate",
                  "parameter": [
                    {
                      "valueId": "src"
                    },
                    {
                      "valueString": "$this.authored"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "rule_patient_identifier",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "patient",
              "contextType": "variable",
              "element": "identifier",
              "variable": "patientIdentifier",
              "transform": "create",
              "parameter": [
                {
                  "valueString": "Identifier"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "rule_patient_identifier_value",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "patientIdentifier",
                  "contextType": "variable",
                  "element": "value",
                  "transform": "uuid"
                }
              ]
            },
            {
              "name": "rule_patient_identifier_use",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "patientIdentifier",
                  "contextType": "variable",
                  "element": "use",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueString": "secondary"
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_patient_identifier_period",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "patientIdentifier",
                  "contextType": "variable",
                  "element": "period",
                  "variable": "period",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "Period"
                    }
                  ]
                },
                {
                  "context": "period",
                  "contextType": "variable",
                  "element": "start",
                  "transform": "evaluate",
                  "parameter": [
                    {
                      "valueId": "src"
                    },
                    {
                      "valueString": "$this.authored"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "rule_patient_gender",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "patient",
              "contextType": "variable",
              "element": "gender",
              "transform": "evaluate",
              "parameter": [
                {
                  "valueId": "src"
                },
                {
                  "valueString": "$this.item.where(linkId = '77e32953-0679-48b5-f004-1ab4a4ac0271').answer.value.code"
                }
              ]
            }
          ]
        },
        {
          "name": "rule_patient_dob",
          "source": [
            {
              "context": "src",
              "element": "item",
              "variable": "patient_dob",
              "condition": "(linkId = 'cd8e3d6d-e9ff-458d-d122-57070bebffaf')"
            }
          ],
          "rule": [
            {
              "name": "rule__first_patient_dob",
              "source": [
                {
                  "context": "patient_dob",
                  "element": "answer",
                  "listMode": "first",
                  "variable": "patientBirthDateAnswer"
                }
              ],
              "rule": [
                {
                  "name": "rule_patient_dob_answer",
                  "source": [
                    {
                      "context": "patientBirthDateAnswer",
                      "element": "value",
                      "variable": "val"
                    }
                  ],
                  "target": [
                    {
                      "context": "patient",
                      "contextType": "variable",
                      "element": "birthDate",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueId": "val"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "rule_calculate_new_date_today",
                  "source": [
                    {
                      "context": "src",
                      "element": "item",
                      "variable": "calculate_new_date_today"
                    }
                  ],
                  "target": [
                    {
                      "variable": "new_date",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "(today() - ((365 * 15).toString() + ' days').toQuantity())"
                        }
                      ]
                    }
                  ],
                  "rule": [
                    {
                      "name": "rule_patient_date_of_birth",
                      "source": [
                        {
                          "context": "calculate_new_date_today",
                          "variable": "patient_date_of_birth",
                          "condition": "(linkId = 'cd8e3d6d-e9ff-458d-d122-57070bebffaf')"
                        }
                      ],
                      "rule": [
                        {
                          "name": "rule_patient_date_of_birth_answer",
                          "source": [
                            {
                              "context": "patient_date_of_birth",
                              "element": "answer",
                              "listMode": "first",
                              "variable": "patient_date_of_birth_answer"
                            }
                          ],
                          "rule": [
                            {
                              "name": "rule_patient_date_of_birth_answer_value",
                              "source": [
                                {
                                  "context": "patient_date_of_birth_answer",
                                  "element": "value",
                                  "variable": "patient_date_of_birth_answer_value"
                                }
                              ],
                              "rule": [
                                {
                                  "name": "rule_patient_age_compare_with_today",
                                  "source": [
                                    {
                                      "context": "patient_date_of_birth_answer_value",
                                      "variable": "patient_age_compare_with_today",
                                      "condition": "(patient_date_of_birth_answer_value <= new_date)"
                                    }
                                  ],
                                  "rule": [
                                    {
                                      "name": "household_head_trigger_check",
                                      "source": [
                                        {
                                          "context": "src",
                                          "element": "item",
                                          "variable": "head_of_household_check",
                                          "condition": "((linkId = '1e1a206f-1cc2-4e48-8103-b26bf4bd7c3c') and (answer.value.code = 'yes'))"
                                        }
                                      ],
                                      "rule": [
                                        {
                                          "name": "rule_related_person_creation",
                                          "source": [
                                            {
                                              "context": "head_of_household_check"
                                            }
                                          ],
                                          "target": [
                                            {
                                              "context": "bundle",
                                              "contextType": "variable",
                                              "element": "entry",
                                              "variable": "entry"
                                            },
                                            {
                                              "context": "entry",
                                              "contextType": "variable",
                                              "element": "resource",
                                              "variable": "relatedPerson",
                                              "transform": "create",
                                              "parameter": [
                                                {
                                                  "valueString": "RelatedPerson"
                                                }
                                              ]
                                            }
                                          ],
                                          "rule": [
                                            {
                                              "name": "rule_related_person_reference",
                                              "source": [
                                                {
                                                  "context": "src"
                                                }
                                              ],
                                              "dependent": [
                                                {
                                                  "name": "ExtractRelatedPerson",
                                                  "variable": [
                                                    "patient",
                                                    "relatedPerson"
                                                  ]
                                                }
                                              ]
                                            }
                                          ]
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "rule_patient_age",
          "source": [
            {
              "context": "src",
              "element": "item",
              "variable": "patient_age",
              "condition": "((linkId = '8460d986-ef71-4997-80ee-7887d8c345e7') and (answer.value > 0))"
            }
          ],
          "target": [
            {
              "context": "patient",
              "contextType": "variable",
              "element": "birthDate",
              "transform": "evaluate",
              "parameter": [
                {
                  "valueId": "patient_age"
                },
                {
                  "valueString": "today() - (($this.answer.value * 365.5).toString() + ' days').toQuantity()"
                }
              ]
            }
          ]
        },
        {
          "name": "r_patient_age",
          "source": [
            {
              "context": "src",
              "element": "item",
              "variable": "patient_age",
              "condition": "((linkId = '8460d986-ef71-4997-80ee-7887d8c345e7') and (answer.value > 0))"
            }
          ],
          "rule": [
            {
              "name": "r_actual_dob",
              "source": [
                {
                  "context": "patient_age",
                  "variable": "age"
                }
              ],
              "target": [
                {
                  "variable": "actual_dob",
                  "transform": "evaluate",
                  "parameter": [
                    {
                      "valueId": "patient_age"
                    },
                    {
                      "valueString": "today() - (($this.answer.value * 365.5).toString() + ' days').toQuantity()"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "rule_calculate_new_date_today",
                  "source": [
                    {
                      "context": "patient_age",
                      "variable": "calculate_new_date_today"
                    }
                  ],
                  "target": [
                    {
                      "variable": "new_date",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "(today() - ((365 * 15).toString() + ' days').toQuantity())"
                        }
                      ]
                    }
                  ],
                  "rule": [
                    {
                      "name": "rule_patient_age_compare_with_today",
                      "source": [
                        {
                          "context": "patient_age",
                          "variable": "patient_age_compare_with_today",
                          "condition": "(actual_dob <= new_date)"
                        }
                      ],
                      "rule": [
                        {
                          "name": "household_head_trigger_check",
                          "source": [
                            {
                              "context": "src",
                              "element": "item",
                              "variable": "head_of_household_check",
                              "condition": "((linkId = '1e1a206f-1cc2-4e48-8103-b26bf4bd7c3c') and (answer.value.code = 'yes'))"
                            }
                          ],
                          "rule": [
                            {
                              "name": "rule_related_person_creation",
                              "source": [
                                {
                                  "context": "head_of_household_check"
                                }
                              ],
                              "target": [
                                {
                                  "context": "bundle",
                                  "contextType": "variable",
                                  "element": "entry",
                                  "variable": "entry"
                                },
                                {
                                  "context": "entry",
                                  "contextType": "variable",
                                  "element": "resource",
                                  "variable": "relatedPerson",
                                  "transform": "create",
                                  "parameter": [
                                    {
                                      "valueString": "RelatedPerson"
                                    }
                                  ]
                                }
                              ],
                              "rule": [
                                {
                                  "name": "rule_related_person_reference",
                                  "source": [
                                    {
                                      "context": "src"
                                    }
                                  ],
                                  "dependent": [
                                    {
                                      "name": "ExtractRelatedPerson",
                                      "variable": [
                                        "patient",
                                        "relatedPerson"
                                      ]
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "rule_patient_active",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "patient",
              "contextType": "variable",
              "element": "active",
              "transform": "copy",
              "parameter": [
                {
                  "valueBoolean": true
                }
              ]
            }
          ]
        },
        {
          "name": "rule_patient_tel",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "patient",
              "contextType": "variable",
              "element": "telecom",
              "variable": "patientContact",
              "transform": "create",
              "parameter": [
                {
                  "valueString": "ContactPoint"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "rule_patient_tel_num",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "patientContact",
                  "contextType": "variable",
                  "element": "value",
                  "transform": "evaluate",
                  "parameter": [
                    {
                      "valueId": "src"
                    },
                    {
                      "valueString": "$this.item.where(linkId = '3a731d3a-0da1-4f6e-8c18-286108c04300').answer.value"
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_patient_tel_sys",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "patientContact",
                  "contextType": "variable",
                  "element": "system",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueString": "phone"
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_patient_tel_use",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "patientContact",
                  "contextType": "variable",
                  "element": "use",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueString": "mobile"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "rule_patient_marital_status",
          "source": [
            {
              "context": "src",
              "element": "item",
              "variable": "patient_marital_status",
              "condition": "((linkId = 'c5cf7fd7-eccd-45b6-8875-10a3183da552') and answer.value.exists())"
            }
          ],
          "rule": [
            {
              "name": "rule_patient_marital_status_code_evaluate",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "variable": "statusCode",
                  "transform": "evaluate",
                  "parameter": [
                    {
                      "valueId": "patient_marital_status"
                    },
                    {
                      "valueString": "answer.value.code"
                    }
                  ]
                },
                {
                  "variable": "statusCodeDisplay",
                  "transform": "evaluate",
                  "parameter": [
                    {
                      "valueId": "patient_marital_status"
                    },
                    {
                      "valueString": "answer.value.display"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "rule_patient_marital_status_code",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "patient",
                      "contextType": "variable",
                      "element": "maritalStatus",
                      "variable": "concept",
                      "transform": "create",
                      "parameter": [
                        {
                          "valueString": "CodeableConcept"
                        }
                      ]
                    }
                  ],
                  "rule": [
                    {
                      "name": "r_en_cc_cod",
                      "source": [
                        {
                          "context": "src"
                        }
                      ],
                      "target": [
                        {
                          "context": "concept",
                          "contextType": "variable",
                          "element": "coding",
                          "variable": "coding",
                          "transform": "c",
                          "parameter": [
                            {
                              "valueString": "http://snomed.info/sct"
                            },
                            {
                              "valueId": "statusCode"
                            }
                          ]
                        }
                      ],
                      "rule": [
                        {
                          "name": "r_en_cod_disp",
                          "source": [
                            {
                              "context": "src"
                            }
                          ],
                          "target": [
                            {
                              "context": "coding",
                              "contextType": "variable",
                              "element": "display",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueId": "statusCodeDisplay"
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "rule_patient_relationship",
          "source": [
            {
              "context": "src",
              "element": "item",
              "variable": "household_relationship",
              "condition": "(((linkId = 'c33296ce-1abb-4685-8bd0-e7f7187f2e98') or (linkId = 'ffe83655-d445-471d-8172-c0d3bafb8940')) and answer.value.exists())"
            }
          ],
          "rule": [
            {
              "name": "rule_patient_relationship_extra",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "patient",
                  "contextType": "variable",
                  "element": "contact",
                  "variable": "contactRelationship",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "Patient_Contact"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "rule_patient_relationship_code_evaluate",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "variable": "relationDisplay",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "household_relationship"
                        },
                        {
                          "valueString": "answer.value.display"
                        }
                      ]
                    }
                  ],
                  "rule": [
                    {
                      "name": "rule_patient_relationship_status_code",
                      "source": [
                        {
                          "context": "src"
                        }
                      ],
                      "target": [
                        {
                          "context": "contactRelationship",
                          "contextType": "variable",
                          "element": "relationship",
                          "variable": "concept",
                          "transform": "create",
                          "parameter": [
                            {
                              "valueString": "CodeableConcept"
                            }
                          ]
                        }
                      ],
                      "rule": [
                        {
                          "name": "r_en_cc_cod",
                          "source": [
                            {
                              "context": "src"
                            }
                          ],
                          "target": [
                            {
                              "context": "concept",
                              "contextType": "variable",
                              "element": "coding",
                              "variable": "coding",
                              "transform": "c",
                              "parameter": [
                                {
                                  "valueString": "http://hl7.org/fhir/ValueSet/relatedperson-relationshiptype"
                                },
                                {
                                  "valueString": "relation-with-head"
                                }
                              ]
                            }
                          ],
                          "rule": [
                            {
                              "name": "r_en_cod_disp",
                              "source": [
                                {
                                  "context": "src"
                                }
                              ],
                              "target": [
                                {
                                  "context": "coding",
                                  "contextType": "variable",
                                  "element": "display",
                                  "transform": "copy",
                                  "parameter": [
                                    {
                                      "valueId": "relationDisplay"
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "rule_encounter_reference",
          "source": [
            {
              "context": "src"
            }
          ],
          "dependent": [
            {
              "name": "ExtractEncounter",
              "variable": [
                "patient",
                "bundle"
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "ExtractRelatedPerson",
      "typeMode": "none",
      "input": [
        {
          "name": "src",
          "type": "Patient",
          "mode": "source"
        },
        {
          "name": "relatedPerson",
          "type": "RelatedPerson",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "rule_related_person",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "relatedPerson",
              "contextType": "variable",
              "element": "id",
              "transform": "uuid"
            }
          ]
        },
        {
          "name": "rule_related_person_identifier",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "relatedPerson",
              "contextType": "variable",
              "element": "identifier",
              "variable": "relatedPersonIdentifier",
              "transform": "create",
              "parameter": [
                {
                  "valueString": "Identifier"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "rule_related_person_identifier_value",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "relatedPersonIdentifier",
                  "contextType": "variable",
                  "element": "value",
                  "transform": "uuid"
                }
              ]
            },
            {
              "name": "rule_related_person_identifier_use",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "relatedPersonIdentifier",
                  "contextType": "variable",
                  "element": "use",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueString": "secondary"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "rule_related_person_name",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "relatedPerson",
              "contextType": "variable",
              "element": "name",
              "variable": "relatedPersonName",
              "transform": "create",
              "parameter": [
                {
                  "valueString": "HumanName"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "rule_related_person_middle_name",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "relatedPersonName",
                  "contextType": "variable",
                  "element": "text",
                  "transform": "evaluate",
                  "parameter": [
                    {
                      "valueId": "src"
                    },
                    {
                      "valueString": "$this.name.text"
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_related_person_name_use",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "relatedPersonName",
                  "contextType": "variable",
                  "element": "use",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueString": "official"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "rule_related_person_active",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "relatedPerson",
              "contextType": "variable",
              "element": "active",
              "transform": "copy",
              "parameter": [
                {
                  "valueBoolean": true
                }
              ]
            }
          ]
        },
        {
          "name": "rule_related_person_relationship",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "relatedPerson",
              "contextType": "variable",
              "element": "relationship",
              "variable": "concept",
              "transform": "create",
              "parameter": [
                {
                  "valueString": "CodeableConcept"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "r_en_cc_cod",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "concept",
                  "contextType": "variable",
                  "element": "coding",
                  "variable": "coding",
                  "transform": "c",
                  "parameter": [
                    {
                      "valueString": "http://snomed.info/sct"
                    },
                    {
                      "valueString": "99990006"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "r_en_cod_disp",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "coding",
                      "contextType": "variable",
                      "element": "display",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "Family Head"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "rule_related_person_patient",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "relatedPerson",
              "contextType": "variable",
              "element": "patient",
              "variable": "ref",
              "transform": "create",
              "parameter": [
                {
                  "valueString": "Reference"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "rule_related_person_patient_ref",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "ref",
                  "contextType": "variable",
                  "element": "reference",
                  "transform": "evaluate",
                  "parameter": [
                    {
                      "valueId": "src"
                    },
                    {
                      "valueString": "'Patient/' + $this.id"
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_related_person_patient_ref_display",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "ref",
                  "contextType": "variable",
                  "element": "display",
                  "transform": "evaluate",
                  "parameter": [
                    {
                      "valueId": "src"
                    },
                    {
                      "valueString": "relatedPerson.name.given + ' ' + relatedPerson.name.text + ' ' + relatedPerson.name.family"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "ExtractEncounter",
      "typeMode": "none",
      "input": [
        {
          "name": "src",
          "type": "Patient",
          "mode": "source"
        },
        {
          "name": "bundle",
          "type": "Bundle",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "r_en",
          "source": [
            {
              "context": "src"
            }
          ],
          "target": [
            {
              "context": "bundle",
              "contextType": "variable",
              "element": "entry",
              "variable": "entry"
            },
            {
              "context": "entry",
              "contextType": "variable",
              "element": "resource",
              "variable": "encounter",
              "transform": "create",
              "parameter": [
                {
                  "valueString": "Encounter"
                }
              ]
            }
          ],
          "rule": [
            {
              "name": "r_en_id",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "encounter",
                  "contextType": "variable",
                  "element": "id",
                  "transform": "uuid"
                }
              ]
            },
            {
              "name": "r_en_st",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "encounter",
                  "contextType": "variable",
                  "element": "status",
                  "transform": "copy",
                  "parameter": [
                    {
                      "valueString": "finished"
                    }
                  ]
                }
              ]
            },
            {
              "name": "r_en_cls",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "encounter",
                  "contextType": "variable",
                  "element": "class",
                  "transform": "c",
                  "parameter": [
                    {
                      "valueString": "http://terminology.hl7.org/CodeSystem/v3-ActCode"
                    },
                    {
                      "valueString": "HH"
                    },
                    {
                      "valueString": "Home Health"
                    }
                  ]
                }
              ]
            },
            {
              "name": "r_en_typ",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "encounter",
                  "contextType": "variable",
                  "element": "type",
                  "variable": "concept",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "CodeableConcept"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "r_en_cc_cod",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "concept",
                      "contextType": "variable",
                      "element": "coding",
                      "variable": "coding",
                      "transform": "c",
                      "parameter": [
                        {
                          "valueString": "http://snomed.info/sct"
                        },
                        {
                          "valueString": "77386006"
                        }
                      ]
                    }
                  ],
                  "rule": [
                    {
                      "name": "r_en_cod_disp",
                      "source": [
                        {
                          "context": "src"
                        }
                      ],
                      "target": [
                        {
                          "context": "coding",
                          "contextType": "variable",
                          "element": "display",
                          "transform": "copy",
                          "parameter": [
                            {
                              "valueString": "Consultation"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_en_typ_text",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "concept",
                      "contextType": "variable",
                      "element": "text",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "Consultation"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "r_en_prio",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "encounter",
                  "contextType": "variable",
                  "element": "priority",
                  "variable": "concept",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "CodeableConcept"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "r_en_cc_cod",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "concept",
                      "contextType": "variable",
                      "element": "coding",
                      "variable": "coding",
                      "transform": "c",
                      "parameter": [
                        {
                          "valueString": "http://snomed.info/sct"
                        },
                        {
                          "valueString": "17621005"
                        }
                      ]
                    }
                  ],
                  "rule": [
                    {
                      "name": "r_en_cod_disp",
                      "source": [
                        {
                          "context": "src"
                        }
                      ],
                      "target": [
                        {
                          "context": "coding",
                          "contextType": "variable",
                          "element": "display",
                          "transform": "copy",
                          "parameter": [
                            {
                              "valueString": "Normal"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_en_prio_text",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "concept",
                      "contextType": "variable",
                      "element": "text",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "Normal"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "rule_encounter_subject",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "encounter",
                  "contextType": "variable",
                  "element": "subject",
                  "variable": "ref",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "Reference"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "rule_related_person_patient_ref",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "ref",
                      "contextType": "variable",
                      "element": "reference",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "'Patient/' + $this.id"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "r_en_per",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "encounter",
                  "contextType": "variable",
                  "element": "period",
                  "variable": "enPeriod",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "Period"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "r_en_per_start",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "enPeriod",
                      "contextType": "variable",
                      "element": "start",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "now()"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_en_per_end",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "enPeriod",
                      "contextType": "variable",
                      "element": "end",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "now()"
                        }
                      ]
                    }
                  ]
                }
              ]
            },
            {
              "name": "r_en_reason",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "encounter",
                  "contextType": "variable",
                  "element": "reasonCode",
                  "variable": "concept",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "CodeableConcept"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "r_en_rc_cod",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "concept",
                      "contextType": "variable",
                      "element": "coding",
                      "variable": "coding",
                      "transform": "c",
                      "parameter": [
                        {
                          "valueString": "http://smartregsiter.org/"
                        },
                        {
                          "valueString": "family_member_registration"
                        }
                      ]
                    }
                  ],
                  "rule": [
                    {
                      "name": "r_en_rc_cod_disp",
                      "source": [
                        {
                          "context": "src"
                        }
                      ],
                      "target": [
                        {
                          "context": "coding",
                          "contextType": "variable",
                          "element": "display",
                          "transform": "copy",
                          "parameter": [
                            {
                              "valueString": "mPower Family Member Registration"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_en_text",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "concept",
                      "contextType": "variable",
                      "element": "text",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "mPower Family Member Registration"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "ExtractObservations",
      "typeMode": "none",
      "input": [
        {
          "name": "src",
          "type": "QuestionnaireResponse",
          "mode": "source"
        },
        {
          "name": "bundle",
          "type": "Bundle",
          "mode": "target"
        }
      ],
      "rule": [
        {
          "name": "o_blood_group",
          "source": [
            {
              "context": "src",
              "element": "item",
              "variable": "item_blood_group",
              "condition": "((linkId = '9b62b65c-e8f9-4b4d-9cb2-cc715b73baaa') and answer.value.exists())"
            }
          ],
          "rule": [
            {
              "name": "r_obs",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "bundle",
                  "contextType": "variable",
                  "element": "entry",
                  "variable": "entry"
                },
                {
                  "context": "entry",
                  "contextType": "variable",
                  "element": "resource",
                  "variable": "obs",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "Observation"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "r_obs_id",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "id",
                      "transform": "uuid"
                    }
                  ]
                },
                {
                  "name": "r_obs_status",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "status",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "final"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_obs_category_1",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "category",
                      "transform": "cc",
                      "parameter": [
                        {
                          "valueString": "http://terminology.hl7.org/CodeSystem/observation-category"
                        },
                        {
                          "valueString": "vital-signs"
                        },
                        {
                          "valueString": "Vital Signs"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_obs_code",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "code",
                      "variable": "concept",
                      "transform": "create",
                      "parameter": [
                        {
                          "valueString": "CodeableConcept"
                        }
                      ]
                    }
                  ],
                  "rule": [
                    {
                      "name": "r_cp_cc_cod",
                      "source": [
                        {
                          "context": "src"
                        }
                      ],
                      "target": [
                        {
                          "context": "concept",
                          "contextType": "variable",
                          "element": "coding",
                          "variable": "coding",
                          "transform": "c",
                          "parameter": [
                            {
                              "valueString": "http://snomed.info/sct"
                            },
                            {
                              "valueString": "269826008"
                            }
                          ]
                        }
                      ],
                      "rule": [
                        {
                          "name": "r_cp_cod_disp",
                          "source": [
                            {
                              "context": "src"
                            }
                          ],
                          "target": [
                            {
                              "context": "coding",
                              "contextType": "variable",
                              "element": "display",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueString": "ABO blood grouping"
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_obs_ref",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "subject",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "$this.subject"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_effective_current_date_time",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "effective",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "now()"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_obs_value",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "value",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "item_blood_group"
                        },
                        {
                          "valueString": "answer.value.code"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "o_blood_group",
          "source": [
            {
              "context": "src",
              "element": "item",
              "variable": "item_weight",
              "condition": "((linkId = '0bcd75c0-2fc9-4027-9c54-23f1d0812d91') and answer.value.exists())"
            }
          ],
          "rule": [
            {
              "name": "r_obs",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "bundle",
                  "contextType": "variable",
                  "element": "entry",
                  "variable": "entry"
                },
                {
                  "context": "entry",
                  "contextType": "variable",
                  "element": "resource",
                  "variable": "obs",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "Observation"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "r_obs_id",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "id",
                      "transform": "uuid"
                    }
                  ]
                },
                {
                  "name": "r_obs_status",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "status",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "final"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_obs_category_1",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "category",
                      "transform": "cc",
                      "parameter": [
                        {
                          "valueString": "http://terminology.hl7.org/CodeSystem/observation-category"
                        },
                        {
                          "valueString": "vital-signs"
                        },
                        {
                          "valueString": "Vital Signs"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_obs_code",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "code",
                      "variable": "concept",
                      "transform": "create",
                      "parameter": [
                        {
                          "valueString": "CodeableConcept"
                        }
                      ]
                    }
                  ],
                  "rule": [
                    {
                      "name": "r_cp_cc_cod",
                      "source": [
                        {
                          "context": "src"
                        }
                      ],
                      "target": [
                        {
                          "context": "concept",
                          "contextType": "variable",
                          "element": "coding",
                          "variable": "coding",
                          "transform": "c",
                          "parameter": [
                            {
                              "valueString": "http://snomed.info/sct"
                            },
                            {
                              "valueString": "47340003"
                            }
                          ]
                        }
                      ],
                      "rule": [
                        {
                          "name": "r_cp_cod_disp",
                          "source": [
                            {
                              "context": "src"
                            }
                          ],
                          "target": [
                            {
                              "context": "coding",
                              "contextType": "variable",
                              "element": "display",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueString": "Birth weight"
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_obs_ref",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "subject",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "$this.subject"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_effective_current_date_time",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "effective",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "now()"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_obs_value",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "value",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "item_weight"
                        },
                        {
                          "valueString": "answer.value"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "o_visual_impaired",
          "source": [
            {
              "context": "src",
              "element": "item",
              "variable": "item_visual_impaired",
              "condition": "((linkId = 'b69718e1-1140-4e4a-882a-3dd47838c612') and answer.value.exists())"
            }
          ],
          "rule": [
            {
              "name": "r_obs",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "bundle",
                  "contextType": "variable",
                  "element": "entry",
                  "variable": "entry"
                },
                {
                  "context": "entry",
                  "contextType": "variable",
                  "element": "resource",
                  "variable": "obs",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "Observation"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "r_obs_id",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "id",
                      "transform": "uuid"
                    }
                  ]
                },
                {
                  "name": "r_obs_status",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "status",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "final"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_obs_category_1",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "category",
                      "transform": "cc",
                      "parameter": [
                        {
                          "valueString": "http://terminology.hl7.org/CodeSystem/observation-category"
                        },
                        {
                          "valueString": "social-history"
                        },
                        {
                          "valueString": "Social History"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_obs_code",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "code",
                      "variable": "concept",
                      "transform": "create",
                      "parameter": [
                        {
                          "valueString": "CodeableConcept"
                        }
                      ]
                    }
                  ],
                  "rule": [
                    {
                      "name": "r_cp_cc_cod",
                      "source": [
                        {
                          "context": "src"
                        }
                      ],
                      "target": [
                        {
                          "context": "concept",
                          "contextType": "variable",
                          "element": "coding",
                          "variable": "coding",
                          "transform": "c",
                          "parameter": [
                            {
                              "valueString": "http://snomed.info/sct"
                            },
                            {
                              "valueString": "397540003"
                            }
                          ]
                        }
                      ],
                      "rule": [
                        {
                          "name": "r_cp_cod_disp",
                          "source": [
                            {
                              "context": "src"
                            }
                          ],
                          "target": [
                            {
                              "context": "coding",
                              "contextType": "variable",
                              "element": "display",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueString": "Visual impairment"
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_obs_ref",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "subject",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "$this.subject"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_effective_current_date_time",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "effective",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "now()"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_obs_value",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "value",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "item_visual_impaired"
                        },
                        {
                          "valueString": "answer.value.code"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "o_physical_dis",
          "source": [
            {
              "context": "src",
              "element": "item",
              "variable": "item_physical_dis",
              "condition": "((linkId = '93e9278a-c9bf-47d4-b896-0987e8bcf1b0') and answer.value.exists())"
            }
          ],
          "rule": [
            {
              "name": "r_obs",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "bundle",
                  "contextType": "variable",
                  "element": "entry",
                  "variable": "entry"
                },
                {
                  "context": "entry",
                  "contextType": "variable",
                  "element": "resource",
                  "variable": "obs",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "Observation"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "r_obs_id",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "id",
                      "transform": "uuid"
                    }
                  ]
                },
                {
                  "name": "r_obs_status",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "status",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "final"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_obs_category_1",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "category",
                      "transform": "cc",
                      "parameter": [
                        {
                          "valueString": "http://terminology.hl7.org/CodeSystem/observation-category"
                        },
                        {
                          "valueString": "social-history"
                        },
                        {
                          "valueString": "Social History"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_obs_code",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "code",
                      "variable": "concept",
                      "transform": "create",
                      "parameter": [
                        {
                          "valueString": "CodeableConcept"
                        }
                      ]
                    }
                  ],
                  "rule": [
                    {
                      "name": "r_cp_cc_cod",
                      "source": [
                        {
                          "context": "src"
                        }
                      ],
                      "target": [
                        {
                          "context": "concept",
                          "contextType": "variable",
                          "element": "coding",
                          "variable": "coding",
                          "transform": "c",
                          "parameter": [
                            {
                              "valueString": "http://snomed.info/sct"
                            },
                            {
                              "valueString": "161046000"
                            }
                          ]
                        }
                      ],
                      "rule": [
                        {
                          "name": "r_cp_cod_disp",
                          "source": [
                            {
                              "context": "src"
                            }
                          ],
                          "target": [
                            {
                              "context": "coding",
                              "contextType": "variable",
                              "element": "display",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueString": "Physical disability"
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_obs_ref",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "subject",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "$this.subject"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_effective_current_date_time",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "effective",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "now()"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_obs_value",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "value",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "item_physical_dis"
                        },
                        {
                          "valueString": "answer.value.code"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "name": "o_memory_dis",
          "source": [
            {
              "context": "src",
              "element": "item",
              "variable": "item_memory_dis",
              "condition": "((linkId = 'bfc6966c-ea18-499b-8a19-e1224067aaa9') and answer.value.exists())"
            }
          ],
          "rule": [
            {
              "name": "r_obs",
              "source": [
                {
                  "context": "src"
                }
              ],
              "target": [
                {
                  "context": "bundle",
                  "contextType": "variable",
                  "element": "entry",
                  "variable": "entry"
                },
                {
                  "context": "entry",
                  "contextType": "variable",
                  "element": "resource",
                  "variable": "obs",
                  "transform": "create",
                  "parameter": [
                    {
                      "valueString": "Observation"
                    }
                  ]
                }
              ],
              "rule": [
                {
                  "name": "r_obs_id",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "id",
                      "transform": "uuid"
                    }
                  ]
                },
                {
                  "name": "r_obs_status",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "status",
                      "transform": "copy",
                      "parameter": [
                        {
                          "valueString": "final"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_obs_category_1",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "category",
                      "transform": "cc",
                      "parameter": [
                        {
                          "valueString": "http://terminology.hl7.org/CodeSystem/observation-category"
                        },
                        {
                          "valueString": "social-history"
                        },
                        {
                          "valueString": "Social History"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_obs_code",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "code",
                      "variable": "concept",
                      "transform": "create",
                      "parameter": [
                        {
                          "valueString": "CodeableConcept"
                        }
                      ]
                    }
                  ],
                  "rule": [
                    {
                      "name": "r_cp_cc_cod",
                      "source": [
                        {
                          "context": "src"
                        }
                      ],
                      "target": [
                        {
                          "context": "concept",
                          "contextType": "variable",
                          "element": "coding",
                          "variable": "coding",
                          "transform": "c",
                          "parameter": [
                            {
                              "valueString": "http://snomed.info/sct"
                            },
                            {
                              "valueString": "386807006"
                            }
                          ]
                        }
                      ],
                      "rule": [
                        {
                          "name": "r_cp_cod_disp",
                          "source": [
                            {
                              "context": "src"
                            }
                          ],
                          "target": [
                            {
                              "context": "coding",
                              "contextType": "variable",
                              "element": "display",
                              "transform": "copy",
                              "parameter": [
                                {
                                  "valueString": "Memory impairment"
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_obs_ref",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "subject",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "$this.subject"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_effective_current_date_time",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "effective",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "src"
                        },
                        {
                          "valueString": "now()"
                        }
                      ]
                    }
                  ]
                },
                {
                  "name": "r_obs_value",
                  "source": [
                    {
                      "context": "src"
                    }
                  ],
                  "target": [
                    {
                      "context": "obs",
                      "contextType": "variable",
                      "element": "value",
                      "transform": "evaluate",
                      "parameter": [
                        {
                          "valueId": "item_memory_dis"
                        },
                        {
                          "valueString": "answer.value.code"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}
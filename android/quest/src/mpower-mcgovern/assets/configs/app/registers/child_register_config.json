{
  "appId": "app",
  "configType": "register",
  "id": "childRegister",
  "pageSize": 20,
  "configRules": [
    {
      "name": "under5",
      "condition": "true",
      "actions": [
        "data.put('under5', dateService.addOrSubtractTimeUnitFromCurrentDate(5,'-','YEAR'))"
      ]
    }
  ],
  "fhirResource": {
    "baseResource": {
      "resource": "Patient",
      "dataQueries": [
        {
          "paramName": "birthdate",
          "filterCriteria": [
            {
              "dataType": "DATE",
              "computedRule": "under5",
              "prefix": "GREATERTHAN_OR_EQUALS"
            }
          ]
        }
      ],
      "sortConfigs": [
        {
          "paramName": "_lastUpdated",
          "dataType": "DATE",
          "order": "DESCENDING"
        }
      ]
    },
    "relatedResources": [
      {
        "resource": "Group",
        "searchParameter": "member"
      },
      {
        "resource": "Condition",
        "searchParameter": "subject",
        "dataQueries": [
          {
            "paramName": "clinical-status",
            "filterCriteria": [
              {
                "dataType": "CODEABLECONCEPT",
                "value": {
                  "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
                  "code": "active"
                }
              }
            ]
          }
        ]
      },
      {
        "resource": "Task",
        "searchParameter": "subject",
        "dataQueries": [
          {
            "paramName": "status",
            "operation": "OR",
            "filterCriteria": [
              {
                "dataType": "CODE",
                "value": {
                  "system": "http://hl7.org/fhir/task-status",
                  "code": "ready"
                }
              },
              {
                "dataType": "CODE",
                "value": {
                  "system": "http://hl7.org/fhir/task-status",
                  "code": "failed"
                }
              }
            ]
          }
        ],
        "sortConfigs": [
          {
            "paramName": "period",
            "dataType": "DATE"
          }
        ]
      }
    ]
  },
  "searchBar": {
    "visible": true,
    "display": "{{ search.by.name }}",
    "computedRules": [
      "patientName",
      "patientId"
    ]
  },
  "registerCard": {
    "rules": [
      {
        "name": "familyName",
        "condition": "true",
        "actions": [
          "data.put('familyName', fhirPath.extractValue(Group.get(0), 'Group.name'))"
        ]
      },
      {
        "name": "patientName",
        "condition": "true",
        "actions": [
          "data.put('patientName', fhirPath.extractValue(Patient, \"Patient.name[0].select(text)\"))"
        ]
      },
      {
        "name": "patientAge",
        "condition": "true",
        "actions": [
          "data.put('patientAge', service.extractAge(Patient))"
        ]
      },
      {
        "name": "patientGender",
        "condition": "true",
        "actions": [
          "data.put('patientGender', service.extractGender(Patient))"
        ]
      },
      {
        "name": "patientId",
        "condition": "true",
        "actions": [
          "data.put('patientId', fhirPath.extractValue(Patient, 'Patient.identifier[0].value'))"
        ]
      },
      {
        "name": "showMemberTasks",
        "condition": "true",
        "actions": [
          "data.put('showMemberTasks', size(Task) > 0)"
        ]
      },
      {
        "name": "serviceStatus",
        "condition": "true",
        "actions": [
          "data.put('serviceStatus', service.evaluateToBoolean(Task, \"Task.status = 'failed' \", false) ? 'OVERDUE' : 'DUE')"
        ]
      },
      {
        "name": "taskDescription",
        "condition": "true",
        "actions": [
          "data.put('taskDescription', fhirPath.extractValue(size(Task) > 0 ? Task.get(0) : null, 'Task.description'))"
        ]
      },
      {
        "name": "taskId",
        "condition": "true",
        "actions": [
          "data.put('taskId', fhirPath.extractValue(size(Task) > 0 ? Task.get(0) : null, 'Task.id'))"
        ]
      },
      {
        "name": "taskFor",
        "condition": "true",
        "actions": [
          "data.put('taskFor', fhirPath.extractValue(size(Task) > 0 ? Task.get(0) : null, 'Task.for.reference'))"
        ]
      },
      {
        "name": "taskQuestionnaireId",
        "condition": "true",
        "actions": [
          "data.put('taskQuestionnaireId', fhirPath.extractValue(size(Task) > 0 ? Task.get(0) : null, 'Task.reasonReference.reference'))"
        ]
      },
      {
        "name": "taskExecutionStartDate",
        "condition": "true",
        "actions": [
          "data.put('taskExecutionStartDate', fhirPath.extractValue(size(Task) > 0 ? Task.get(0) : null, 'Task.executionPeriod.start'))"
        ]
      },
      {
        "name": "taskScheduleDate",
        "condition": "true",
        "priority": 2,
        "actions": [
          "data.put('taskScheduleDate', service.formatDate(data.get('taskExecutionStartDate'), \"yyyy-MM-dd'T'HH:mm:ss.SSS'Z'\", \"yyyy-MM-dd\"))"
        ]
      },
      {
        "name": "taskReasonCode",
        "condition": "true",
        "actions": [
          "data.put('taskReasonCode', fhirPath.extractValue(size(Task) > 0 ? Task.get(0) : null, 'Task.input[0].value.coding.code'))"
        ]
      },
      {
        "name": "taskReasonDisplay",
        "condition": "true",
        "actions": [
          "data.put('taskReasonDisplay', fhirPath.extractValue(size(Task) > 0 ? Task.get(0) : null, 'Task.input[0].value.coding.display'))"
        ]
      }
    ],
    "views": [
      {
        "viewType": "COLUMN",
        "children": [
          {
            "viewType": "SERVICE_CARD",
            "details": [
              {
                "viewType": "COMPOUND_TEXT",
                "primaryText": "@{patientName}",
                "primaryTextColor": "#000000"
              },
              {
                "viewType": "COMPOUND_TEXT",
                "primaryText": "{{patient.age}}, {{patient.gender}}",
                "primaryTextColor": "#939596"
              },
              {
                "viewType": "COMPOUND_TEXT",
                "primaryText": "{{family.name.family}}",
                "primaryTextColor": "#939596",
                "fontSize": 14
              }
            ],
            "showVerticalDivider": false,
            "serviceButton": {
              "visible": "@{showMemberTasks}",
              "text": "@{taskDescription}",
              "status": "@{serviceStatus}",
              "smallSized": true,
              "actions": [
                {
                  "trigger": "ON_CLICK",
                  "workflow": "LAUNCH_QUESTIONNAIRE",
                  "questionnaire": {
                    "id": "@{taskQuestionnaireId}",
                    "title": "@{taskDescription}",
                    "saveButtonText": "Save",
                    "taskId": "@{taskId}",
                    "resourceIdentifier": "@{taskFor}"
                  },
                  "params": [
                    {
                      "paramType": "PREPOPULATE",
                      "linkId": "ae2f17cb-deff-48a6-8ece-27e6bd475f30",
                      "dataType": "DATE",
                      "key": "taskScheduleDate",
                      "value": "@{taskScheduleDate}"
                    },
                    {
                      "paramType": "PREPOPULATE",
                      "linkId": "d5962592-08d5-447b-d6a2-62a077e6bb05",
                      "dataType": "STRING",
                      "key": "taskReasonCode",
                      "value": "@{taskReasonCode}"
                    },
                    {
                      "paramType": "PREPOPULATE",
                      "linkId": "c706016d-b8e9-44c7-9acb-155bb4e6092c",
                      "dataType": "STRING",
                      "key": "taskReasonDisplay",
                      "value": "@{taskReasonDisplay}"
                    }
                  ]
                }
              ]
            },
            "actions": [
              {
                "trigger": "ON_CLICK",
                "workflow": "LAUNCH_PROFILE",
                "id": "defaultProfile"
              }
            ]
          }
        ]
      }
    ]
  }
}

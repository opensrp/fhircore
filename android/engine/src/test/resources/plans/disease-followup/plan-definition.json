{
  "resourceType": "PlanDefinition",
  "id": "231ef3a0-fbc1-41b6-b80d-2c004af6719a",
  "contained": [
    {
      "resourceType": "ActivityDefinition",
      "id": "careplan-init-activity",
      "title": "Client History Assessment",
      "status": "active",
      "description": "This action will be run when the cleint history is assessed.",
      "kind": "CarePlan",
      "dynamicValue": [
        {
          "path": "title",
          "expression": {
            "language": "text/fhirpath",
            "expression": "%rootResource.title"
          }
        },
        {
          "path": "description",
          "expression": {
            "language": "text/fhirpath",
            "expression": "%rootResource.description"
          }
        },
        {
          "path": "instantiatesCanonical",
          "expression": {
            "language": "text/fhirpath",
            "expression": "%rootResource.id.replaceMatches('/_history/.*', '')"
          }
        },
        {
          "path": "status",
          "expression": {
            "language": "text/fhirpath",
            "expression": "'active'"
          }
        },
        {
          "path": "intent",
          "expression": {
            "language": "text/fhirpath",
            "expression": "'plan'"
          }
        },
        {
          "path": "created",
          "expression": {
            "language": "text/fhirpath",
            "expression": "now()"
          }
        },
        {
          "path": "subject.reference",
          "expression": {
            "language": "text/fhirpath",
            "expression": "$this.id.replaceMatches('/_history/.*', '')"
          }
        },
        {
          "path": "author",
          "expression": {
            "language": "text/fhirpath",
            "expression": "$this.generalPractitioner.first()"
          }
        },
        {
          "path": "period.start",
          "expression": {
            "language": "text/fhirpath",
            "expression": "$this.birthDate"
          }
        },
        {
          "path": "period.end",
          "expression": {
            "language": "text/fhirpath",
            "expression": "$this.birthDate + 4017 'days'"
          }
        },
        {
          "path": "activity.detail.kind",
          "expression": {
            "language": "text/fhirpath",
            "expression": "'MedicationRequest'"
          }
        },
        {
          "path": "activity.detail.status",
          "expression": {
            "language": "text/fhirpath",
            "expression": "'in-progress'"
          }
        },
        {
          "path": "activity.detail.description",
          "expression": {
            "language": "text/fhirpath",
            "expression": "'This is the client history assessment.'"
          }
        },
        {
          "path": "activity.detail.performer",
          "expression": {
            "language": "text/fhirpath",
            "expression": "$this.generalPractitioner.first()"
          }
        }
      ]
    },
    {
      "resourceType": "ActivityDefinition",
      "id": "careplan-measles-client-history-activity",
      "title": "Client History Assessment",
      "status": "active",
      "description": "This is the client history assessment.",
      "kind": "MedicationRequest",
      "code": {
        "coding": [
          {
            "system": "http://snomed.info/sct",
            "code": "33879002",
            "display": "Administration of vaccine to produce active immunity (procedure)"
          }
        ]
      },
      "productCodeableConcept": {
        "coding": [
          {
            "system": "http://hl7.org/fhir/sid/icd-11",
            "code": "XM28X5",
            "display": "Measles vaccines"
          }
        ],
        "text": "Measles vaccines"
      },
      "dosage": [
        {
          "sequence": 1,
          "timing": {
            "repeat": {
              "count": 1,
              "duration": 280,
              "durationUnit": "d",
              "period": 9,
              "periodUnit": "mo"
            }
          }
        }
      ]
    },
    {
      "resourceType": "ActivityDefinition",
      "id": "careplan-measles-contraindication-activity",
      "title": "Contraindication Assessment",
      "status": "active",
      "description": "This is the Contraindication assessment.",
      "kind": "MedicationRequest",
      "code": {
        "coding": [
          {
            "system": "http://snomed.info/sct",
            "code": "33879002",
            "display": "Administration of vaccine to produce active immunity (procedure)"
          }
        ]
      },
      "productCodeableConcept": {
        "coding": [
          {
            "system": "http://hl7.org/fhir/sid/icd-11",
            "code": "XM28X5",
            "display": "Measles vaccines"
          }
        ],
        "text": "Measles vaccines"
      },
      "dosage": [
        {
          "sequence": 1,
          "timing": {
            "repeat": {
              "count": 1,
              "duration": 280,
              "durationUnit": "d",
              "period": 9,
              "periodUnit": "mo"
            }
          }
        }
      ]
    },
    {
      "resourceType": "ActivityDefinition",
      "id": "careplan-measles-administer-activity",
      "title": "Administer Vaccine",
      "status": "active",
      "description": "This is the Administer assessment.",
      "kind": "MedicationRequest",
      "code": {
        "coding": [
          {
            "system": "http://snomed.info/sct",
            "code": "33879002",
            "display": "Administration of vaccine to produce active immunity (procedure)"
          }
        ]
      },
      "productCodeableConcept": {
        "coding": [
          {
            "system": "http://hl7.org/fhir/sid/icd-11",
            "code": "XM28X5",
            "display": "Measles vaccines"
          }
        ],
        "text": "Measles vaccines"
      },
      "dosage": [
        {
          "sequence": 1,
          "timing": {
            "repeat": {
              "count": 1,
              "duration": 280,
              "durationUnit": "d",
              "period": 9,
              "periodUnit": "mo"
            }
          }
        }
      ]
    }
  ],
  "name": "Child Immunization",
  "title": "Child Immunization",
  "status": "active",
  "description": "This scheduled will be used to track the child's immunization.",
  "action": [
    {
      "prefix": "1",
      "priority": "routine",
      "condition": [
        {
          "kind": "applicability",
          "expression": {
            "language": "text/fhirpath",
            "expression": "%resource.entry.where(resource is QuestionnaireResponse).resource.where(questionnaire = 'Questionnaire/0fbd4938-6134-4c56-8d49-6c91dd306fbd' or questionnaire = 'Questionnaire/fbfd01eb-6ed7-426e-add5-b8dffe7ec3de').exists()"
          }
        }
      ],
      "definitionCanonical": "#careplan-init-activity"
    },
    {
      "prefix": "1",
      "priority": "routine",
      "condition": [
        {
          "kind": "applicability",
          "expression": {
            "language": "text/fhirpath",
            "expression": "%resource.entry.where(resource is QuestionnaireResponse).resource.where(questionnaire = 'Questionnaire/0fbd4938-6134-4c56-8d49-6c91dd306fbd').exists()"
          }
        }
      ],
      "type": {
        "coding": [
          {
            "code": "clinical-protocol",
            "display": "Clinical Protocol"
          }
        ]
      },
      "definitionCanonical": "#careplan-measles-client-history-activity",
      "transform": "https://fhir.labs.smartregister.org/fhir/StructureMap/bdf23f3b-232e-4027-865e-1eec690575bc"
    },
    {
      "prefix": "1",
      "priority": "routine",
      "condition": [
        {
          "kind": "applicability",
          "expression": {
            "language": "text/fhirpath",
            "expression": "%resource.entry.where(resource is QuestionnaireResponse).resource.where(questionnaire = 'Questionnaire/fbfd01eb-6ed7-426e-add5-b8dffe7ec3de').exists()"
          }
        }
      ],
      "type": {
        "coding": [
          {
            "code": "clinical-protocol",
            "display": "Clinical Protocol"
          }
        ]
      },
      "definitionCanonical": "#careplan-measles-contraindication-activity",
      "transform": "https://fhir.labs.smartregister.org/fhir/StructureMap/1f0ca814-467b-48d3-9aa7-4e740a628350"
    },
    {
      "prefix": "1",
      "priority": "routine",
      "condition": [
        {
          "kind": "applicability",
          "expression": {
            "language": "text/fhirpath",
            "expression": "%resource.entry.where(resource is QuestionnaireResponse).resource.where(questionnaire = 'Questionnaire/d4f9bfbe-b684-4505-9c66-719afd5c9fca').exists()"
          }
        }
      ],
      "type": {
        "coding": [
          {
            "code": "clinical-protocol",
            "display": "Clinical Protocol"
          }
        ]
      },
      "definitionCanonical": "#careplan-measles-administer-activity",
      "transform": "https://fhir.labs.smartregister.org/fhir/StructureMap/be876ffc-491d-4ab1-ba2c-0ba5213283c8"
    }
  ]
}
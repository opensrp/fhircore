{
  "resourceType": "PlanDefinition",
  "id": "4ac4f9d6-6fc7-45bf-9a29-398798fc3134",
  "meta": {
    "versionId": "1",
    "lastUpdated": "2022-06-10T17:22:13.742+00:00"
  },
  "contained": [
    {
      "resourceType": "ActivityDefinition",
      "id": "careplan-init-activity",
      "title": "ANC Register Handler Activity",
      "status": "active",
      "description": "This action will assess careplan on registration to init careplan",
      "kind": "CarePlan",
      "dynamicValue": [
        {
          "path": "title",
          "expression": {
            "language": "text/fhirpath",
            "expression": "%rootResource.title"
          }
        },
        {
          "path": "description",
          "expression": {
            "language": "text/fhirpath",
            "expression": "%rootResource.description"
          }
        },
        {
          "path": "instantiatesCanonical",
          "expression": {
            "language": "text/fhirpath",
            "expression": "%rootResource.id.replaceMatches('/_history/.*', '')"
          }
        },
        {
          "path": "status",
          "expression": {
            "language": "text/fhirpath",
            "expression": "'active'"
          }
        },
        {
          "path": "intent",
          "expression": {
            "language": "text/fhirpath",
            "expression": "'plan'"
          }
        },
        {
          "path": "created",
          "expression": {
            "language": "text/fhirpath",
            "expression": "now()"
          }
        },
        {
          "path": "subject",
          "expression": {
            "language": "text/fhirpath",
            "expression": "%resource.entry.where(resource is QuestionnaireResponse).resource.subject"
          }
        },
        {
          "path": "author",
          "expression": {
            "language": "text/fhirpath",
            "expression": "$this.generalPractitioner.first()"
          }
        },
        {
          "path": "period.start",
          "expression": {
            "language": "text/fhirpath",
            "expression": "today()"
          }
        },
        {
          "path": "period.end",
          "expression": {
            "language": "text/fhirpath",
            "expression": "today() + 7 'day'"
          }
        },
        {
          "path": "activity.detail.kind",
          "expression": {
            "language": "text/fhirpath",
            "expression": "'Task'"
          }
        },
        {
          "path": "activity.detail.status",
          "expression": {
            "language": "text/fhirpath",
            "expression": "'in-progress'"
          }
        },
        {
          "path": "activity.detail.description",
          "expression": {
            "language": "text/fhirpath",
            "expression": "'This action will assess careplan on registration to init careplan'"
          }
        },
        {
          "path": "activity.detail.performer",
          "expression": {
            "language": "text/fhirpath",
            "expression": "$this.generalPractitioner.first()"
          }
        }
      ]
    },
    {
      "resourceType": "ActivityDefinition",
      "id": "careplan-task-activity",
      "title": "Sick Child Follow Up Plan",
      "status": "active",
      "description": "This action will performed every day for a sick < 5 years old patient.",
      "kind": "Task",
      "timingTiming": {
        "repeat": {
          "count": 3,
          "period": 1,
          "periodUnit": "d"
        }
      }
    },
    {
      "resourceType": "ActivityDefinition",
      "id": "careplan-followup-activity",
      "title": "Sick Child Follow Up Handler Activity",
      "status": "active",
      "description": "This action will assess careplan every time a followup happens on a task generated by plan",
      "kind": "CarePlan",
      "dynamicValue": [
        {
          "path": "CarePlan.status",
          "expression": {
            "language": "text/fhirpath",
            "expression": "'completed'"
          }
        }
      ]
    },
    {
      "resourceType": "ActivityDefinition",
      "id": "careplan-referral-activity",
      "title": "Sick Child Referral Handler Activity",
      "status": "active",
      "description": "This action will assess careplan and generate referral task every time a followup happens on a task generated by plan",
      "kind": "Task"
    }
  ],
  "name": "Sick Child Follow Up Plan",
  "title": "Sick Child Follow Up Plan",
  "status": "active",
  "description": "This defines the schedule of care for sick patients under 5 years old",
  "action": [
    {
      "prefix": "1",
      "priority": "routine",
      "condition": [
        {
          "kind": "applicability",
          "expression": {
            "language": "text/fhirpath",
            "expression": "$this is Patient and ($this.birthDate <= today() - 2 'months' and $this.birthDate >= today() - 5 'years') and %resource.entry.where(resource is QuestionnaireResponse).resource.where(questionnaire = 'Questionnaire/3276f55c-b25e-455b-ae4e-8846fb8fd039').exists() and %resource.entry.where(resource is QuestionnaireResponse).resource.descendants().where(linkId = 'ba8ac52f-7fc2-4ab9-9e67-ee4473c57b48' and answer.value.code = 'sick').exists()"
          }
        }
      ],
      "definitionCanonical": "#careplan-init-activity"
    },
    {
      "prefix": "1",
      "priority": "routine",
      "condition": [
        {
          "kind": "applicability",
          "expression": {
            "language": "text/fhirpath",
            "expression": "$this is Patient and ($this.birthDate <= today() - 2 'months' and $this.birthDate >= today() - 5 'years') and %resource.entry.where(resource is QuestionnaireResponse).resource.where(questionnaire = 'Questionnaire/3276f55c-b25e-455b-ae4e-8846fb8fd039').exists() and %resource.entry.where(resource is QuestionnaireResponse).resource.descendants().where(linkId = 'ba8ac52f-7fc2-4ab9-9e67-ee4473c57b48' and answer.value.code = 'sick').exists()"
          }
        }
      ],
      "definitionCanonical": "#careplan-task-activity",
      "transform": "http://hl7.org/fhir/StructureMap/737a86d6-ad63-4345-8753-1e605438d1ee"
    },
    {
      "prefix": "1",
      "priority": "routine",
      "condition": [
        {
          "kind": "applicability",
          "expression": {
            "language": "text/fhirpath",
            "expression": "%resource.entry.where(resource is QuestionnaireResponse).resource.where(questionnaire = 'Questionnaire/3276f55c-b25e-455b-ae4e-8846fb8fd039').exists() and %resource.entry.where(resource is QuestionnaireResponse).resource.repeat(item).where(linkId = '0e2d8659-22ee-44ca-8c26-bf81cca6b366' and answer.value.code = 'fully-recovered').exists()"
          }
        }
      ],
      "definitionCanonical": "#careplan-followup-activity"
    },
    {
      "prefix": "1",
      "priority": "routine",
      "condition": [
        {
          "kind": "applicability",
          "expression": {
            "language": "text/fhirpath",
            "expression": "%resource.entry.where(resource is QuestionnaireResponse).resource.where(questionnaire = 'Questionnaire/3276f55c-b25e-455b-ae4e-8846fb8fd039' or questionnaire = 'Questionnaire/1bdf21ef-d31a-446e-aaa6-cec516eceab1' or questionnaire = 'Questionnaire/58fbddae-c5a0-4b86-832e-f516c96f3b85').exists() and %resource.entry.where(resource is QuestionnaireResponse).resource.descendants().where((linkId = 'f3836465-adca-4cc8-8710-c392ee85f739' or linkId = '04491c90-6f5a-4005-e604-64775f23345e' or linkId = '4d87ea34-04a8-42bd-8c5c-e1c4b90d69fb') and answer.value.code = 'yes').exists()"
          }
        }
      ],
      "definitionCanonical": "#careplan-referral-activity",
      "transform": "http://hl7.org/fhir/StructureMap/528a8603-2e43-4a2e-a33d-1ec2563ffd3e"
    }
  ]
}

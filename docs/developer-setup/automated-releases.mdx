# Releases

The OpenSRP FHIR Core releases occur at most once every 2 weeks, i.e. at the conclusion of a sprint. The release process follows the [gitlab flow](https://docs.gitlab.com/ee/topics/gitlab_flow.html#release-branches-with-gitlab-flow) style described in the following diagram:

![gitlab flow diagram](../assets/gitlabflow.png)

This allows changes to occur on the release branch while unrelated code continues being merged into main. Specifically, release follow the following steps:
1. Code freeze: the creation of a branch for the release version as well as the first release candidate (labeled RC1).
    * For example, for release version v0.2.0 a branch opensrp-0.2.0 is create and a pre-release opensrp-0.2.0-rc1
1. Candidate progression: This is followed by 1-2 weeks of QA and error fixing
    * Whenever we find an error in the candidate, a pull request with a fix for the error is opened against the release branch (e.g. v0.2.0) and against the main branch.
    * Once the error is fixed and merged into the release branch (multiple errors can be batched) a new pre-release is created, e.g. opensrp-0.2.0-rc2
1. Final release: when the release meets requirements, a final release, opensrp-0.2.0 is created, with a tag v0.2.0.


## Release automation with tags

As part of integrating Continuous Delivery(CD) into the development lifecycle, CI is set up to generate an APK.

The configuration requires the tag to:
* The product name: _opensrp_
* Followed by the _version_ in the format `[0-9]+.[0-9]+.[0-9]+[0-9a-zA-Z.-]+`
* Followed by an optional _suffix_ depending on the release e.g. `-alpha`, `-rc`, `-beta` e.t.c

The following are all valid tags that will trigger the generation of a release APK
> - opensrp-1.2.0
> - opensrp-1.2.0-alpha
> - opensrp-1.2.0-beta
> - opensrp-1.2.0-rc1

**Note:** e.g. when creating a tag for the _OpenSRP Version 1.2.0_, use the command:

```
git tag -a opensrp-1.2.0 -s  && git push origin opensrp-1.2.0
```

When you run the command, you will be prompted to _add a message_. The message should be of the format:

| Template                                                       | Sample                                                                                                            |
|----------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------|
| <pre> TITLE <br/> - Release note 1<br/> - Release note 2</pre> | <pre> BETA RELEASE <br/> - Adds Login by PIN functionality <br/> - Fixes sync bug causing crash on install </pre> |

**Note:** For convention, the TITLE should be _Capitalized_.

## Deleting a tag
Sometimes you may want to delete a tag, e.g. if you push an incorrect tag, need to update the tag message etc.

For example, to delete the opensrp-1.2.0 tag run the command:

```
git push --delete origin opensrp-1.2.0 && git tag --delete opensrp-1.2.0
```

# Documentation of Single APK Approach Configuration
<img src="https://user-images.githubusercontent.com/62053304/169209957-e59780e8-4e68-49fc-8167-a247d696d09b.jpg" width="512">
The configurations in Single APK Approach is using the combination of a single Composition and multiple Binary resource.

## Composition
Composition config is identified using an `appId` and is the entry point to access all the Binary configs associated with that `appId`.

Example of an `appId`: anc, ecbis, quest, etc.

### Structure of Composition Config
There are 2 attributes to be highlighted. It is the `identifier` and `section` attributes.

These are the only attributes that developers need to specifically fill, the other attributes can be generic by using our own template and some are also automatically generated by the FHIR server.

* `identifier`

   The `identifier` attribute is a single unique value that represents an appId and will differentiate a Composition config from one another.
   
   ```json
   "identifier": {
     "use": "official",
     "value": "appId"
   }
   ```

* `section`

   The `section` attribute is multivalue that represent configurations.
   
   Each `section` contains:
   
   * `reference` to the Binary config associated with the Composition `appId`
   
   * `identifier` that represents a config classification name
   
   ```json
   "section": [
    {
      "title": "App configuration",
      "mode": "working",
      "focus": {
        "reference": "Binary/xxxxx",
        "identifier": {
          "value": "application"
        }
      }
    },
    {
      "title": "Login configuration",
      "mode": "working",
      "focus": {
        "reference": "Binary/xxxxx",
        "identifier": {
          "value": "login"
        }
      }
    }
   ]
   ```

## Binary

Binary config contains attributes that will be used in the app.

List of common Binary configs `classfication`:

| classification               | What it configures                                                              |
| :----------------------------- | :------------------------------------------------------------------------ |
| application           | Configure the app level                             |
| login                 | Configure the login page                             |
| app_feature           | Configure the available features                             |
| pin                   | Configure the pin page                             |
| data_filters          | Configure the filters when retrieving resource from FHIR local database                       |
| forms                 | Configure the Questionnaires that the app will uses                           |
| patient_register      | Configure the patient register page                             |
| sync                  | Configure the resource that will be synced                             |

### Structure of Binary Config

Common attributes:

| Attributes               | Description                                 |
   | :----------------------------- | :------------------------------------------ |
   | appId           | Sets the config identifier e.g anc, ecbis, quest, etc                            | 
   | classification                 | Sets the config classification name e.g application, login, sync, etc         |

#### Structure of each `classification`

1. `application`

   | Attributes               | Description                                 | Type |
   | :----------------------------- | :------------------------------------------ | :---- |
   | theme           | Sets the theme for the app                            | String |
   | language                 | Sets the languages for the app                          | List&lt;String&gt; |
   | syncInterval           | Sets the periodic sync interval in seconds. Default 30            | Long |
   | applicationName                   | Sets the application display name                      | String |
   | appLogoIconResourceFile          | Sets the application logo thumb icon, there must be png file inside  | String       |
   | count                 | Sets the application maximum records when downloading resource                  | String      |
   
   ```json
   {
     "appId": "ecbis-saa",
     "classification": "application",
     "theme": "AppTheme",
     "languages": ["en", "sw"],
     "applicationName": "eCBIS",
     "appLogoIconResourceFile": "ic_liberia",
     "count": "100"
   }
   ```

2. `login`

   | Attributes               | Description                                                          | Type |
   | :----------------------------- | :------------------------------------------------------------------------ | :--- |
   | applicationName           | Sets the application display name                            | String |
   | applicationVersion                 | Set the application display version                        | String |
   | applicationVersionCode           | Set the application version code                 | Int |
   | darkMode                   | Sets the login theme to use dark mode                             | Boolean |
   | showLogo          | Sets the login logo visibility        | Boolean |
   | enablePin                 | Sets the use of pin login feature                         | Boolean |
   
   ```json
   {
     "appId": "ecbis-saa",
     "classification": "login",
     "applicationName": "eCBIS",
     "applicationVersion": "0.0.1",
     "applicationVersionCode": 1,
     "darkMode": false,
     "showLogo": true,
     "enablePin": true
   }
   ```
   
3. `app_feature`

   | Attributes               | Description                                                          | Type |
   | :----------------------------- | :------------------------------------------------------------------------ | :--- |
   | appFeatures           | Sets the list of features in the app                           | List&lt;FeatureConfig&gt; |
   
   #### Structure of `FeatureConfig`
   
   | Attributes               | Description                                                          | Type |
   | :----------------------------- | :------------------------------------------------------------------------ | :--- |
   | feature           | Sets the feature name                            | String |
   | active                 | Sets the feature active status                       | Boolean |
   | settings           | Sets the custom settings of this feature, when needed                 | Map&lt;String, String&gt; |
   | target                   | Sets the user that will use this feature e.g CHW, HF         | String? |
   | healthModule          | Sets the health module of this feature e.g DEFAULT, ANC, RDT, PNC, CHILD, FAMILY, FAMILY PLANNING       | String? |
   | useCases                 | Sets the use cases / what this feature can do e.g PATIENT_REGISTRATION, ANC_VISITS, etc | List&lt;String&gt;? |
   
   ```json
   {
     "appId": "ecbis-saa",
     "classification": "app_feature",
     "appFeatures": [
       {
         "feature": "PatientManagement",
         "active": true,
         "settings": {},
         "target": "CHW",
         "healthModule": "ANC",
         "useCases": [
           "PATIENT_REGISTRATION",
           "ANC_VISITS",
           "PREGNANCY_OUTCOME"
         ]
       },
       {
         "feature": "HouseHoldManagement",
         "active": true,
         "settings": {
           "deactivateMembers": "true"
         },
         "target": "CHW",
         "healthModule": "FAMILY",
         "useCases": [
           "HOUSEHOLD_REGISTRATION",
           "REMOVE_HOUSEHOLD",
           "HOUSEHOLD_VISITS",
           "REMOVE_HOUSEHOLD_MEMBER"
         ]
       }
     ]
   }
   ```
   
3. `pin`
   
   | Attributes               | Description                                                          | Type |
   | :----------------------------- | :------------------------------------------------------------------------ | :--- |
   | applicationName           | Sets the application display name                            | String |
   | appLogoIconResourceFile          | Sets the application logo thumb icon, there must be png file inside  | String       |
   | enablePin                 | Sets the use of pin login feature                         | Boolean |
   | showLogo          | Sets the login logo visibility        | Boolean |
   
   ```json
   {
     "appId": "ecbis-saa",
     "classification": "pin",
     "applicationName": "eCBIS",
     "appLogoIconResourceFile": "ic_liberia",
     "enablePin": true,
     "showLogo": true
   }
   ```

4. `data_filters`

   | Attributes               | Description                                                          | Type |
   | :----------------------------- | :------------------------------------------------------------------------ | :--- |
   | filters           | Sets the list of filters in the app                           | List&lt;SearchFilter&gt; |
   
   #### Structure of `SearchFilter`
   
   | Attributes               | Description                                                          | Type |
   | :----------------------------- | :------------------------------------------------------------------------ | :--- |
   | id           | Sets the identifier that is related to the feature or resource that will be filtered e.g family, family_care_plan, task          | List&lt;SearchFilter&gt; |
   | key           | Sets the filter key                       | String |
   | filterType           | Sets the filter type                    | String |
   | valueType           | Sets the value type of the filter                       | String |
   | valueBoolean           | Sets the value if it's a Boolean                       | Boolean? |
   | valueCoding           | Sets the value if it's a Coding                        | Code? |
   | valueString           | Sets the value if it's a String                       | String? |
   
   #### Structure of `Code`
   
   | Attributes               | Description                                                          | Type |
   | :----------------------------- | :------------------------------------------------------------------------ | :--- |
   | system           | Sets the system as url of an org that provides this Code        | String? |
   | code           | Sets the unique code in numeric                     | String? |
   | display           | Sets the human readable meaning of this Code e.g Family              | String? |
   
   #### Currently Supported `filterType` and `valueType`
   
   | filterType               | valueType                                                          |
   | :----------------------------- | :----------------------------------------------------- |
   | TOKEN           | CODING |
   | TOKEN           | CODEABLECONCEPT                       |
   | STRING           | STRING                   |
   | STRING           | BOOLEAN                         |
   
   ```json
   {
     "appId": "ecbis-saa",
     "classification": "data_filters",
     "filters": [
       {
         "id": "anc",
         "filterType": "TOKEN",
         "key": "clinical-status",
         "valueType": "CODEABLECONCEPT",
         "valueCoding": {
           "system": "http://terminology.hl7.org/CodeSystem/condition-clinical",
           "code": "active"
         }
       },
       {
         "id": "family",
         "filterType": "TOKEN",
         "key": "type",
         "valueType": "CODING",
         "valueCoding": {
           "system": "http://hl7.org/fhir/group-type",
           "code": "person"
         }
       },
       {
         "id": "family_care_plan",
         "filterType": "TOKEN",
         "key": "_tag",
         "valueType": "CODING",
         "valueCoding": {
           "system": "https://www.snomed.org",
           "code": "35359004"
         }
       },
       {
         "id": "forms_list",
         "filterType": "TOKEN",
         "key": "context",
         "valueType": "CODING",
         "valueCoding": {
           "system": "http://fhir.ona.io",
           "code": "000002"
         }
       }
     ]
   }
   ```
   
5. `forms`

   | Attributes               | Description                                                          | Type |
   | :----------------------------- | :------------------------------------------------------------------------ | :--- |
   | forms           | Sets the list of Questionnaire to be used in the app                           | List&lt;QuestionnaireConfig&gt; |
   
   #### Structure of `QuestionnaireConfig`
   
   | Attributes               | Description                                                          | Type |
   | :----------------------------- | :------------------------------------------------------------------------ | :--- |
   | form           | Sets the unique name of this Questionnaire form      | String |
   | title           | Sets the display title                       | String |
   | identifier           | Sets the actual id of the Questionnaire resource                | String |
   | saveButtonText           | Sets the text of the Questionnaire save button                      | String? |
   | setPractitionerDetails        | Sets whether to append Practitioner details when saving QuestionnaireResponse                   | Boolean |
   | setOrganizationDetails        | Sets whether to append Organization details when saving QuestionnaireResponse                        | Boolean |
   
   ```json
   {
     "appId": "ecbis-saa",
     "classification": "forms",
     "forms": [
       {
         "form": "anc-patient-registration",
         "title": "Enroll as ANC Patient",
         "identifier": "1924"
       },
       {
         "form": "family-member-registration",
         "title": "Add Family Member",
         "identifier": "32821"
       }
     ]
   }
   ```
   
7. `patient_register`
   
   | Attributes               | Description                                                          | Type |
   | :----------------------------- | :------------------------------------------------------------------------ | :--- |
   | appTitle           | Sets the app display title on the side menu      | String |
   | filterText           | Sets the text on the filter button at the top bar     | String |
   | showFilter        | Sets whether to show the filter button at the top bar when using the side menu mode            | Boolean |
   | newClientButtonText           | Sets the text on the register client button                      | String |
   | newClientButtonStyle        | Sets the background style name of register client button that is available in the drawable e.g rounded_corner           | String |
   | showNewClientButton        | Sets whether to show the register client button                      | Boolean |
   | registrationForm        | Sets the Questionnaire form name for client registration            | String |
   | searchBarHint           | Sets the hint text on the search bar               | String |
   | showSearchBar        | Sets whether to show the search bar                       | Boolean |
   | showScanQRCode        | Sets whether to show QR scanner button             | Boolean |
   | showSideMenu        | Sets whether to show side menu            | Boolean |
   | showBottomMenu        | Sets whether to show side bottom menu            | Boolean |
   | useLabel        | Sets whether to use label for all the row items. Will use icon if it's false        | Boolean |
   | showHeader        | Sets whether to show to header / top bar        | Boolean |
   | showFooter        | Sets whether to show to footer / the bottom side of the layout        | Boolean |
   | bottomNavigationOptions        | Sets the bottom navigation options      | List&lt;NavigationAction&gt; |
   
   #### Structure of `NavigationAction`
   
   | Attributes               | Description                                                          | Type |
   | :----------------------------- | :------------------------------------------------------------------------ | :--- |
   | id           | Sets menu options id      | String |
   | title           | Sets the display title of the menu option                      | String |
   | icon           | Sets the icon name that is available in the drawable                      | String |
   | action           | Sets the action to switch fragment when clicked   | ActionSwitchFragment |
   
   #### Structure of `ActionSwitchFragment`
   
   | Attributes               | Description                                                          | Type |
   | :----------------------------- | :------------------------------------------------------------------------ | :--- |
   | type           | Sets the switch action type. Always set it as switch_fragment      | String |
   | tag           | Sets the switch destination name      | String |
   | isRegisterFragment           | Sets whether the switch destination is the Home register     | Boolean |
   | isFilterVisible           | Sets whether to show the filter button when using bottom menu mode      | Boolean |
   | toolbarTitle           | Sets the toolbar title when using bottom menu mode     | String? |
   
   
   ```json
   {
     "appId": "quest",
     "classification": "patient_register",
     "appTitle": "Clients",
     "filterText": "Show overdue",
     "searchBarHint": "Search for ID or client name",
     "newClientButtonText": "Register new client",
     "newClientButtonStyle": "rounded_corner",
     "showSearchBar": true,
     "showFilter": false,
     "showScanQRCode": false,
     "showNewClientButton": true,
     "showSideMenu": false,
     "showBottomMenu": true,
     "registrationForm": "3435",
     "primaryFilter": {
       "key": "_tag",
       "filterType": "TOKEN",
       "valueType": "CODING",
       "valueConding": {
         "system": "http://fhir.ona.io",
         "code": "000003"
       }
     },
     "bottomNavigationOptions": [
       {
         "id": "menu_item_clients",
         "title": "Clients",
         "icon" : "ic_users",
         "action": {
           "type": "switch_fragment",
           "tag": "PatientRegisterFragment",
           "isRegisterFragment": true,
           "isFilterVisible": false,
           "toolbarTitle": null
         }
       },
       {
         "id": "menu_item_settings",
         "title": "Settings",
         "icon" : "ic_settings",
         "action": {
           "type": "switch_fragment",
           "tag": "UserProfileFragment",
           "isRegisterFragment": false,
           "isFilterVisible": false,
           "toolbarTitle": "Settings"
         }
       }
     ]
   }
   ```
8. `sync`
   
   | Attributes               | Description                                                          | Type |
   | :----------------------------- | :------------------------------------------------------------------------ | :--- |
   | resourceType           | Sets the resource type. Always set it as Parameters      | String |
   | parameter           | Sets the list of SearchParameter and resources to be synced      | List&lt;SearchParameter&gt; |
   
   #### Structure of `SearchParameter`
   
   Each `SearchParameter` is nested with `resource` attribute.
      
   | Attributes               | Description                                            | Type |
   | :----------------------- | :----------------------------------------------------- | :--- |
   | resourceType   | Sets the resource type. Always set it as SearchParameter         | String |
   | name           | Sets the parameter name, that decides which value to get for the key   | String |
   | code           | Sets the parameter key, that will be used in API request url    | String |
   | base           | Sets the list of Resource to be synced      | List&lt;String&gt; |
   | expression     | Sets the parameter expression, that helps to append the value of that key by matching it with the parameter name  | String |
   
   ```json
   {
     "appId": "ecbis-saa",
     "classification": "sync",
     "resourceType": "Parameters",
     "parameter": [
       {
         "resource": {
           "resourceType": "SearchParameter",
           "name": "organization",
           "code": "organization",
           "base": [
             "Patient"
           ],
           "expression": "#organization"
         }
       },
       {
         "resource": {
           "resourceType": "SearchParameter",
           "name": "organization",
           "code": "subject.organization",
           "base": [
             "Encounter","Observation","Condition","CarePlan","QuestionnaireResponse", "Task"
           ],
           "expression": "#organization"
         }
       }
     ]
   }
   ```
   
TODO:

structure of each config classification: what each attribute does (or used in-app)

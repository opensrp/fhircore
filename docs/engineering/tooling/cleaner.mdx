# FHIR Resources Cleaner

This script can be used to clean/delete resources from the FHIR api

## Options
The following are command options for running the script

* `resource_type` : (Required) This is the resource type eactly as it appears on FHIR (since it is passed on to build the url) e.g Location, Patient etc
* `parameter` : (Required) This is the parameter that is going to be used to filter the resources as they are getting pulled from the api e.g name, lastUpdated etc
* `value` : (Required) This is the actual value of the parameter provided to filter the resources e.g Nairobi, lt2023-08-02 etc
* `batch_size`: (Not required) This is the batch size of resources pulled. The default value is 1000
* `expunge`: (Not required) This is a boolean value that tells the function whether it should expunge the deleted data or not. The default is set to false. __NOTE: This does not work with a filter, it will expunge all deleted resources of the specified resource type__

### To run script
1. Create virtualenv
2. Install requirements.txt: `pip install -r requirements.txt`
3. Create a `config.py` file. The `sample_config.py` is an example  of what this should look like. Populate it with the right credentials
4. Run script - `python3 main.py --resource_type Locations --parameter lastUpdated --value lt2023-03-01`
5. You can turn on logging by passing a `--log_level` to the command line as `info`, `debug` or `error`. 

## To test

To run all tests
```console
$ pytest
```
To run specific tests
```console
$ pytest path/to/test_file.py::TestClass::test_function
```

To run tests and generate a coverage report
```console
$ pytest --junitxml=coverage.html --cov=importer --cov-report=html
```
The coverage report `coverage.html` will be at the working directory
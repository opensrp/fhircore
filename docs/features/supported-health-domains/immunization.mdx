# Immunization

The OpenSRP Electronic Immunization Registries (EIR) Package empowers healthcare workers to seamlessly manage and coordinate immunization delivery at the facility and community level within a WHO standards-based platform. Even in offline settings, Ona’s EIR tool enables you to accurately register households and individuals at both the facility and community level; efficiently enroll patients in their care plans ensuring that no one falls through the cracks; schedule immunization follow-up tasks so that every patient receives their vaccines on time; and record immunizations accurately.   Data is automatically tallied for the health workers with all data flowing in real-time dashboards for decision making reducing the burden of time consuming paper-based reporting.

The EIR package leverages the next-gen FHIR-native OpenSRP 2 platform, which enables it to support the WHO SMART Guidelines and ensures seamless interoperability with other national platforms like DHIS2.

![immunization record](/img/iz-domain/iz-profile-register.png)

## Features and functionality

- *Patient registration and management* - register patients, capture demographic data and assign unique user ids while checking to prevent duplicate registrations.
- *WHO Immunization Care Guidelines* - automatically creates immunization schedules based on WHO guidelines.  The EIR package currently supports all WHO child immunization, Covid-19 and HPV vaccine recommendations.  It can be expanded to support new vaccines (eg. Malaria) and localized to align with MoH country guidelines.
- *Record Services* - record patient immunizations including the antigen/vaccine, dose, lot and date given.  Track when vaccines are refused and capture the reason why.
- *Optimizes for on and off-line settings* - Works offline and is designed to work equally well in a facility or outreach setting.
- *CHW Companion App* - ensure no child is missed with an included CHW application that enables team based care between facility staff and CHWs at the community level.  Eg. All children registered by CHWs will automatically enroll for care at the facility.
- *Safety monitoring* - record when a patient experiences adverse events and link this to the specific vaccine and lot number to help ensure patient follow-up.
- *Growth Monitoring* - the application supports growth and nutrition monitoring including automatic Z-score calculation and MUAC measurements.
- *Stock Management* - a built in stock module supports stock-taking, resupply, consumption tracking, and wastage that is automatically calculated based on usage in the app.  The stock module can be integrated with LMIS helping to provide important visibility on vaccine demand to prevent stockouts.
- *Vital Statistics* - optional CRVS module to capture birth and death notifications and/or registrations and the issuance of birth certificates.
- *In-app Reporting* - automatically calculate immunization service data statistics eliminating the need for time consuming paper-based tally sheets.
- *Real-time Analytics* - visualize program data on interactive dashboards with rich geospatial support to show coverage and risk areas.
- *Client Messaging* - leverage built integrations with platforms like RapidPro and Turn to send immunization reminders and educational messaging that can increase vaccine demand and uptake.
- *Precision health* - leverage the built in geo-widget to target at risk communities and households for service delivery.
- *Integrations* - built in integration ensures all data flows seamlessly into DHIS2. Integrations with common LMIS, CRVS are also possible.
- *Interoperability* - OpenSRP is HL7 FHIR native ensuring best-in class interoperability to enable seamless two-way data flows with other systems.

## Quickstart guide

### Core workflows
Building a FHIR Based EIR (Electronic Immunization Registry) system involves integrating various healthcare workflows such as patient registration, vaccination, tracking, and reporting using standardized FHIR resources. Here’s a high-level breakdown for each component from a FHIR Resource Mapping perspective:

1. Registration

	-	FHIR Resources: Patient, Practitioner, Organization, Location

	Details:

	-	Use the Patient resource to manage patient demographics, contact information, and identifiers (like national IDs or health insurance numbers).
	-	For healthcare providers or practitioners administering the vaccines, use the Practitioner resource.
	-	Clinics or organizations that provide vaccinations can be represented with the Organization/Location(Type:Building) resource.

	Workflow:

	-	A patient registers at a vaccination site or via an online portal.
	-	The system creates or updates a Patient resource and is visible in a Household/Patient Register
	-	The Practitioner administering the vaccine is registered using the Practitioner resource from Patient Profiles

2. Vaccination

	-	FHIR Resources: Immunization, Medication, Observation

	Details:

	-	The Immunization resource is used to record the vaccine administered, the date, the manufacturer, the dose, and the route of administration.
	-	Use the Medication resource to track vaccine details, including its lot number, expiry date, and ingredients.
	-	If any observations (e.g., side effects, adverse reactions) are required during or after vaccination, capture them using the Observation resource.

	Workflow:

	-	fter administering the vaccine, the system records the vaccination details in the Immunization resource.
	-	The vaccine information such as type, batch number, and expiry is recorded using the Medication resource (optional).
	-	Any side effects are recorded as Observations (optional).

3. Tracking

	-	FHIR Resources: Immunization, ImmunizationRecommendation, Schedule, Appointment

	Details:

	-	Use the Immunization resource to track all vaccinations given to a patient.
	-	The ImmunizationRecommendation resource helps schedule follow-up doses based on patient age, vaccination history, and guidelines (optional).
	-	You can leverage Schedule and Appointment resources to schedule future vaccinations (optional). Tasks resourece is being used in place of these 2 resource 

	Workflow:

	-	Once a patient receives their first dose, an ImmunizationRecommendation is generated for the next dose (optional).
	-	The system can generate a schedule for the patient’s remaining doses using Schedule and Appointment resources. Tasks resourece is being used in place of these 2 resource 

4. Reporting

	-	FHIR Resources: Immunization, MeasureReport 

	Details:
	-	Aggregated vaccination data can be reported using the MeasureReport resource, which summarizes immunization status at individual and population levels.

	Workflow:

	-	Generate reports for public health officials on vaccination coverage and identify gaps.
	-	Use the MeasureReport resource to analyze vaccination status by region, age group, or other demographic filters.


### Additional workflows 

1. MUAC (Mid-Upper Arm Circumference)

•	FHIR Resources: Observation

	Details:

	-	MUAC is a key indicator for assessing malnutrition in children. Use the Observation resource to capture the measurement of the arm circumference.
	-	The value for MUAC will be recorded as a quantity with units (e.g., cm or mm) and will have a code indicating it is a MUAC measurement.

	Workflow:

	-	During the patient’s visit, the healthcare provider measures the child’s MUAC.
	-	An Observation resource is created, capturing the measurement value, the method (e.g., tape measurement), and any interpretation (e.g., normal, moderate malnutrition, severe malnutrition).
	-	Observation may also contain other related data, such as the practitioner who recorded the measurement and the encounter in which the observation occurred.

2. Growth Monitoring

•	FHIR Resources: Observation, FamilyMemberHistory, Patient

	Details:

	-	Growth monitoring involves tracking height, weight, head circumference, and comparing these metrics to standardized growth charts.
	-	Use the Observation resource to record parameters like weight (LOINC 3141-9), height (LOINC 8302-2), and head circumference (LOINC 8287-5).
	-	FamilyMemberHistory can also be used to track genetic or hereditary conditions that may affect growth patterns(optional).

 	Workflow:

	-	During a clinic visit, the system collects a child’s growth parameters (height, weight, etc.) and stores these as Observation resources.
	-	These observations can be plotted against standard growth charts to evaluate if the child is growing at a normal rate.
	-	If there are concerns (e.g., stunted growth), the healthcare provider can use Observation to indicate a need for follow-up.

3. Adverse Reaction Tracking

•	FHIR Resources: AdverseEvent, AllergyIntolerance, Condition, Observation

	Details:

	-	Use the AdverseEvent resource to capture any adverse reactions following vaccination, such as fever, rash, or more severe reactions like anaphylaxis.
	-	If the adverse reaction is related to an allergy, you may also use the AllergyIntolerance resource to track any long-term contraindications or allergic responses(optional).
	-	Condition can also be used if the adverse reaction results in a medical condition that requires ongoing treatment.

	Workflow:

	-	After vaccination, if the patient reports an adverse reaction, the healthcare provider records the details in an AdverseEvent resource.
	-	If necessary, further evaluations (e.g., temperature or blood pressure) can be recorded using Observation resources to monitor the reaction.
	-	The system can trigger alerts for serious reactions, schedule follow-up visits, or provide contraindication warnings for future doses.


### Deploying the health information infrastructure

Building a FHIR Core app using OpenSRP FHIRCore requires familiarity with both the OpenSRP platform and the HL7 FHIR (Fast Healthcare Interoperability Resources) standard. 
The FHIRCore project, built on OpenSRP, is designed to facilitate the development of healthcare applications that interact with FHIR-compliant data stores. Here’s a step-by-step guide
to help you build a FHIR Core app using this repository:

#### Prerequisites

	1.	Technical Knowledge:

		-	Basic understanding of the FHIR standard.
		-	Familiarity with Android development (Java/Kotlin).
		-	Familiarity with Gradle, Docker, and possibly Kubernetes (if you are running OpenSRP in a containerized environment).

	2.	Required Tools:

		-	Java Development Kit (JDK 11 or above).
		-	Android Studio.
		-	Git (for cloning the repository).
		-	Docker (optional for local server setup).

	3.	FHIR Server:

		-	See more here  - Link to server setup 

#### Step-by-Step Guide

1. Clone the FHIRCore Repository

Start by cloning the repository to your local machine.

````
git clone https://github.com/opensrp/fhircore.git
cd fhircore
````
2. Set Up Development Environment

	-	Install the latest version of Android Studio and configure the SDK.

	-	Open the cloned fhircore project in Android Studio.

Ensure that you have the appropriate Android SDKs installed. The project usually targets SDK 30 (Android 11) or above, so make sure you have this version or later installed in your environment.

3. Build the Project

Before you can start working on the app, you will need to sync the project with Gradle to install dependencies and build the project.

	-	Open Android Studio.

	-	Navigate to the project folder and open the build.gradle file.

	-	Click the Sync Project with Gradle Files button in Android Studio to install dependencies.

	-	Update local.properties file by providing the required Keycloak credentials to enable syncing of data to and from the HAPI FHIR server:

		````
		#oauth configurations
		OAUTH_BASE_URL=https://keycloak-stage.smartregister.org/auth/realms/FHIR_Android/
		OAUTH_CLIENT_ID="provide client id"
		OAUTH_SCOPE=openid

		#fhir store base url
		FHIR_BASE_URL=https://fhir.labs.smartregister.org/fhir/

		#sentry dsn
		SENTRY_DSN=<https://your/sentry/project/dsn>

		#Optional: Application id for a specific build variant
		#OPENSRP_APP_ID="app/debug"

		````

Once synced, click on Build > Make Project to compile the code. 

For more infomration read more [here](https://docs.opensrp.io/engineering/app/developer-setup)


### Deploying the reference content

To load into the OpenSRP FHIR Core app on demand, for debug and development, you can create a symbolic link using:

```sh
git clone git@github.com:ona-health/giz-eir-fhir-resources.git
# assuming you have checked out fhircore in the same directory
mkdir -p fhircore/android/quest/src/gizeir/assets/configs
ln -s `pwd`/giz-eir-fhir-resources/app/* fhircore/android/quest/src/gizEir/assets/configs/gizeir
```

The app is able to use content for configuration resources from the `configs/app/resources` directory in the assets directory. Ideally, any FHIR resource can be loaded into
 the application through the assets.The current impleme. ntation loads the configuration resources declared in the Composition (including Questionnaires, StructureMaps, PlanDefs, Lists, etc) by retrieving them 
from the server, which requires the device to be online. This enhancement should allow the user to create config directories for the resources inside `/configs/app/resources`.
 The resources directory name should be in lowercase format e.g. `configs/app/resources/binary`, `configs/app/resources/questionnaire`, `configs/app/resources/structuremap`, 
 `configs/app/resources/plandefinition`, etc.





## App configs

### Implemntation Guide Config 
https://github.com/ona-health/giz-eir-fhir-resources/blob/main/app/implementation_guide_config.json

![ig config](/img/eir_configs/ig-config.png)

An Implementation Guide (IG) is a document that defines how a specific organization or system uses FHIR resources to solve a particular use case. 

Main Structure:

- resourceType: "ImplementationGuide"	

		- This indicates that the resource type is an Implementation Guide (IG), which provides detailed guidance for how FHIR resources are used in a specific context or implementation.

- id: "13057302"

		- A unique identifier for this specific Implementation Guide.

- meta:

		- This contains metadata about the Implementation Guide.

- versionId: "1" – The version of this IG document.

		- lastUpdated: "2024-05-27T14:42:53.345+00:00" – The date and time when this Implementation Guide was last updated (in ISO 8601 format).

- url: "https://fhir.eir.smartregister.org/fhir/ImplementationGuide/giz-eir"

		- The URL where this Implementation Guide can be accessed. It seems to be hosted at fhir.eir.smartregister.org under the path /fhir/ImplementationGuide/giz-eir.

- version: "1.0.0"

		- The version of the Implementation Guide, indicating it’s the first official release (1.0.0).

- name: "giz-eir"

		- The name of the IG 

- title: "GIZ/PATH EIR Implementation Guide"

		- A more descriptive title for the Implementation Guide

- status: "draft"

		- The status of the IG, which is still in a draft state (not finalized or published as an official version).

- date: "2024-05-27"

	-	The date when the guide was created or last updated.

- publisher: "Ona Systems, Inc."

	-	This field indicates that the guide was published by Ona Systems, Inc., which is a tech company involved in health system development.

Context:

- useContext:

		- This section provides contextual information about how or where the Implementation Guide should be used.

- valueRange:

		- This particular useContext seems to suggest a value range with a high value of 11. This could relate to patient age, system thresholds, or another contextual element specific to the EIR.

Package and Resource Definitions:

- packageId: "org.smartregister.fhircore"

		- This defines the package ID for the IG, which seems to be part of the Smart Register FHIR Core system, likely the underlying framework powering the EIR system.

- definition:

		- This contains definitions for resources included in the Implementation Guide.

- resource:

		- A list of resources referenced by this Implementation Guide.

- reference:

		- This points to a Composition resource (Composition/12965652), which likely contains additional narrative content, instructions, or descriptions related to the IG. The Composition resource is commonly used for documents or structured narratives.



### Composition Config 
https://github.com/ona-health/giz-eir-fhir-resources/blob/main/app/composition_config.json

![composition config](/img/eir_configs/composition-config.png)

Core Composition Information

- resourceType: "Composition"

		- This indicates that the resource is a FHIR Composition resource, which typically represents a collection of content or sections.

- id: "12965652"

		- A unique identifier for this Composition resource.

- meta:

		- Contains metadata.

- versionId: "22"
		- The current version of this Composition document.

- lastUpdated: "2024-09-10T12:33:34.976+00:00" 
		- The timestamp when the Composition was last updated.

- identifier:

	-	use: "official" 
		- Indicates that this identifier is an official one.

	-	value: "giz-eir" 
		- The identifier for the GIZ EIR configuration.

- status: "final"

	-	The Composition is marked as final, meaning it’s in a complete and stable state.

	-	type:

	-	system: "http://smartregister.org" 
		- The system for coding the type of composition.

- code: "1156600005" 
	
		- Code for “Device setting parameter.”

- display: "Device setting parameter" 
	
		- Describes the document as relating to device configuration settings.

- date: "2022-09-16"

		- The date when this Composition was created or finalized.

- title: "Device configurations"

		- The title of the Composition document, which indicates that it holds device configuration settings.

- confidentiality: "L"

		- A confidentiality level of “L,” which usually means low confidentiality (public information).

Sections Breakdown

Each section contains a specific configuration for different parts of the application.

	1.	Profile Configurations:

		- Contains various configuration profiles for the Child (e.g., child profile, past and upcoming encounters, adverse reactions) and Caregiver.

		- The focus field references Binary resources that hold the actual configuration data, identified by their IDs and values.

	2.	Register Configurations:

		- Specifies register settings for Children and Caregivers.

		- Similar to profiles, the focus references Binary resources that contain register configurations.

	3.	Translation Configurations:

		- Contains translation settings for English, Spanish, and French. Each of these sections refers to a Binary resource that holds translation strings.

	4.	Application Configuration:

		- Refers to the application configuration, stored in a Binary resource, which likely holds the general app settings.

	5.	Navigation Configuration:

		- Specifies the navigation configuration for the application, also stored in a Binary resource.

	6.	Sync Configuration:

		- Defines the synchronization settings for the application, stored in a Binary resource.

	7.	Health Facility Locations:

		- Refers to a List resource containing health facility locations.

	8.	PlanDefinitions:

		- Provides definitions for care plans, particularly focusing on Child Immunization and Child Recurring Services.

	9.	Questionnaires:

		- Lists several questionnaire configurations related to patient management, such as adding a patient, recording doses, registering filters, and muting/unmuting patients.

	10.	StructureMaps:

		- Specifies mappings for various operations like patient and child registration, dose recording, and adverse event reporting, using StructureMap resources.

	11.	Geo Widget Configurations:

		- Defines the Geo Widget configuration, stored in a Binary resource. This likely deals with mapping or geolocation services within the application.


### Application Config 
https://github.com/ona-health/giz-eir-fhir-resources/blob/main/app/application_config.json

![application config](/img/eir_configs/application-config.png)


 Here’s a detailed breakdown of the various fields in the config:

	1.	appId: "giz-eir"

		- This is the unique identifier for the application. 

	2.	configType: "application"

		- Specifies the type of configuration; here, it indicates the configuration is for an application.

	3.	theme: "DEFAULT"

		- Defines the UI theme to be used in the application. Here, it’s set to DEFAULT, which probably corresponds to the app’s standard design.

	4.	appTitle: "EIR"

		- The title of the application, which in this case is “EIR” (Electronic Immunization Registry).

	5.	remoteSyncPageSize: 250

		- Specifies the number of records to be fetched or synced from the server at a time during synchronization. Here, it is set to 250 records per sync operation.

	6.	languages: ["en", "es", "fr"]

		- The application supports multiple languages, specifically English (en), Spanish (es), and French (fr).

	7.	useDarkTheme: false

		- Indicates whether the app uses a dark theme. This is set to false, so a light theme is used by default.

	8.	syncInterval: 30

		- This specifies how frequently (in minutes) the app will automatically synchronize with the server. In this case, it syncs every 30 minutes.

	9.	syncStrategy: ["CareTeam"]

		- This suggests that the synchronization strategy involves syncing data related to care teams. It might mean that data for care teams, such as patient rosters, are synchronized.

	10.	loginConfig:•	
			````json
			{
			"showLogo": true,
			"enablePin": true,
			"pinLength": 4
			}
			````
	This section defines the configuration for the login screen.

		- "showLogo": true ensures that a logo is displayed on the login screen.

		- "enablePin": true allows users to log in using a PIN.

		- "pinLength": 4 specifies that the PIN should be 4 digits long.

	11.	settingsScreenMenuOptions: ["MANUAL_SYNC", "SWITCH_LANGUAGES", "RESET_DATA", "INSIGHTS"]

		- Defines the menu options available on the settings screen:

		- "MANUAL_SYNC": Allows users to trigger a manual synchronization.

		- "SWITCH_LANGUAGES": Provides an option to switch between the supported languages.

		- "RESET_DATA": Lets users reset the app’s data.

		- "INSIGHTS": This might be an option to view data insights or reports.

### Sync Config 
https://github.com/ona-health/giz-eir-fhir-resources/blob/main/app/sync_config.json

![sync config](/img/eir_configs/sync-config.png)

This configuration is related to synchronization settings, specifically defining search parameters for resource filtering during FHIR-based data sync operations. Here’s a breakdown of the fields and what they represent:

Main Structure:

	-	resourceType: "Parameters"

		- This indicates that the root resource type is Parameters, which is a FHIR resource type used to pass configuration and operational data in the form of parameters.

	-	configType: "sync"

		- This specifies that the configuration type is related to data synchronization.

	-	parameter:

		- This is an array containing search parameters for synchronization. Each element in the array defines a SearchParameter resource that is used to filter data during sync operations. These parameters define which fields or data types are used in the syncing queries.

Search Parameters:

	1.	First Search Parameter: _id

	-	resourceType: "SearchParameter"

		-	Defines that this is a SearchParameter resource.

	-	name: "_id"

		-	The name of the search parameter is _id. This is likely the unique identifier of each resource (i.e., the resource’s ID).

	-	code: "_id"

		-	The search code is _id, corresponding to the resource’s ID.

	-		base:

			- The base field lists the FHIR resource types to which this search parameter applies. In this case, the search parameter can filter by _id on the following resource types:

					- CarePlan

					- Condition

					- Consent

					- Encounter

					- Group

					- Immunization

					- etc.

	2.	Second Search Parameter: count

	-	resourceType: "SearchParameter"

		-	Defines another search parameter resource.

	-	name: "count"

		-	The name of this search parameter is count. It likely refers to the number of results or records to be returned.

	-	code: "_count"

		-	The code for the search parameter is _count, which limits the number of records returned in a query.

	-	base:

		-	his search parameter can also apply to the same resource types as _id:

		-	CarePlan, Condition, Consent, Encounter, etc.

		-	type: "token"

		-	The parameter type is token, indicating that the value is expected to be a discrete value like a code, identifier, or string literal.

	-	expression: "#count"

		-	The expression indicates that the parameter refers to the number of results or “count” of items to be returned during a query. It’s probably used for pagination or limiting the size of the results.


### Navigation Config 
https://github.com/ona-health/giz-eir-fhir-resources/blob/main/app/navigation_config.json

![navigation config](/img/eir_configs/navigation-config.png)

Core Information

	-	appId: "giz-eir"

	-	Identifies the application as the GIZ EIR.

	-	configType: "navigation"

	-	Specifies that this configuration deals with the navigation elements of the app.

Main Action Button Configuration

	-	menuActionButton:

	-	id: "mainActionButton" 

		-	The unique identifier for the main action button in the app.

	-	visible: true 

		-	Indicates that this button is visible to users.

	-	display: `"{{ dece90802392bb0289660c633eddd5e4 }}"` 

		-	A placeholder or string ID for the text displayed on the button, likely referring to a localized string.

	-	actions: Defines what happens when the button is clicked:

	-	trigger: "ON_CLICK" 

		-	The action is triggered when the button is clicked.

	-	workflow: "LAUNCH_QUESTIONNAIRE" 
	
		-	Launches a questionnaire when clicked.

	-	questionnaire: Describes the specific questionnaire that will be launched:

	-	id: "13030180" 

		-	The questionnaire ID.

	-	title: `"{{ dece90802392bb0289660c633eddd5e4 }}"` 

		-	The title of the questionnaire, using a localized string placeholder.

	-	saveButtonText: `"{{ c9cc8cce247e49bae79f15173ce97354 }}"`  
	
		-	Text for the save button, also using a localized string.

	-	groupResource: Defines how to handle group-related data in the questionnaire.

	-	groupIdentifier: `"@{familyLogicalId}"`  
	
		-	Uses a dynamic value for the group.

	-	memberResourceType: "Patient" – Specifies that group members are patients.

	-	snackBarMessage: A message displayed to users after an action:

	-	message: `"{{ 8b41faf441db854f6c4066bbbb6837f2 }}"`  
	
		-	The snackbar message, using a localized string.

	-	actionLabel: "UNDO"  
	
		-	Text for the undo button.

	-	duration: "Short"  
	
		-	The duration for which the message is displayed.

	-	configRules: Defines rules for dynamically configuring the questionnaire.

	-	The rule here generates a six-digit human-readable ID.

	-	extraParams: Additional parameters to prepopulate the form:

	-	paramType: "PREPOPULATE"  
	
		-	The type of parameter.

	-	linkId: `"0d77d40f-098b-4329-9199-33b6e77aa864"` 	 
	
		-	ID of the element in the form to populate.

	-	dataType: "INTEGER"  
	
		-	The type of data.

	-	key: "opensrpId"  
	
		-	The key for the value.

	-	value: `"@{humanReadableId}"`  
	
		-	The dynamically generated value.

	-	setPractitionerDetails: true  
	
		-	Ensures practitioner details are included.

	-	: true  
	
		-	Ensures organization details are included.

Client Registers Configuration

This section defines the client registers in the app. Each register has a unique ID, display text, and actions associated with it.

	1.	Caregiver Register: 
	
		-	id: `"caregiverRegister"` 

	– ID for the caregiver register. 
	
		-	display: `"{{ 34fc9c26c4ad487a175c2e7b85eb9b6d }}"` 

	– Localized string for the display text. 
	
		-	showCount: true 

	– Indicates that the count of entries will be shown. 
	
		-	menuIconConfig: Specifies the icon for this register: 
	
		-	type: "local" 

	– Refers to a locally stored icon. 
	
		-	reference: `"ic_baby_mother"` 

	– The icon file. 
	
		-	actions: Defines actions related to the register: 
	
		-	ON_CLICK: Triggers when the register is clicked, launching the caregiver register. 
	
		-	ON_COUNT: Triggers when the count of entries is required.

	2.	Child Register: 
	
		-	id: `"childRegister"` 

	– ID for the child register. 
	
		-	display: `"{{ 64e4aca4297806247f62a7b5f8cbd3df }}"` 

	– Localized string for the display text. 
	
		-	showCount: true 

	– Indicates that the count of entries will be shown. 
	
		-	menuIconConfig: Specifies the icon for the child register:

	-	type: `"local"`  
	
		-	Refers to a locally stored icon. 
	
		-	reference: `"ic_children"` 

	– The icon file. 
	
	-	actions: 
	
		-	ON_CLICK: Triggers when the register is clicked, launching the child register. 
	
		-	ON_COUNT: Triggers when the count of entries is required.

Static Menu Configuration

This section defines static menu items that are always visible in the app.

	1.	Settings Menu: 
	
		-	id: "settings" 

	– The ID for the settings menu. 
	
		-	visible: true 

	– The menu item is visible to users. 
	
		-	display: `"{{ f4f70727dc34561dfde1a3c529b6205c }}"` 

	– Localized string for the settings label. 
	
		-	menuIconConfig: Specifies the icon for the settings menu: 
	
		-	type: "local" 

	– Refers to a locally stored icon. 
	
		-	reference: "ic_settings" 

	– The icon file. 
	
		-	actions: 
	
		-	ON_CLICK: Triggers the settings workflow when clicked, navigating to the settings screen.

### List Config 
https://github.com/ona-health/giz-eir-fhir-resources/blob/main/list/locations.json

![location list config](/img/eir_configs/list.png)

Core Information

	-	resourceType: "List" 
	
		-	Specifies that this is a FHIR List resource.

	-	id: "0571e685-362e-4d8b-b227-a3678ad5420c-420" 
	
		-	The unique identifier for this list.

	-	meta: Contains metadata about the resource.

	-	versionId: "1"  
	
		-	The version of this resource.

	-	lastUpdated: "2024-07-07T19:28:30.567+00:00"  
	
		-	Timestamp of the last update to this resource.
	
	-	identifier: An official identifier for the list.

	-	use: "official"  
	
		-	Indicates that this is the official identifier.

	-	value: "0571e685-362e-4d8b-b227-a3678ad5420c-420"  
	
		-	The value of the identifier.

	-	status: "current" 
	
		-	Indicates that the list is active and currently used.

	-	mode: "working" 
	
		-	The mode of the list, indicating that it is actively being worked on or used.

	-	title: "Health Facility Locations" 
	
		-	The title of the list.

	-	code: Specifies the coding details for the list.

	-	coding: A list of coding elements describing the resource:

	-	system: "http://ona.io"  
	
		-	The system that defines the code (in this case, Ona). 
	
	-	code: "health-facility-locations"  
	
		-	The specific code for health facility locations.

	-	display: "Health Facility Locations" 
	
		-	The display text for the code.

	-	text: "Health Facility Locations"  
	
		-	A human-readable description of the list.


Entries

This section contains the individual entries or items in the list, each referencing a health facility location. Each entry is represented by an item with a reference to a location resource.

	-	item: Each item contains a reference to a specific health facility location in the FHIR Location resource.
	-	Example: "reference": `"Location/1f4c76e1-9734-42d9-b5b8-4b213ee48d45"` refers to a health facility with a specific Location resource ID.

### Geowidget Config

https://github.com/ona-health/giz-eir-fhir-resources/blob/main/app/maps/location_map_config.json

![location config](/img/eir_configs/location-config.png)


Core Information

	-	appId: "giz-eir" 
	
		-	The application ID, likely for a specific healthcare or resource tracking system.
	
	-	id: "locationMap" 
	
		-	Identifier for this specific widget (in this case, a map).

	-	configType: "geoWidget" 
	
		-	The configuration type is a geo widget, indicating that this component will display geographic or location-based information.

	-	profileId: "caregiverProfile" 
	
		-	Indicates the profile type, likely related to caregivers in this application.

Map Layers

	-	mapLayers: A list of available map layers with their activation states:

	-	STREET: Active.
	
	-	SATELLITE: Inactive.

	-	STREET_SATELLITE: Inactive.

Registration Questionnaire

	-	registrationQuestionnaire: Defines a questionnaire associated with location registration.

	-	id: "13030180" 
	
		-	title and saveButtonText: Referencing strings using placeholders (e.g., `{{ a3401a36929da1f4e0ee28f9d5d52ba7 }}`), likely translated or dynamically inserted text. 
	
		-	setPractitionerDetails and setOrganizationDetails: Both set to true, indicating that practitioner and organization details are to be set during registration.

Resource Configuration

	-	resourceConfig: Configuration related to the Location resource.

	-	baseResource: Refers to Location, and includes a query to filter locations by type (238497).

	-	relatedResources: Describes relationships to other resources:

	-	servicePointInventoryItems: A List resource related to the location.

	-	availableRelatedPersons: A RelatedPerson resource, tied to the service point.

	-	availablePatients: A Patient resource, linked through related persons.

	-	availableTasks: A Task resource, linked through patients, used for task tracking (e.g., due or overdue tasks).

Service Point Configuration

	-	servicePointConfig: Defines rules for managing service points, such as:

	-	childCount: Calculates the number of children associated with the service point.

	-	dueTaskList and overdueTaskList: Filters available tasks by their status (e.g., “ready” or “in-progress”).

	-	taskStatus: Determines the status of tasks (e.g., overdue or due).

	-	servicePointId, name, locationId, status, type, servicePointType: Various metadata associated with the service point, including the location type, its status, and a service point image.

	-	servicePointProperties: Dynamic properties used in the UI for a service point, such as the task status, name, type, and counts of children and tasks.

Summary Bottom Sheet

	-	summaryBottomSheetConfig: Defines a summary view or pop-up that shows detailed information in a card-like layout.

	-	Contains compound text (e.g., primary text, font size, color), buttons (e.g., “View Profile”), and actions triggered when the button is clicked (launches a profile view using the caregiverProfile ID).

Display Options

	-	showAddLocation: false  
	
		-	Indicates whether the “add location” option is visible.

	-	showPlaneSwitcher: true 
	
		-	Enables switching between map layers (e.g., street, satellite).

	-	showLocation: true 
	
		-	Indicates that locations are visible on the map.

Actions

	-	actions: Defines triggers for when a user interacts with the map or specific elements. For example:

	-	summaryBottomSheet: When clicked, launches a summary view using parameters like servicePointId.

Top Screen Section

	-	topScreenSection: Contains configuration for the top section of the map screen.

	-	title: Placeholder for the screen’s title.

	-	searchBar: Visible search bar that allows users to search by name.

	-	menuIcons: Contains an icon for service points, and clicking it launches the caregiver register.



### Profiles Config

More [here](http://localhost:3000/engineering/app/configuring/config-types/profile) on how to configure profiles

#### Caregiver Profile Config

https://github.com/ona-health/giz-eir-fhir-resources/blob/main/app/profiles/caregiver_profile_config.json
![caregiver profile](/img/eir_configs/caregiver-profile.png)

[TBC]

#### Child Profile Config
https://github.com/ona-health/giz-eir-fhir-resources/blob/main/app/profiles/child_profile_config.json
![child profile](/img/eir_configs/child-profile.png)

[TBC]

#### Child Upcoming Immunizatiion Profile Config
https://github.com/ona-health/giz-eir-fhir-resources/blob/main/app/profiles/childupcomingencounters_profile_config.json

[TBC]

#### Child Past Immunizatiion Profile Config

[TBC]

#### Child Past Profile Config
https://github.com/ona-health/giz-eir-fhir-resources/blob/main/app/profiles/childpastencounters_profile_config.json

[TBC]

#### Child Adverse Reaction Profile Config
https://github.com/ona-health/giz-eir-fhir-resources/blob/main/app/profiles/childadversereactions_profile_config.json

[TBC]


### Register Configs

#### Caregiver Register Congig
https://github.com/ona-health/giz-eir-fhir-resources/blob/main/app/registers/caregiver_register_config.json

![caregiver register config](/img/eir_configs/caregiver-register.png)

Breakdown of the Configuration:

1. General Information

	-	appId: "giz-eir" — The application ID (likely related to a healthcare or resource management app).
	-	configType: "register" — Specifies that this is a registration configuration.
	-	id: "caregiverRegister" — The unique ID for this caregiver registration page.

2. FHIR Resource Configuration

	-	fhirResource: This section defines the FHIR (Fast Healthcare Interoperability Resources) resource model used in the app.
	-	baseResource: The primary resource is "RelatedPerson", which seems to represent a caregiver or person linked to a patient.
	-	sortConfigs: The caregiver entries are sorted by their last update date (`_lastUpdated`) in descending order (newest first).
	-	relatedResources:
	-	availablePatients: A list of Patient resources associated with the RelatedPerson.
	-	availableTasks: A list of Task resources linked to patients (using the subject search parameter). This can represent tasks like appointments, follow-ups, or other responsibilities.

3. Register Card

The registerCard contains rules for displaying and managing caregiver information.

	-	Rules: The rules extract specific fields from the RelatedPerson and related resources, allowing them to be used in the UI. Examples include:
	-	relatedPersonId, relatedPersonFirstName, relatedPersonMiddleName, relatedPersonLastName: These rules extract personal information like the caregiver’s ID, first name, middle name, and last name.
	-	relatedPersonGender: Determines the gender of the caregiver.
	-	relatedPersonAge: Extracts the caregiver’s age.
	-	formattedRelatedPersonInfo: Combines the first name, last name, gender, and age into a formatted string.
	-	relatedPersonIdentifier: Retrieves the identifier (e.g., ID number) for the caregiver.
	-	numberOfChildren: Calculates the number of children (patients) associated with the caregiver.
	-	visitStatus: Determines the caregiver’s visit status based on the availability of tasks (e.g., “OVERDUE”, “DUE”, “UPCOMING”).
	-	Views: Specifies the UI layout for the caregiver card:
	-	viewType: "COLUMN" — Indicates a columnar layout.
	-	SERVICE_CARD: Displays details of the caregiver such as:
	-	COMPOUND_TEXT: Displays text fields with caregiver information.
	-	serviceButton: A button that shows the number of children associated with the caregiver and their visit status (e.g., OVERDUE, DUE, UPCOMING).
	 Clicking the button or the card triggers the LAUNCH_PROFILE action to display more details.

4. Search Bar

The searchBar allows users to search for caregivers using specific fields.

	-	visible: true — The search bar is visible.
	-	display: `"{{ search.name.or.id }}"` — Allows searching by name or ID.
	-	computedRules: Specifies which fields to search:
	-	relatedPersonIdentifier
	-	relatedPersonFirstName
	-	relatedPersonMiddleName
	-	relatedPersonLastName

5. Top Screen Section

This section defines the UI at the top of the screen.

	-	title: Dynamic title using the placeholder `"{{ 6a31766a4a17ff69f259bc76f812ecfa }}"`.
	-	searchBar: Another search bar specific to locations, with the ability to search by servicePointName.
	-	menuIcons: A list of icons for additional actions:
	-	viewType: "IMAGE" — Specifies an icon image.
	-	actions: Clicking this icon triggers the LAUNCH_MAP action, opening the map view (locationMap).



#### Child Register Congig
https://github.com/ona-health/giz-eir-fhir-resources/blob/main/app/registers/child_register_config.json

![child register config](/img/eir_configs/child-register.png)


## Logging in and getting started
[TBC]

# Are we doing a new user guide in the docs here ?

import login from '/img/eir_screenshoots/login.png';

<img src={login} style={{width: 250}} />

import authneticate from '/img/eir_screenshoots/authentication.png';

<img src={authneticate} style={{width: 250}} />

import set_pin from '/img/eir_screenshoots/set-pin.png';

<img src={set_pin} style={{width: 250}} />

import sycning from '/img/eir_screenshoots/syncing.png';

<img src={sycning} style={{width: 250}} />

import sync_complete from '/img/eir_screenshoots/sync-complete.png';

<img src={sync_complete} style={{width: 250}} />


### Registering a patient

[TBC]

import caregiver from '/img/eir_screenshoots/registration.png';

<img src={caregiver} style={{width: 250}} />

import child from '/img/eir_screenshoots/add-child.png';

<img src={child} style={{width: 250}} />


### Scheduling & tasking

[TBC]

![immunization config](/img/eir_configs/immunization-pd.png)



### Child Immunization 
The PlanDefinition resource in FHIR defines several immunization-related activities for child immunization. Each ActivityDefinition outlines specific tasks, including the administration of vaccines, detailing the type of vaccine, schedule, and responsible parties.

General Setup (First Activity) - "Child Register Handler Activity":

This activity handles the initial setup of a care plan when a child is registered.
It dynamically sets attributes like title, description, status, and care plan start and end dates based on the child's birthdate.
The activity also assigns a general practitioner as the performer and sets up an ongoing task to manage the care plan.
Specific Immunization Tasks: Each subsequent `ActivityDefinition` outlines a different immunization task:

1. BCG Immunization: Administered shortly after birth, with a booster scheduled later.
2. OPV (Oral Poliovirus Vaccine): Multiple doses scheduled at various weeks (6, 10, and 14 weeks).
3. PENTA Immunization: Similar to OPV with a series of three doses, followed by a booster.
4. ROTA Immunization: Administered in a two-dose series for protection against rotavirus.
5. PCV (Pneumococcal Vaccine): Three doses to protect against pneumococcal infections, with a booster.
6. IPV (Inactivated Poliovirus Vaccine): Single dose of inactivated polio vaccine.
7. Measles Immunization: Scheduled at 9 months and then a booster at 18 months.

For each immunization, the `ActivityDefinition` includes:

- Status: `"active"` indicating the task is currently in progress.
- Description: Provides a short description of the immunization.
- Kind: Indicates the task type (in this case, all are "Task").
- Coding: Maps the immunization to a specific procedure code.
- Dosage Information: Specifies the sequence of doses, timing, and intervals for each vaccine.

These definitions help automate the creation and management of a child's immunization schedule within a care plan in FHIR-based healthcare systems.


### Child Recurring Services

Key Components:

Contained Activity Definitions: These are activities defined within the care plan for various recurring services for children.

1. `careplan-init-activity`: Initializes the care plan when the child is registered, pulling dynamic values (such as the child’s ID and birthdate) to populate the CarePlan resource.
2. `careplan-vita-ifc-task-activity`: Specifies the administration of Vitamin A IFC service, scheduled every 6 months.
3. `careplan-vita-task-activity`: Another Vitamin A service scheduled more frequently, with 10 occurrences over a period of 6 months each.
4. `careplan-deworming-task-activity`: Defines the deworming service, administered every 6 months, recurring 9 times.
5. `careplan-itn-task-activity`: Specifies the ITN (Insecticide-treated net) service, provided every 6 months, up to 5 times.

Dynamic Values: In the careplan-init-activity, FHIRPath expressions are used to dynamically set values in the care plan based on the child’s details. For instance:

- The title and description of the care plan are set to the values from the root resource.
- The care plan’s start period is set to the child’s birthdate, and the end period is calculated to be approximately 11 years later (4017 days).
- The author and performer of the activities are based on the first general practitioner assigned to the child.

Scheduled Services:

- Timing and Dosage: Each ActivityDefinition for services like Vitamin A, Deworming, and ITN provides the timing details of when the service is administered. This includes how many times the service is repeated (e.g., every 6 months).
- Status and Kind: All activities are marked as active, with the kind set to Task, indicating that these are recurring, scheduled services.

This structure automates the generation of a child’s recurring care plan, ensuring that essential health services are administered at appropriate intervals.

### Recording vaccinations

[TBC]

import child_profile from '/img/eir_screenshoots/child-profile.png';

<img src={child_profile} style={{width: 250}} />

import immunization from '/img/eir_screenshoots/immunization-form.png';

<img src={immunization} style={{width: 250}} />



### Multi-Language Support

[TBC]

#### Multi Language strings files
![english trnslations config](/img/eir_configs/strings-en.png)
![spanish trnslations config](/img/eir_configs/strings-es.png)

https://github.com/ona-health/giz-eir-fhir-resources/blob/main/app/translations/strings_config.properties
https://github.com/ona-health/giz-eir-fhir-resources/blob/main/app/translations/strings_es_config.properties
https://github.com/ona-health/giz-eir-fhir-resources/blob/main/app/translations/strings_fr_config.properties

### Configuration and adapting the content

[TBC]

**Example on how to Load a questionnaire from assets folder**

1. Create a new file e.g. `config/app/resources/questionnaire/register_caregiver.json`

2. Update the questionnaire content

3. Make sure the Questionnaire ID (`13030180`)is similar to the on referenced in the Naviagtion config or the Primary register (in this case Caregiver Register)

![questionnaire config](/img/eir_configs/questionnaire_config.png)

4. Login to the app using `app/debug`

5. Click on Household register

6. Click on add household from the side navigation or configured fab

7. Observe the questionnaire updated 

## Reference app user guide

[TBC]

# Are we doing a new user guide in the docs here ?

<img src={login} style={{width: 250}} />

import auth_user from '/img/eir_screenshoots/authentication.png';

<img src={auth_user} style={{width: 250}} />


import set_pins from '/img/eir_screenshoots/set-pin.png';

<img src={set_pins} style={{width: 250}} />

import app_sycning from '/img/eir_screenshoots/syncing.png';

<img src={app_sycning} style={{width: 250}} />

import syncing_complete from '/img/eir_screenshoots/sync-complete.png';

<img src={syncing_complete} style={{width: 250}} />


import caregiver_search from '/img/eir_screenshoots/caregiver-search.png';

<img src={caregiver_search} style={{width: 250}} />


import permissions from '/img/eir_screenshoots/permissions.png';

<img src={permissions} style={{width: 250}} />


import maps from '/img/eir_screenshoots/maps.png';

<img src={maps} style={{width: 250}} />


import caregiver_register from '/img/eir_screenshoots/caregiver-register.png';

<img src={caregiver_register} style={{width: 250}} />


import nav_drawer from '/img/eir_screenshoots/navigation-drawer.png';

<img src={nav_drawer} style={{width: 250}} />


import user_settings from '/img/eir_screenshoots/user-settings.png';

<img src={user_settings} style={{width: 250}} />


import insights_page from '/img/eir_screenshoots/insights-page.png';

<img src={insights_page} style={{width: 250}} />


import mls_support from '/img/eir_screenshoots/mls-support.png';

<img src={mls_support} style={{width: 250}} />


import nav_drawer_es from '/img/eir_screenshoots/navigation-drawer-es.png';

<img src={nav_drawer_es} style={{width: 250}} />


import registration from '/img/eir_screenshoots/registration-es.png';

<img src={registration} style={{width: 250}} />


import caregiver_profile from '/img/eir_screenshoots/caregiver-profile.png';

<img src={caregiver_profile} style={{width: 250}} />


import overflow_menu from '/img/eir_screenshoots/overflow-menu.png';

<img src={overflow_menu} style={{width: 250}} />


import child_profile_view from '/img/eir_screenshoots/child-profile.png';

<img src={child_profile_view} style={{width: 250}} />


import immunization_form from '/img/eir_screenshoots/immunization-form.png';

<img src={immunization_form} style={{width: 250}} />


import adverse_reaction from '/img/eir_screenshoots/adverse-reaction.png';

<img src={adverse_reaction} style={{width: 250}} />


import revord_adverse_reaction from '/img/eir_screenshoots/record-adverse-reaction.png';

<img src={revord_adverse_reaction} style={{width: 250}} />


import past_encounter from '/img/eir_screenshoots/past-encounters.png';

<img src={past_encounter} style={{width: 250}} />


import upcoming_encounter from '/img/eir_screenshoots/upcoming-encounters.png';

<img src={upcoming_encounter} style={{width: 250}} />


import pending_sync from '/img/eir_screenshoots/pending-sync.png';

<img src={pending_sync} style={{width: 250}} />


## Interoperability interfaces

A critical component of immuniation tracking is the ability to connect to and share information with other information systems involved in providing and tracking care. Below we describe some common interoperability interfaces that link immunization workflows to broader health systems information infrastructure.

### Master patient index

A Master patient index (MPI) is an information system that maintains an authoritative list of all patients in specific geographic area, typically a country. We will focus on common use cases that are crticial to successful interoperability.

#### Transmitting a newly registered OpenSRP 2 patient to the MPI

In this use case a patient or client has been newly registered in the mobile app and the mobile app has syncronized its data with the remote FHIR API that servers as the operational data store for the mobile app. We would now like to send this newly stored patient information to a third-party MPI so that any other participaants in the health system also have access to this new patient's information. We will also want to store the ID assigned to the new patient by the MPI in our operation data store's patient API so that we have a 1-to-1 link between our representation of the patient and the MPI's represenatation of the patient.

![storing a new patient in the MPI](/img/iz-domain/patient-to-mpi.png)

FHIR Resources to transmit:
- Patient

Request:
- Path: e.g. `/patients`
- Method: `POST`
- Body: Patient resource
- Headers: Authentication token

Response:
- ID assigned by MPI

#### Transmitting changes to an existing OpenSRP 2 patient's demographic details to the MPI

In this use case there is an existing OpenSRP 2 patient that has already been stored in the MPI. OpenSRP 2 has received the patient's ID from the MPI and stored it in its own FHIR Patient resource. Suppose a user of the mobile app edits the patient's details, eventually we would like to propagate these changes to the MPI, ensuring eventually consistency between patient data in the operational FHIR API and the MPI.

![updating a patient in the MPI](/img/iz-domain/patient-updated-mpi.png)

Request
- Path: e.g. `/patients`
- Method: `PUT`
- Parameters
    - ID: `[Patient.identifier[first where type=MPI].value]`
- Body: Map of keys and values to change those keys to (potentially nested)
- Headers: Authentication token

Response:
- Success or failure

### Supply chain

It is not possible to deliver vaccines if the physical commodities (doses in vials, hyperdermic needles, gloves, etc) are not available and there is not an effective supply chain and cold chain to move those commodities from their point of creation, or geographic zone entry, to their point or disbursement or delivery.

Many countries use a logistics management information system (LMIS) to track commodities that are moving through supply chain, incuding vaccines and related vaccine delivery materials. We will describe the common use cases around transmitting stock consumption data from a FHIR API to an LMIS.

#### Transmitting stock consumption to an LMIS

![storing data in the LMIS](/img/iz-domain/stock-to-lmis.png)

FHIR Resources to transmit:
- Observation

Request:
- Path: e.g. `/transactions`
- Method: `POST`
- Body: Commodity: ID, Stock change: signed integer, Reason: text
- Headers: Authentication token

Response:
- Success or failure

### Shared health record

Analogous to the MPI's role as an authoritative list of patients, the shared health record's (SHR) role is to be an authority health record for each patient. Any system that creates or modifies patient health record information is then responsible for transmitting those additions or changes to the shared health record system. Any system that is requires access to the shared health record will have to authenticate itself, prove that it is authorized, and can then retrieve the shared health record. Shared health records are typicall structured to follow a well defined standard within FHIR, such as the [internation patient summary (IPS)](https://www.hl7.org/fhir/uv/ips/). This way shared health records are portable between any systems that understands the IPS standard.

![updating the SHR](/img/iz-domain/shr-updated.png)

#### Storing an immunization in the shared health record

We assume the patient already has a shared health record identified by their MPI ID number. The MPI can manage this by creating an empty shared health record whenever it creates a new patient. The FHIR data store has received new FHIR Observation resources that represent a vaccine being delivered. It then sends the new Observations to the shared health record API along with the patient's MPI. The shared health record services interprets and extracts information from the Observations to update the stored record for the patient.

FHIR Resources to transmit:
- Observation

Request:
- Path: e.g. `/update`
- Method: `POST`
- Parameters
    - ID: `[Patient.identifier[first where type=MPI].value]`
- Body: Observations to store
- Headers: Authentication token

Response:
- Success or failure

#### Storing conditions from a screening in the shared health record

This use case is similar to above except that instead a vaccine being delivered and new FHIR Observation resources being created, we assume an assessment or screening has been complianted and a new condition is discovered in the patient, represented by a new FHIR Condition resource. The FHIR data store receives new FHIR Condition resources and sends it to the shared health record API along with the patient's MPI ID. The shared health record services then interprets and extracts information from the Condition to update the stored record for the patient.

FHIR Resources to transmit:
- Condition

Request:
- Path: e.g. `/update`
- Method: `POST`
- Parameters
    - ID: `[Patient.identifier[first where type=MPI].value]`
- Body: Conditions to store
- Headers: Authentication token

Response:
- Success or failure